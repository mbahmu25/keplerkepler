"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateViewPort = exports.onViewPortChange = exports.getViewportFromMapState = exports.getMapLayersFromSplitMaps = void 0;
var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _viewportMercatorProject = _interopRequireDefault(require("viewport-mercator-project"));
var _constants = require("@kepler.gl/constants");
var _dataUtils = require("./data-utils");
var _excluded = ["width", "height"];
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2["default"])(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
/**
 * Validates a ViewPort object.
 * It retains all properties of the original ViewPort object,
 * but ensures that the latitude is within the defined bounds.
 * @param viewport - The ViewPort object to validate.
 * @returns A new ViewPort object with validated latitude.
 */
var validateViewPort = exports.validateViewPort = function validateViewPort(viewport) {
  return _objectSpread(_objectSpread(_objectSpread({}, viewport), viewport.latitude ? {
    latitude: (0, _dataUtils.validateLatitude)(viewport.latitude)
  } : {}), viewport.longitude ? {
    longitude: (0, _dataUtils.validateLongitude)(viewport.longitude)
  } : {});
};
var onViewPortChange = exports.onViewPortChange = function onViewPortChange(viewState, onUpdateMap, onViewStateChange) {
  var primary = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
  var mapIndex = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
  var _viewState$width = viewState.width,
    width = _viewState$width === void 0 ? 0 : _viewState$width,
    _viewState$height = viewState.height,
    height = _viewState$height === void 0 ? 0 : _viewState$height,
    restViewState = (0, _objectWithoutProperties2["default"])(viewState, _excluded);
  // react-map-gl sends 0,0 dimensions during initialization
  // after we have received proper dimensions from observeDimensions
  var next = _objectSpread(_objectSpread({}, width > 0 && height > 0 ? viewState : restViewState), {}, {
    // enabling transition in two maps may lead to endless update loops
    transitionDuration: primary ? _constants.TRANSITION_DURATION : 0
  });
  if (onViewStateChange && typeof onViewStateChange === 'function') {
    onViewStateChange(next);
  }
  onUpdateMap(next, mapIndex);
};
var getMapLayersFromSplitMaps = exports.getMapLayersFromSplitMaps = function getMapLayersFromSplitMaps(splitMaps, mapIndex) {
  var _splitMaps;
  return (_splitMaps = splitMaps[mapIndex || 0]) === null || _splitMaps === void 0 ? void 0 : _splitMaps.layers;
};

/**
 * Generates a viewport from a map state.
 * @param mapState
 * @returns A viewport.
 */
var getViewportFromMapState = exports.getViewportFromMapState = function getViewportFromMapState(mapState) {
  // Make sure we capture error
  // e.g. Error message: "Pixel project matrix not invertible"
  var viewPort;
  try {
    viewPort = new _viewportMercatorProject["default"](mapState);
  } catch (_unused) {
    // catch error and fallback to default map state
    viewPort = new _viewportMercatorProject["default"](validateViewPort(mapState));
  }
  return viewPort;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdmlld3BvcnRNZXJjYXRvclByb2plY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9jb25zdGFudHMiLCJfZGF0YVV0aWxzIiwiX2V4Y2x1ZGVkIiwib3duS2V5cyIsImUiLCJyIiwidCIsIk9iamVjdCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJ2YWxpZGF0ZVZpZXdQb3J0IiwiZXhwb3J0cyIsInZpZXdwb3J0IiwibGF0aXR1ZGUiLCJ2YWxpZGF0ZUxhdGl0dWRlIiwibG9uZ2l0dWRlIiwidmFsaWRhdGVMb25naXR1ZGUiLCJvblZpZXdQb3J0Q2hhbmdlIiwidmlld1N0YXRlIiwib25VcGRhdGVNYXAiLCJvblZpZXdTdGF0ZUNoYW5nZSIsInByaW1hcnkiLCJ1bmRlZmluZWQiLCJtYXBJbmRleCIsIl92aWV3U3RhdGUkd2lkdGgiLCJ3aWR0aCIsIl92aWV3U3RhdGUkaGVpZ2h0IiwiaGVpZ2h0IiwicmVzdFZpZXdTdGF0ZSIsIl9vYmplY3RXaXRob3V0UHJvcGVydGllczIiLCJuZXh0IiwidHJhbnNpdGlvbkR1cmF0aW9uIiwiVFJBTlNJVElPTl9EVVJBVElPTiIsImdldE1hcExheWVyc0Zyb21TcGxpdE1hcHMiLCJzcGxpdE1hcHMiLCJfc3BsaXRNYXBzIiwibGF5ZXJzIiwiZ2V0Vmlld3BvcnRGcm9tTWFwU3RhdGUiLCJtYXBTdGF0ZSIsInZpZXdQb3J0IiwiV2ViTWVyY2F0b3JWaWV3cG9ydCIsIl91bnVzZWQiXSwic291cmNlcyI6WyIuLi9zcmMvbWFwLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBXZWJNZXJjYXRvclZpZXdwb3J0IGZyb20gJ3ZpZXdwb3J0LW1lcmNhdG9yLXByb2plY3QnO1xuXG5pbXBvcnQge1RSQU5TSVRJT05fRFVSQVRJT059IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7U3BsaXRNYXBMYXllcnMsIFNwbGl0TWFwLCBWaWV3cG9ydCwgTWFwU3RhdGV9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuXG5pbXBvcnQge3ZhbGlkYXRlTGF0aXR1ZGUsIHZhbGlkYXRlTG9uZ2l0dWRlfSBmcm9tICcuL2RhdGEtdXRpbHMnO1xuXG4vKipcbiAqIFZhbGlkYXRlcyBhIFZpZXdQb3J0IG9iamVjdC5cbiAqIEl0IHJldGFpbnMgYWxsIHByb3BlcnRpZXMgb2YgdGhlIG9yaWdpbmFsIFZpZXdQb3J0IG9iamVjdCxcbiAqIGJ1dCBlbnN1cmVzIHRoYXQgdGhlIGxhdGl0dWRlIGlzIHdpdGhpbiB0aGUgZGVmaW5lZCBib3VuZHMuXG4gKiBAcGFyYW0gdmlld3BvcnQgLSBUaGUgVmlld1BvcnQgb2JqZWN0IHRvIHZhbGlkYXRlLlxuICogQHJldHVybnMgQSBuZXcgVmlld1BvcnQgb2JqZWN0IHdpdGggdmFsaWRhdGVkIGxhdGl0dWRlLlxuICovXG5leHBvcnQgY29uc3QgdmFsaWRhdGVWaWV3UG9ydCA9IDxUIGV4dGVuZHMgUGljazxWaWV3cG9ydCwgJ2xhdGl0dWRlJyB8ICdsb25naXR1ZGUnPj4oXG4gIHZpZXdwb3J0OiBUXG4pOiBUID0+IHtcbiAgcmV0dXJuIHtcbiAgICAuLi52aWV3cG9ydCxcbiAgICAvLyBtYWtlIHN1cmUgdG8gcHJvY2VzcyBsYXRpdHVkZSB0byBhdm9pZCA5MCwgLTkwIHZhbHVlc1xuICAgIC8vIFVuY2F1Z2h0IEVycm9yOiBQaXhlbCBwcm9qZWN0IG1hdHJpeCBub3QgaW52ZXJ0aWJsZVxuICAgIC4uLih2aWV3cG9ydC5sYXRpdHVkZSA/IHtsYXRpdHVkZTogdmFsaWRhdGVMYXRpdHVkZSh2aWV3cG9ydC5sYXRpdHVkZSl9IDoge30pLFxuICAgIC4uLih2aWV3cG9ydC5sb25naXR1ZGUgPyB7bG9uZ2l0dWRlOiB2YWxpZGF0ZUxvbmdpdHVkZSh2aWV3cG9ydC5sb25naXR1ZGUpfSA6IHt9KVxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IG9uVmlld1BvcnRDaGFuZ2UgPSAoXG4gIHZpZXdTdGF0ZTogVmlld3BvcnQsXG4gIG9uVXBkYXRlTWFwOiAobmV4dDogYW55LCBtYXBJbmRleDogbnVtYmVyKSA9PiBhbnksXG4gIG9uVmlld1N0YXRlQ2hhbmdlPzogKG5leHQ6IGFueSkgPT4gdm9pZCB8IG51bGwsXG4gIHByaW1hcnkgPSBmYWxzZSxcbiAgbWFwSW5kZXggPSAwXG4pOiB2b2lkID0+IHtcbiAgY29uc3Qge3dpZHRoID0gMCwgaGVpZ2h0ID0gMCwgLi4ucmVzdFZpZXdTdGF0ZX0gPSB2aWV3U3RhdGU7XG4gIC8vIHJlYWN0LW1hcC1nbCBzZW5kcyAwLDAgZGltZW5zaW9ucyBkdXJpbmcgaW5pdGlhbGl6YXRpb25cbiAgLy8gYWZ0ZXIgd2UgaGF2ZSByZWNlaXZlZCBwcm9wZXIgZGltZW5zaW9ucyBmcm9tIG9ic2VydmVEaW1lbnNpb25zXG4gIGNvbnN0IG5leHQgPSB7XG4gICAgLi4uKHdpZHRoID4gMCAmJiBoZWlnaHQgPiAwID8gdmlld1N0YXRlIDogcmVzdFZpZXdTdGF0ZSksXG4gICAgLy8gZW5hYmxpbmcgdHJhbnNpdGlvbiBpbiB0d28gbWFwcyBtYXkgbGVhZCB0byBlbmRsZXNzIHVwZGF0ZSBsb29wc1xuICAgIHRyYW5zaXRpb25EdXJhdGlvbjogcHJpbWFyeSA/IFRSQU5TSVRJT05fRFVSQVRJT04gOiAwXG4gIH07XG4gIGlmIChvblZpZXdTdGF0ZUNoYW5nZSAmJiB0eXBlb2Ygb25WaWV3U3RhdGVDaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICBvblZpZXdTdGF0ZUNoYW5nZShuZXh0KTtcbiAgfVxuXG4gIG9uVXBkYXRlTWFwKG5leHQsIG1hcEluZGV4KTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRNYXBMYXllcnNGcm9tU3BsaXRNYXBzID0gKFxuICBzcGxpdE1hcHM6IFNwbGl0TWFwW10sXG4gIG1hcEluZGV4PzogbnVtYmVyXG4pOiBTcGxpdE1hcExheWVycyB8IHVuZGVmaW5lZCB8IG51bGwgPT4ge1xuICByZXR1cm4gc3BsaXRNYXBzW21hcEluZGV4IHx8IDBdPy5sYXllcnM7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBhIHZpZXdwb3J0IGZyb20gYSBtYXAgc3RhdGUuXG4gKiBAcGFyYW0gbWFwU3RhdGVcbiAqIEByZXR1cm5zIEEgdmlld3BvcnQuXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRWaWV3cG9ydEZyb21NYXBTdGF0ZSA9IChtYXBTdGF0ZTogTWFwU3RhdGUpOiBWaWV3cG9ydCA9PiB7XG4gIC8vIE1ha2Ugc3VyZSB3ZSBjYXB0dXJlIGVycm9yXG4gIC8vIGUuZy4gRXJyb3IgbWVzc2FnZTogXCJQaXhlbCBwcm9qZWN0IG1hdHJpeCBub3QgaW52ZXJ0aWJsZVwiXG4gIGxldCB2aWV3UG9ydDtcbiAgdHJ5IHtcbiAgICB2aWV3UG9ydCA9IG5ldyBXZWJNZXJjYXRvclZpZXdwb3J0KG1hcFN0YXRlKTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gY2F0Y2ggZXJyb3IgYW5kIGZhbGxiYWNrIHRvIGRlZmF1bHQgbWFwIHN0YXRlXG4gICAgdmlld1BvcnQgPSBuZXcgV2ViTWVyY2F0b3JWaWV3cG9ydCh2YWxpZGF0ZVZpZXdQb3J0KG1hcFN0YXRlKSk7XG4gIH1cblxuICByZXR1cm4gdmlld1BvcnQ7XG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFHQSxJQUFBQSx3QkFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUMsVUFBQSxHQUFBRCxPQUFBO0FBR0EsSUFBQUUs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