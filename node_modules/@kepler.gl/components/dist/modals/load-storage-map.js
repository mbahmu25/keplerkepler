"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = _interopRequireWildcard(require("react"));
var _cloudHeader = _interopRequireDefault(require("./cloud-components/cloud-header"));
var _cloudMaps = require("./cloud-components/cloud-maps");
var _useCloudListProvider2 = require("../hooks/use-cloud-list-provider");
var _providerSelect = require("./cloud-components/provider-select");
var _flexContainer = require("../common/flex-container");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != _typeof(e) && "function" != typeof e) return { "default": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n["default"] = e, t && t.set(e, n), n; }
// SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project

LoadStorageMapFactory.deps = [_cloudHeader["default"]];
function LoadStorageMapFactory(CloudHeader) {
  var LoadStorageMap = function LoadStorageMap(_ref) {
    var onLoadCloudMap = _ref.onLoadCloudMap;
    var _useCloudListProvider = (0, _useCloudListProvider2.useCloudListProvider)(),
      currentProvider = _useCloudListProvider.provider,
      setProvider = _useCloudListProvider.setProvider,
      cloudProviders = _useCloudListProvider.cloudProviders;
    var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isLoading = _useState2[0],
      setIsLoading = _useState2[1];
    var _useState3 = (0, _react.useState)(null),
      _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
      maps = _useState4[0],
      setMaps = _useState4[1];
    var _useState5 = (0, _react.useState)(null),
      _useState6 = (0, _slicedToArray2["default"])(_useState5, 2),
      error = _useState6[0],
      setError = _useState6[1];
    var setProviderInfo = (0, _react.useCallback)(function (provider) {
      setMaps(null);
      setError(null);
      if (provider) {
        setIsLoading(true);
        provider.listMaps().then(setMaps)["catch"](setError)["finally"](function () {
          return setIsLoading(false);
        });
      } else {
        setIsLoading(false);
      }
    }, []);
    (0, _react.useEffect)(function () {
      setProviderInfo(currentProvider);
    }, [currentProvider, setProviderInfo]);
    var onSelectMap = (0, _react.useCallback)(function (provider, map) {
      onLoadCloudMap({
        loadParams: map.loadParams,
        provider: provider
      });
    }, [onLoadCloudMap]);
    return /*#__PURE__*/_react["default"].createElement(_flexContainer.FlexColContainer, null, !currentProvider ? /*#__PURE__*/_react["default"].createElement(_providerSelect.ProviderSelect, {
      cloudProviders: cloudProviders
    }) : /*#__PURE__*/_react["default"].createElement(_react["default"].Fragment, null, /*#__PURE__*/_react["default"].createElement(CloudHeader, {
      provider: currentProvider,
      onBack: function onBack() {
        return setProvider(null);
      }
    }), /*#__PURE__*/_react["default"].createElement(_cloudMaps.CloudMaps, {
      isLoading: isLoading,
      onSelectMap: onSelectMap,
      provider: currentProvider,
      error: error,
      maps: maps
    })));
  };
  return LoadStorageMap;
}
var _default = exports["default"] = LoadStorageMapFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfY2xvdWRIZWFkZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2Nsb3VkTWFwcyIsIl91c2VDbG91ZExpc3RQcm92aWRlcjIiLCJfcHJvdmlkZXJTZWxlY3QiLCJfZmxleENvbnRhaW5lciIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsImUiLCJXZWFrTWFwIiwiciIsInQiLCJfX2VzTW9kdWxlIiwiX3R5cGVvZiIsImhhcyIsImdldCIsIm4iLCJfX3Byb3RvX18iLCJhIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJ1IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiaSIsInNldCIsIkxvYWRTdG9yYWdlTWFwRmFjdG9yeSIsImRlcHMiLCJDbG91ZEhlYWRlckZhY3RvcnkiLCJDbG91ZEhlYWRlciIsIkxvYWRTdG9yYWdlTWFwIiwiX3JlZiIsIm9uTG9hZENsb3VkTWFwIiwiX3VzZUNsb3VkTGlzdFByb3ZpZGVyIiwidXNlQ2xvdWRMaXN0UHJvdmlkZXIiLCJjdXJyZW50UHJvdmlkZXIiLCJwcm92aWRlciIsInNldFByb3ZpZGVyIiwiY2xvdWRQcm92aWRlcnMiLCJfdXNlU3RhdGUiLCJ1c2VTdGF0ZSIsIl91c2VTdGF0ZTIiLCJfc2xpY2VkVG9BcnJheTIiLCJpc0xvYWRpbmciLCJzZXRJc0xvYWRpbmciLCJfdXNlU3RhdGUzIiwiX3VzZVN0YXRlNCIsIm1hcHMiLCJzZXRNYXBzIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJlcnJvciIsInNldEVycm9yIiwic2V0UHJvdmlkZXJJbmZvIiwidXNlQ2FsbGJhY2siLCJsaXN0TWFwcyIsInRoZW4iLCJ1c2VFZmZlY3QiLCJvblNlbGVjdE1hcCIsIm1hcCIsImxvYWRQYXJhbXMiLCJjcmVhdGVFbGVtZW50IiwiRmxleENvbENvbnRhaW5lciIsIlByb3ZpZGVyU2VsZWN0IiwiRnJhZ21lbnQiLCJvbkJhY2siLCJDbG91ZE1hcHMiLCJfZGVmYXVsdCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvbW9kYWxzL2xvYWQtc3RvcmFnZS1tYXAudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VTdGF0ZSwgdXNlRWZmZWN0fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQ2xvdWRIZWFkZXJGYWN0b3J5IGZyb20gJy4vY2xvdWQtY29tcG9uZW50cy9jbG91ZC1oZWFkZXInO1xuaW1wb3J0IHtDbG91ZE1hcHN9IGZyb20gJy4vY2xvdWQtY29tcG9uZW50cy9jbG91ZC1tYXBzJztcbmltcG9ydCB7dXNlQ2xvdWRMaXN0UHJvdmlkZXJ9IGZyb20gJy4uL2hvb2tzL3VzZS1jbG91ZC1saXN0LXByb3ZpZGVyJztcbmltcG9ydCB7UHJvdmlkZXJTZWxlY3R9IGZyb20gJy4vY2xvdWQtY29tcG9uZW50cy9wcm92aWRlci1zZWxlY3QnO1xuaW1wb3J0IHtGbGV4Q29sQ29udGFpbmVyfSBmcm9tICcuLi9jb21tb24vZmxleC1jb250YWluZXInO1xuaW1wb3J0IHtQcm92aWRlciwgTWFwTGlzdEl0ZW19IGZyb20gJ0BrZXBsZXIuZ2wvY2xvdWQtcHJvdmlkZXJzJztcblxuTG9hZFN0b3JhZ2VNYXBGYWN0b3J5LmRlcHMgPSBbQ2xvdWRIZWFkZXJGYWN0b3J5XTtcblxuZnVuY3Rpb24gTG9hZFN0b3JhZ2VNYXBGYWN0b3J5KENsb3VkSGVhZGVyOiBSZXR1cm5UeXBlPHR5cGVvZiBDbG91ZEhlYWRlckZhY3Rvcnk+KSB7XG4gIGNvbnN0IExvYWRTdG9yYWdlTWFwID0gKHtvbkxvYWRDbG91ZE1hcH0pID0+IHtcbiAgICBjb25zdCB7cHJvdmlkZXI6IGN1cnJlbnRQcm92aWRlciwgc2V0UHJvdmlkZXIsIGNsb3VkUHJvdmlkZXJzfSA9IHVzZUNsb3VkTGlzdFByb3ZpZGVyKCk7XG4gICAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbbWFwcywgc2V0TWFwc10gPSB1c2VTdGF0ZTxNYXBMaXN0SXRlbVtdIHwgbnVsbD4obnVsbCk7XG4gICAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZShudWxsKTtcblxuICAgIGNvbnN0IHNldFByb3ZpZGVySW5mbyA9IHVzZUNhbGxiYWNrKChwcm92aWRlcjogUHJvdmlkZXIgfCBudWxsKSA9PiB7XG4gICAgICBzZXRNYXBzKG51bGwpO1xuICAgICAgc2V0RXJyb3IobnVsbCk7XG4gICAgICBpZiAocHJvdmlkZXIpIHtcbiAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgICBwcm92aWRlclxuICAgICAgICAgIC5saXN0TWFwcygpXG4gICAgICAgICAgLnRoZW4oc2V0TWFwcylcbiAgICAgICAgICAuY2F0Y2goc2V0RXJyb3IpXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4gc2V0SXNMb2FkaW5nKGZhbHNlKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgICAgfVxuICAgIH0sIFtdKTtcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBzZXRQcm92aWRlckluZm8oY3VycmVudFByb3ZpZGVyKTtcbiAgICB9LCBbY3VycmVudFByb3ZpZGVyLCBzZXRQcm92aWRlckluZm9dKTtcblxuICAgIGNvbnN0IG9uU2VsZWN0TWFwID0gdXNlQ2FsbGJhY2soXG4gICAgICAocHJvdmlkZXIsIG1hcCkgPT4ge1xuICAgICAgICBvbkxvYWRDbG91ZE1hcCh7XG4gICAgICAgICAgbG9hZFBhcmFtczogbWFwLmxvYWRQYXJhbXMsXG4gICAgICAgICAgcHJvdmlkZXJcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgW29uTG9hZENsb3VkTWFwXVxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEZsZXhDb2xDb250YWluZXI+XG4gICAgICAgIHshY3VycmVudFByb3ZpZGVyID8gKFxuICAgICAgICAgIDxQcm92aWRlclNlbGVjdCBjbG91ZFByb3ZpZGVycz17Y2xvdWRQcm92aWRlcnN9IC8+XG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPD5cbiAgICAgICAgICAgIDxDbG91ZEhlYWRlciBwcm92aWRlcj17Y3VycmVudFByb3ZpZGVyfSBvbkJhY2s9eygpID0+IHNldFByb3ZpZGVyKG51bGwpfSAvPlxuICAgICAgICAgICAgPENsb3VkTWFwc1xuICAgICAgICAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAgICAgICAgICAgICAgb25TZWxlY3RNYXA9e29uU2VsZWN0TWFwfVxuICAgICAgICAgICAgICBwcm92aWRlcj17Y3VycmVudFByb3ZpZGVyfVxuICAgICAgICAgICAgICBlcnJvcj17ZXJyb3J9XG4gICAgICAgICAgICAgIG1hcHM9e21hcHN9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvPlxuICAgICAgICApfVxuICAgICAgPC9GbGV4Q29sQ29udGFpbmVyPlxuICAgICk7XG4gIH07XG5cbiAgcmV0dXJuIExvYWRTdG9yYWdlTWFwO1xufVxuXG5leHBvcnQgZGVmYXVsdCBMb2FkU3RvcmFnZU1hcEZhY3Rvcnk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUdBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLFlBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLHNCQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxlQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxjQUFBLEdBQUFOLE9BQUE7QUFBMEQsU0FBQU8seUJBQUFDLENBQUEsNkJBQUFDLE9BQUEsbUJBQUFDLENBQUEs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