"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));
var _react = _interopRequireWildcard(require("react"));
var _styledComponents = _interopRequireDefault(require("styled-components"));
var _lodash = _interopRequireDefault(require("lodash.throttle"));
var _classnames = _interopRequireDefault(require("classnames"));
var _utils = require("@kepler.gl/utils");
var _styles = require("@kepler.gl/styles");
var _constants = require("@kepler.gl/constants");
var _slider = _interopRequireDefault(require("./slider/slider"));
var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5; // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != _typeof(e) && "function" != typeof e) return { "default": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n["default"] = e, t && t.set(e, n), n; }
function noop() {
  return;
}
var SLIDER_MARGIN_PALM = 6;
var AnimationControlSlider = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  align-items: center;\n"])));
var SliderWrapper = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  flex-grow: 1;\n  margin: 0 24px;\n\n  ", "\n"])), _styles.media.palm(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n    margin: 0 ", "px;\n  "])), SLIDER_MARGIN_PALM));
var StyledSlider = (0, _styledComponents["default"])(_slider["default"])(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  .kg-range-slider__bar {\n    // change colors\n  }\n"])));
var StyledDomain = _styledComponents["default"].div.attrs(function (props) {
  return {
    className: (0, _classnames["default"])('animation-control__time-domain', props.className)
  };
})(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  font-weight: 400;\n  font-size: 10px;\n"])), function (props) {
  return props.theme.titleTextColor;
});
var PROGRESS_BAR_HEIGHT = 8;
function TimelineSliderFactory() {
  var TimelineSlider = function TimelineSlider(_ref) {
    var timeline = _ref.timeline,
      setTimelineValue = _ref.setTimelineValue,
      _ref$enableBarDrag = _ref.enableBarDrag,
      enableBarDrag = _ref$enableBarDrag === void 0 ? true : _ref$enableBarDrag,
      _ref$showDomainTimes = _ref.showDomainTimes,
      showDomainTimes = _ref$showDomainTimes === void 0 ? true : _ref$showDomainTimes,
      _ref$height = _ref.height,
      height = _ref$height === void 0 ? PROGRESS_BAR_HEIGHT : _ref$height,
      _ref$className = _ref.className,
      className = _ref$className === void 0 ? null : _ref$className,
      style = _ref.style;
    var onThrottleUpdate = (0, _react.useMemo)(function () {
      return (0, _lodash["default"])(setTimelineValue, 20);
    }, [setTimelineValue]);
    var step = timeline.step,
      domain = timeline.domain,
      value = timeline.value,
      timeFormat = timeline.timeFormat,
      defaultTimeFormat = timeline.defaultTimeFormat,
      timezone = timeline.timezone,
      animationWindow = timeline.animationWindow,
      marks = timeline.marks;
    var isRanged = (0, _react.useMemo)(function () {
      return Array.isArray(value) && value.length === 2 && animationWindow !== _constants.ANIMATION_WINDOW.interval;
    }, [animationWindow, value]);
    var _useMemo = (0, _react.useMemo)(function () {
        return [isRanged ? value[0] : null, isRanged ? value[1] : value[0]];
      }, [isRanged, value]),
      _useMemo2 = (0, _slicedToArray2["default"])(_useMemo, 2),
      value0 = _useMemo2[0],
      value1 = _useMemo2[1];
    var _useMemo3 = (0, _react.useMemo)(function () {
        if (!domain) return [noop, noop];
        return [isRanged ? function (newValue) {
          return onThrottleUpdate([(0, _utils.clamp)(domain, newValue), value1]);
        } : noop, isRanged ? function (newValue) {
          return onThrottleUpdate([value0, (0, _utils.clamp)(domain, newValue)]);
        } : function (newValue) {
          return onThrottleUpdate(animationWindow === _constants.ANIMATION_WINDOW.interval ?
          // filter requires an array with 2 values
          [(0, _utils.clamp)(domain, newValue), (0, _utils.clamp)(domain, newValue)] :
          // animationConfig only requires one value
          [(0, _utils.clamp)(domain, newValue)]);
        }];
      }, [animationWindow, domain, isRanged, value0, value1, onThrottleUpdate]),
      _useMemo4 = (0, _slicedToArray2["default"])(_useMemo3, 2),
      onSlider0Change = _useMemo4[0],
      onSlider1Change = _useMemo4[1];
    var timelineSliderStyle = (0, _react.useMemo)(function () {
      return {
        height: "".concat(height, "px")
      };
    }, [height]);
    var _useMemo5 = (0, _react.useMemo)(function () {
        if (!showDomainTimes) {
          return [null, null];
        }
        var hasUserFormat = typeof timeFormat === 'string';
        var currentFormat = (hasUserFormat ? timeFormat : defaultTimeFormat) || _constants.DEFAULT_TIME_FORMAT;
        var dateFunc = (0, _utils.datetimeFormatter)(timezone)(currentFormat);
        return [domain ? dateFunc(domain[0]) : '', domain ? dateFunc(domain[1]) : ''];
      }, [domain, timezone, timeFormat, defaultTimeFormat, showDomainTimes]),
      _useMemo6 = (0, _slicedToArray2["default"])(_useMemo5, 2),
      timeStart = _useMemo6[0],
      timeEnd = _useMemo6[1];
    var requiresRangeSlider = isRanged && animationWindow !== _constants.ANIMATION_WINDOW.interval;
    return /*#__PURE__*/_react["default"].createElement(AnimationControlSlider, {
      style: style,
      className: (0, _classnames["default"])('animation-control__time-slider', className)
    }, timeStart ? /*#__PURE__*/_react["default"].createElement(StyledDomain, {
      className: "domain-start"
    }, /*#__PURE__*/_react["default"].createElement("span", null, timeStart)) : null, /*#__PURE__*/_react["default"].createElement(SliderWrapper, {
      className: "animation-control__slider"
    }, /*#__PURE__*/_react["default"].createElement(StyledSlider, {
      isRanged: requiresRangeSlider,
      step: step || undefined,
      minValue: domain ? domain[0] : 0,
      maxValue: domain ? domain[1] : 1,
      enableBarDrag: enableBarDrag,
      style: timelineSliderStyle,
      onSlider0Change: onSlider0Change,
      onSlider1Change: onSlider1Change,
      value0: value0,
      value1: value1,
      marks: marks
    })), timeEnd ? /*#__PURE__*/_react["default"].createElement(StyledDomain, {
      className: "domain-end"
    }, /*#__PURE__*/_react["default"].createElement("span", null, timeEnd)) : null);
  };
  return TimelineSlider;
}
var _default = exports["default"] = TimelineSliderFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfc3R5bGVkQ29tcG9uZW50cyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfbG9kYXNoIiwiX2NsYXNzbmFtZXMiLCJfdXRpbHMiLCJfc3R5bGVzIiwiX2NvbnN0YW50cyIsIl9zbGlkZXIiLCJfdGVtcGxhdGVPYmplY3QiLCJfdGVtcGxhdGVPYmplY3QyIiwiX3RlbXBsYXRlT2JqZWN0MyIsIl90ZW1wbGF0ZU9iamVjdDQiLCJfdGVtcGxhdGVPYmplY3Q1IiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiZSIsIldlYWtNYXAiLCJyIiwidCIsIl9fZXNNb2R1bGUiLCJfdHlwZW9mIiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0Iiwibm9vcCIsIlNMSURFUl9NQVJHSU5fUEFMTSIsIkFuaW1hdGlvbkNvbnRyb2xTbGlkZXIiLCJzdHlsZWQiLCJkaXYiLCJfdGFnZ2VkVGVtcGxhdGVMaXRlcmFsMiIsIlNsaWRlcldyYXBwZXIiLCJtZWRpYSIsInBhbG0iLCJTdHlsZWRTbGlkZXIiLCJTbGlkZXIiLCJTdHlsZWREb21haW4iLCJhdHRycyIsInByb3BzIiwiY2xhc3NOYW1lIiwiY2xhc3NuYW1lcyIsInRoZW1lIiwidGl0bGVUZXh0Q29sb3IiLCJQUk9HUkVTU19CQVJfSEVJR0hUIiwiVGltZWxpbmVTbGlkZXJGYWN0b3J5IiwiVGltZWxpbmVTbGlkZXIiLCJfcmVmIiwidGltZWxpbmUiLCJzZXRUaW1lbGluZVZhbHVlIiwiX3JlZiRlbmFibGVCYXJEcmFnIiwiZW5hYmxlQmFyRHJhZyIsIl9yZWYkc2hvd0RvbWFpblRpbWVzIiwic2hvd0RvbWFpblRpbWVzIiwiX3JlZiRoZWlnaHQiLCJoZWlnaHQiLCJfcmVmJGNsYXNzTmFtZSIsInN0eWxlIiwib25UaHJvdHRsZVVwZGF0ZSIsInVzZU1lbW8iLCJ0aHJvdHRsZSIsInN0ZXAiLCJkb21haW4iLCJ2YWx1ZSIsInRpbWVGb3JtYXQiLCJkZWZhdWx0VGltZUZvcm1hdCIsInRpbWV6b25lIiwiYW5pbWF0aW9uV2luZG93IiwibWFya3MiLCJpc1JhbmdlZCIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIkFOSU1BVElPTl9XSU5ET1ciLCJpbnRlcnZhbCIsIl91c2VNZW1vIiwiX3VzZU1lbW8yIiwiX3NsaWNlZFRvQXJyYXkyIiwidmFsdWUwIiwidmFsdWUxIiwiX3VzZU1lbW8zIiwibmV3VmFsdWUiLCJjbGFtcCIsIl91c2VNZW1vNCIsIm9uU2xpZGVyMENoYW5nZSIsIm9uU2xpZGVyMUNoYW5nZSIsInRpbWVsaW5lU2xpZGVyU3R5bGUiLCJjb25jYXQiLCJfdXNlTWVtbzUiLCJoYXNVc2VyRm9ybWF0IiwiY3VycmVudEZvcm1hdCIsIkRFRkFVTFRfVElNRV9GT1JNQVQiLCJkYXRlRnVuYyIsImRhdGV0aW1lRm9ybWF0dGVyIiwiX3VzZU1lbW82IiwidGltZVN0YXJ0IiwidGltZUVuZCIsInJlcXVpcmVzUmFuZ2VTbGlkZXIiLCJjcmVhdGVFbGVtZW50IiwidW5kZWZpbmVkIiwibWluVmFsdWUiLCJtYXhWYWx1ZSIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vdGltZWxpbmUtc2xpZGVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7SVN0eWxlZENvbXBvbmVudH0gZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHRocm90dGxlIGZyb20gJ2xvZGFzaC50aHJvdHRsZSc7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7Y2xhbXAsIGRhdGV0aW1lRm9ybWF0dGVyfSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcbmltcG9ydCB7bWVkaWF9IGZyb20gJ0BrZXBsZXIuZ2wvc3R5bGVzJztcbmltcG9ydCB7REVGQVVMVF9USU1FX0ZPUk1BVCwgQU5JTUFUSU9OX1dJTkRPV30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuaW1wb3J0IHtUaW1lbGluZX0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5pbXBvcnQgU2xpZGVyIGZyb20gJy4vc2xpZGVyL3NsaWRlcic7XG5pbXBvcnQge0Jhc2VDb21wb25lbnRQcm9wc30gZnJvbSAnLi4vdHlwZXMnO1xuXG5mdW5jdGlvbiBub29wKCkge1xuICByZXR1cm47XG59XG5cbmNvbnN0IFNMSURFUl9NQVJHSU5fUEFMTSA9IDY7XG5cbmV4cG9ydCB0eXBlIEFuaW1hdGlvbkNvbnRyb2xTbGlkZXJQcm9wcyA9IEJhc2VDb21wb25lbnRQcm9wcztcblxuY29uc3QgQW5pbWF0aW9uQ29udHJvbFNsaWRlcjogSVN0eWxlZENvbXBvbmVudDwnd2ViJywgQW5pbWF0aW9uQ29udHJvbFNsaWRlclByb3BzPiA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5gO1xuXG5jb25zdCBTbGlkZXJXcmFwcGVyID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBmbGV4LWdyb3c6IDE7XG4gIG1hcmdpbjogMCAyNHB4O1xuXG4gICR7bWVkaWEucGFsbWBcbiAgICBtYXJnaW46IDAgJHtTTElERVJfTUFSR0lOX1BBTE19cHg7XG4gIGB9XG5gO1xuXG5jb25zdCBTdHlsZWRTbGlkZXIgPSBzdHlsZWQoU2xpZGVyKWBcbiAgLmtnLXJhbmdlLXNsaWRlcl9fYmFyIHtcbiAgICAvLyBjaGFuZ2UgY29sb3JzXG4gIH1cbmA7XG5cbmNvbnN0IFN0eWxlZERvbWFpbiA9IHN0eWxlZC5kaXYuYXR0cnMocHJvcHMgPT4gKHtcbiAgY2xhc3NOYW1lOiBjbGFzc25hbWVzKCdhbmltYXRpb24tY29udHJvbF9fdGltZS1kb21haW4nLCBwcm9wcy5jbGFzc05hbWUpXG59KSlgXG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRpdGxlVGV4dENvbG9yfTtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1zaXplOiAxMHB4O1xuYDtcblxuY29uc3QgUFJPR1JFU1NfQkFSX0hFSUdIVCA9IDg7XG5cbmludGVyZmFjZSBUaW1lbGluZVNsaWRlclByb3BzIHtcbiAgdGltZWxpbmU6IFRpbWVsaW5lO1xuICBzZXRUaW1lbGluZVZhbHVlOiAodmFsdWU6IFtudW1iZXJdIHwgW251bWJlciwgbnVtYmVyXSkgPT4gdm9pZDtcbiAgZW5hYmxlQmFyRHJhZz86IGJvb2xlYW47XG4gIHNob3dEb21haW5UaW1lcz86IGJvb2xlYW47XG4gIGhlaWdodD86IG51bWJlcjtcbiAgY2xhc3NOYW1lPzogc3RyaW5nIHwgbnVsbDtcbiAgc3R5bGU/OiBvYmplY3Q7XG59XG5cbmZ1bmN0aW9uIFRpbWVsaW5lU2xpZGVyRmFjdG9yeSgpIHtcbiAgY29uc3QgVGltZWxpbmVTbGlkZXI6IFJlYWN0LkZDPFRpbWVsaW5lU2xpZGVyUHJvcHM+ID0gKHtcbiAgICB0aW1lbGluZSwgLy8gdGltZWxpbmUgY2FuIGJlIGEgdW5pb24gb2YgZmlsdGVyIGFuZCBhbmltYXRpb25Db25maWdcbiAgICAvLyB3ZSBjYW4gcGFzcyB0aW1lbGluZSB0byBhIGhvb2sgYW5kIGdldCBiYWNrIHZhbHVlcyBhbmQgY29udHJvbGxlcnNcbiAgICBzZXRUaW1lbGluZVZhbHVlLFxuICAgIGVuYWJsZUJhckRyYWcgPSB0cnVlLFxuICAgIHNob3dEb21haW5UaW1lcyA9IHRydWUsXG4gICAgaGVpZ2h0ID0gUFJPR1JFU1NfQkFSX0hFSUdIVCxcbiAgICBjbGFzc05hbWUgPSBudWxsLFxuICAgIHN0eWxlXG4gIH0pID0+IHtcbiAgICBjb25zdCBvblRocm90dGxlVXBkYXRlID0gdXNlTWVtbygoKSA9PiB0aHJvdHRsZShzZXRUaW1lbGluZVZhbHVlLCAyMCksIFtzZXRUaW1lbGluZVZhbHVlXSk7XG5cbiAgICBjb25zdCB7c3RlcCwgZG9tYWluLCB2YWx1ZSwgdGltZUZvcm1hdCwgZGVmYXVsdFRpbWVGb3JtYXQsIHRpbWV6b25lLCBhbmltYXRpb25XaW5kb3csIG1hcmtzfSA9XG4gICAgICB0aW1lbGluZTtcblxuICAgIGNvbnN0IGlzUmFuZ2VkID0gdXNlTWVtbyhcbiAgICAgICgpID0+XG4gICAgICAgIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gMiAmJiBhbmltYXRpb25XaW5kb3cgIT09IEFOSU1BVElPTl9XSU5ET1cuaW50ZXJ2YWwsXG4gICAgICBbYW5pbWF0aW9uV2luZG93LCB2YWx1ZV1cbiAgICApO1xuXG4gICAgY29uc3QgW3ZhbHVlMCwgdmFsdWUxXTogW251bWJlciwgbnVtYmVyXSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBbaXNSYW5nZWQgPyB2YWx1ZVswXSA6IG51bGwsIGlzUmFuZ2VkID8gdmFsdWVbMV0gOiB2YWx1ZVswXV0sXG4gICAgICBbaXNSYW5nZWQsIHZhbHVlXVxuICAgICk7XG5cbiAgICBjb25zdCBbb25TbGlkZXIwQ2hhbmdlLCBvblNsaWRlcjFDaGFuZ2VdID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICBpZiAoIWRvbWFpbikgcmV0dXJuIFtub29wLCBub29wXTtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIGlzUmFuZ2VkID8gKG5ld1ZhbHVlOiBudW1iZXIpID0+IG9uVGhyb3R0bGVVcGRhdGUoW2NsYW1wKGRvbWFpbiwgbmV3VmFsdWUpLCB2YWx1ZTFdKSA6IG5vb3AsXG4gICAgICAgIGlzUmFuZ2VkXG4gICAgICAgICAgPyAobmV3VmFsdWU6IG51bWJlcikgPT4gb25UaHJvdHRsZVVwZGF0ZShbdmFsdWUwLCBjbGFtcChkb21haW4sIG5ld1ZhbHVlKV0pXG4gICAgICAgICAgOiAobmV3VmFsdWU6IG51bWJlcikgPT5cbiAgICAgICAgICAgICAgb25UaHJvdHRsZVVwZGF0ZShcbiAgICAgICAgICAgICAgICBhbmltYXRpb25XaW5kb3cgPT09IEFOSU1BVElPTl9XSU5ET1cuaW50ZXJ2YWxcbiAgICAgICAgICAgICAgICAgID8gLy8gZmlsdGVyIHJlcXVpcmVzIGFuIGFycmF5IHdpdGggMiB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgW2NsYW1wKGRvbWFpbiwgbmV3VmFsdWUpLCBjbGFtcChkb21haW4sIG5ld1ZhbHVlKV1cbiAgICAgICAgICAgICAgICAgIDogLy8gYW5pbWF0aW9uQ29uZmlnIG9ubHkgcmVxdWlyZXMgb25lIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIFtjbGFtcChkb21haW4sIG5ld1ZhbHVlKV1cbiAgICAgICAgICAgICAgKVxuICAgICAgXTtcbiAgICB9LCBbYW5pbWF0aW9uV2luZG93LCBkb21haW4sIGlzUmFuZ2VkLCB2YWx1ZTAsIHZhbHVlMSwgb25UaHJvdHRsZVVwZGF0ZV0pO1xuXG4gICAgY29uc3QgdGltZWxpbmVTbGlkZXJTdHlsZSA9IHVzZU1lbW8oKCkgPT4gKHtoZWlnaHQ6IGAke2hlaWdodH1weGB9KSwgW2hlaWdodF0pO1xuXG4gICAgY29uc3QgW3RpbWVTdGFydCwgdGltZUVuZF0gPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIGlmICghc2hvd0RvbWFpblRpbWVzKSB7XG4gICAgICAgIHJldHVybiBbbnVsbCwgbnVsbF07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhhc1VzZXJGb3JtYXQgPSB0eXBlb2YgdGltZUZvcm1hdCA9PT0gJ3N0cmluZyc7XG4gICAgICBjb25zdCBjdXJyZW50Rm9ybWF0ID0gKGhhc1VzZXJGb3JtYXQgPyB0aW1lRm9ybWF0IDogZGVmYXVsdFRpbWVGb3JtYXQpIHx8IERFRkFVTFRfVElNRV9GT1JNQVQ7XG4gICAgICBjb25zdCBkYXRlRnVuYyA9IGRhdGV0aW1lRm9ybWF0dGVyKHRpbWV6b25lKShjdXJyZW50Rm9ybWF0KTtcblxuICAgICAgcmV0dXJuIFtkb21haW4gPyBkYXRlRnVuYyhkb21haW5bMF0pIDogJycsIGRvbWFpbiA/IGRhdGVGdW5jKGRvbWFpblsxXSkgOiAnJ107XG4gICAgfSwgW2RvbWFpbiwgdGltZXpvbmUsIHRpbWVGb3JtYXQsIGRlZmF1bHRUaW1lRm9ybWF0LCBzaG93RG9tYWluVGltZXNdKTtcblxuICAgIGNvbnN0IHJlcXVpcmVzUmFuZ2VTbGlkZXIgPSBpc1JhbmdlZCAmJiBhbmltYXRpb25XaW5kb3cgIT09IEFOSU1BVElPTl9XSU5ET1cuaW50ZXJ2YWw7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEFuaW1hdGlvbkNvbnRyb2xTbGlkZXJcbiAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXMoJ2FuaW1hdGlvbi1jb250cm9sX190aW1lLXNsaWRlcicsIGNsYXNzTmFtZSl9XG4gICAgICA+XG4gICAgICAgIHt0aW1lU3RhcnQgPyAoXG4gICAgICAgICAgPFN0eWxlZERvbWFpbiBjbGFzc05hbWU9XCJkb21haW4tc3RhcnRcIj5cbiAgICAgICAgICAgIDxzcGFuPnt0aW1lU3RhcnR9PC9zcGFuPlxuICAgICAgICAgIDwvU3R5bGVkRG9tYWluPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgICAgPFNsaWRlcldyYXBwZXIgY2xhc3NOYW1lPVwiYW5pbWF0aW9uLWNvbnRyb2xfX3NsaWRlclwiPlxuICAgICAgICAgIDxTdHlsZWRTbGlkZXJcbiAgICAgICAgICAgIGlzUmFuZ2VkPXtyZXF1aXJlc1JhbmdlU2xpZGVyfVxuICAgICAgICAgICAgc3RlcD17c3RlcCB8fCB1bmRlZmluZWR9XG4gICAgICAgICAgICBtaW5WYWx1ZT17ZG9tYWluID8gZG9tYWluWzBdIDogMH1cbiAgICAgICAgICAgIG1heFZhbHVlPXtkb21haW4gPyBkb21haW5bMV0gOiAxfVxuICAgICAgICAgICAgZW5hYmxlQmFyRHJhZz17ZW5hYmxlQmFyRHJhZ31cbiAgICAgICAgICAgIHN0eWxlPXt0aW1lbGluZVNsaWRlclN0eWxlfVxuICAgICAgICAgICAgb25TbGlkZXIwQ2hhbmdlPXtvblNsaWRlcjBDaGFuZ2V9XG4gICAgICAgICAgICBvblNsaWRlcjFDaGFuZ2U9e29uU2xpZGVyMUNoYW5nZX1cbiAgICAgICAgICAgIHZhbHVlMD17dmFsdWUwfVxuICAgICAgICAgICAgdmFsdWUxPXt2YWx1ZTF9XG4gICAgICAgICAgICBtYXJrcz17bWFya3N9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9TbGlkZXJXcmFwcGVyPlxuICAgICAgICB7dGltZUVuZCA/IChcbiAgICAgICAgICA8U3R5bGVkRG9tYWluIGNsYXNzTmFtZT1cImRvbWFpbi1lbmRcIj5cbiAgICAgICAgICAgIDxzcGFuPnt0aW1lRW5kfTwvc3Bhbj5cbiAgICAgICAgICA8L1N0eWxlZERvbWFpbj5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L0FuaW1hdGlvbkNvbnRyb2xTbGlkZXI+XG4gICAgKTtcbiAgfTtcblxuICByZXR1cm4gVGltZWxpbmVTbGlkZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRpbWVsaW5lU2xpZGVyRmFjdG9yeTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUdBLElBQUFBLE1BQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGlCQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxPQUFBLEdBQUFELHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBSSxXQUFBLEdBQUFGLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBSyxNQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxPQUFBLEdBQUFOLE9BQUE7QUFDQSxJQUFBTyxVQUFBLEdBQUFQLE9BQUE7QUFFQSxJQUFBUSxPQUFBLEdBQUFOLHNCQUFBLENBQUFGLE9BQUE7QUFBcUMsSUFBQVMsZUFBQSxFQUFBQyxnQkFBQSxFQUFBQyxnQkFBQSxFQUFBQyxnQkFBQSxFQUFBQyxnQkFBQSxFQVhyQztBQUNBO0FBQUEsU0FBQUMseUJBQUFDLENBQUEsNkJBQUFDLE9BQUEsbUJBQUFDLENBQUEsT0FBQUQsT0FBQSxJQUFBRSxDQUFBLE9BQUFGLE9BQUEsWUFBQUYsd0JBQUEsWUFBQUEseUJBQUFDLENBQUEsV0FBQUEsQ0FBQSxHQUFBRyxDQUFBLEdBQUFELENBQUEsS0FBQUYsQ0FBQTtBQUFBLFNBQUFoQix3QkFBQWdCLENBQUEsRUFBQUUsQ0FBQSxTQUFBQSxDQUFBLElBQUFGLENBQUEsSUFBQUEsQ0FBQSxDQUFBSSxVQUFBLFNBQUFKLENBQUEsZUFBQUEsQ0FBQSxnQkFBQUssT0FBQSxDQUFBTCxDQUFBLDBCQUFBQSxDQUFBLHNCQUFBQSxDQUFBLFFBQUFHLENBQUEsR0FBQUosd0JBQUEsQ0FBQUcsQ0FBQSxPQUFBQyxDQUFBLElBQUFBLENBQUEsQ0FBQUcsR0FBQSxDQUFBTixDQUFBLFVBQUFHLENBQUEsQ0FBQUksR0FBQSxDQUFBUCxDQUFBLE9BQUFRLENBQUEsS0FBQUMsU0FBQSxVQUFBQyxDQUFBLEdBQUFDLE1BQUEsQ0FBQUMsY0FBQSxJQUFBRCxNQUFBLENBQUFFLHdCQUFBLFdBQUFDLENBQUEsSUFBQWQsQ0FBQSxvQkFBQWMsQ0FBQSxPQUFBQyxjQUFBLENBQUFDLElBQUEsQ0FBQWhCLENBQUEsRUFBQWMsQ0FBQSxTQUFBRyxDQUFBLEdBQUFQLENBQUEsR0FBQUMsTUFBQSxDQUFBRSx3QkFBQSxDQUFBYixDQUFBLEVBQUFjLENBQUEsVUFBQUcsQ0FBQSxLQUFBQSxDQUFBLENBQUFWLEdBQUEsSUFBQVUsQ0FBQSxDQUFBQyxHQUFBLElBQUFQLE1BQUEsQ0FBQUMsY0FBQSxDQUFBSixDQUFBLEVBQUFNLENBQUEsRUFBQUcsQ0FBQSxJQUFBVCxDQUFBLENBQUFNLENBQUEsSUFBQWQsQ0FBQSxDQUFBYyxDQUFBLFlBQUFOLENBQUEsY0FBQVIsQ0FBQSxFQUFBRyxDQUFBLElBQUFBLENBQUEsQ0FBQWUsR0FBQSxDQUFBbEIsQ0FBQSxFQUFBUSxDQUFBLEdBQUFBLENBQUE7QUFhQSxTQUFTVyxJQUFJQSxDQUFBLEVBQUc7RUFDZDtBQUNGO0FBRUEsSUFBTUMsa0JBQWtCLEdBQUcsQ0FBQztBQUk1QixJQUFNQyxzQkFBNEUsR0FBR0MsNEJBQU0sQ0FBQ0MsR0FBRyxDQUFBN0IsZUFBQSxLQUFBQSxlQUFBLE9BQUE4Qix1QkFBQSxnRUFHOUY7QUFFRCxJQUFNQyxhQUFhLEdBQUdILDRCQUFNLENBQUNDLEdBQUcsQ0FBQTVCLGdCQUFBLEtBQUFBLGdCQUFBLE9BQUE2Qix1QkFBQSw4R0FNNUJFLGFBQUssQ0FBQ0MsSUFBSSxDQUFBL0IsZ0JBQUEsS0FBQUEsZ0JBQUEsT0FBQTRCLHVCQUFBLGdEQUNFSixrQkFBa0IsRUFFakM7QUFFRCxJQUFNUSxZQUFZLEdBQUcsSUFBQU4sNEJBQU0sRUFBQ08sa0JBQU0sQ0FBQyxDQUFBaEMsZ0JBQUEsS0FBQUEsZ0JBQUEsT0FBQTJCLHVCQUFBLDRFQUlsQztBQUVELElBQU1NLFlBQVksR0FBR1IsNEJBQU0sQ0FBQ0MsR0FBRyxDQUFDUSxLQUFLLENBQUMsVUFBQUMsS0FBSztFQUFBLE9BQUs7SUFDOUNDLFNBQVMsRUFBRSxJQUFBQyxzQkFBVSxFQUFDLGdDQUFnQyxFQUFFRixLQUFLLENBQUNDLFNBQVM7RUFDekUsQ0FBQztBQUFBLENBQUMsQ0FBQyxDQUFBbkMsZ0JBQUEsS0FBQUEsZ0JBQUEsT0FBQTBCLHVCQUFBLGdGQUNRLFVBQUFRLEtBQUs7RUFBQSxPQUFJQSxLQUFLLENBQUNHLEtBQUssQ0FBQ0MsY0FBYztBQUFBLEVBRzdDO0FBRUQsSUFBTUMsbUJBQW1CLEdBQUcsQ0FBQztBQVk3QixTQUFTQyxxQkFBcUJBLENBQUEsRUFBRztFQUMvQixJQUFNQyxjQUE2QyxHQUFHLFNBQWhEQSxjQUE2Q0EsQ0FBQUMsSUFBQSxFQVM3QztJQUFBLElBUkpDLFFBQVEsR0FBQUQsSUFBQSxDQUFSQyxRQUFRO01BRVJDLGdCQUFnQixHQUFBRixJQUFBLENBQWhCRSxnQkFBZ0I7TUFBQUMsa0JBQUEsR0FBQUgsSUFBQSxDQUNoQkksYUFBYTtNQUFiQSxhQUFhLEdBQUFELGtCQUFBLGNBQUcsSUFBSSxHQUFBQSxrQkFBQTtNQUFBRSxvQkFBQSxHQUFBTCxJQUFBLENBQ3BCTSxlQUFlO01BQWZBLGVBQWUsR0FBQUQsb0JBQUEsY0FBRyxJQUFJLEdBQUFBLG9CQUFBO01BQUFFLFdBQUEsR0FBQVAsSUFBQSxDQUN0QlEsTUFBTTtNQUFOQSxNQUFNLEdBQUFELFdBQUEsY0FBR1YsbUJBQW1CLEdBQUFVLFdBQUE7TUFBQUUsY0FBQSxHQUFBVCxJQUFBLENBQzVCUCxTQUFTO01BQVRBLFNBQVMsR0FBQWdCLGNBQUEsY0FBRyxJQUFJLEdBQUFBLGNBQUE7TUFDaEJDLEtBQUssR0FBQVYsSUFBQSxDQUFMVSxLQUFLO0lBRUwsSUFBTUMsZ0JBQWdCLEdBQUcsSUFBQUMsY0FBTyxFQUFDO01BQUEsT0FBTSxJQUFBQyxrQkFBUSxFQUFDWCxnQkFBZ0IsRUFBRSxFQUFFLENBQUM7SUFBQSxHQUFFLENBQUNBLGdCQUFnQixDQUFDLENBQUM7SUFFMUYsSUFBT1ksSUFBSSxHQUNUYixRQUFRLENBREhhLElBQUk7TUFBRUMsTUFBTSxHQUNqQmQsUUFBUSxDQURHYyxNQUFNO01BQUVDLEtBQUssR0FDeEJmLFFBQVEsQ0FEV2UsS0FBSztNQUFFQyxVQUFVLEdBQ3BDaEIsUUFBUSxDQURrQmdCLFVBQVU7TUFBRUMsaUJBQWlCLEdBQ3ZEakIsUUFBUSxDQUQ4QmlCLGlCQUFpQjtNQUFFQyxRQUFRLEdBQ2pFbEIsUUFBUSxDQURpRGtCLFFBQVE7TUFBRUMsZUFBZSxHQUNsRm5CLFFBQVEsQ0FEMkRtQixlQUFlO01BQUVDLEtBQUssR0FDekZwQixRQUFRLENBRDRFb0IsS0FBSztJQUczRixJQUFNQyxRQUFRLEdBQUcsSUFBQVYsY0FBTyxFQUN0QjtNQUFBLE9BQ0VXLEtBQUssQ0FBQ0MsT0FBTyxDQUFDUixLQUFLLENBQUMsSUFBSUEsS0FBSyxDQUFDUyxNQUFNLEtBQUssQ0FBQyxJQUFJTCxlQUFlLEtBQUtNLDJCQUFnQixDQUFDQyxRQUFRO0lBQUEsR0FDN0YsQ0FBQ1AsZUFBZSxFQUFFSixLQUFLLENBQ3pCLENBQUM7SUFFRCxJQUFBWSxRQUFBLEdBQTJDLElBQUFoQixjQUFPLEVBQ2hEO1FBQUEsT0FBTSxDQUFDVSxRQUFRLEdBQUdOLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUVNLFFBQVEsR0FBR04sS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHQSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFBQSxHQUNsRSxDQUFDTSxRQUFRLEVBQUVOLEtBQUssQ0FDbEIsQ0FBQztNQUFBYSxTQUFBLE9BQUFDLGVBQUEsYUFBQUYsUUFBQTtNQUhNRyxNQUFNLEdBQUFGLFNBQUE7TUFBRUcsTUFBTSxHQUFBSCxTQUFBO0lBS3JCLElBQUFJLFNBQUEsR0FBMkMsSUFBQXJCLGNBQU8sRUFBQyxZQUFNO1FBQ3ZELElBQUksQ0FBQ0csTUFBTSxFQUFFLE9BQU8sQ0FBQ3BDLElBQUksRUFBRUEsSUFBSSxDQUFDO1FBQ2hDLE9BQU8sQ0FDTDJDLFFBQVEsR0FBRyxVQUFDWSxRQUFnQjtVQUFBLE9BQUt2QixnQkFBZ0IsQ0FBQyxDQUFDLElBQUF3QixZQUFLLEVBQUNwQixNQUFNLEVBQUVtQixRQUFRLENBQUMsRUFBRUYsTUFBTSxDQUFDLENBQUM7UUFBQSxJQUFHckQsSUFBSSxFQUMzRjJDLFFBQVEsR0FDSixVQUFDWSxRQUFnQjtVQUFBLE9BQUt2QixnQkFBZ0IsQ0FBQyxDQUFDb0IsTUFBTSxFQUFFLElBQUFJLFlBQUssRUFBQ3BCLE1BQU0sRUFBRW1CLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFBQSxJQUN6RSxVQUFDQSxRQUFnQjtVQUFBLE9BQ2Z2QixnQkFBZ0IsQ0FDZFMsZUFBZSxLQUFLTSwyQkFBZ0IsQ0FBQ0MsUUFBUTtVQUN6QztVQUNBLENBQUMsSUFBQVEsWUFBSyxFQUFDcEIsTUFBTSxFQUFFbUIsUUFBUSxDQUFDLEVBQUUsSUFBQUMsWUFBSyxFQUFDcEIsTUFBTSxFQUFFbUIsUUFBUSxDQUFDLENBQUM7VUFDbEQ7VUFDQSxDQUFDLElBQUFDLFlBQUssRUFBQ3BCLE1BQU0sRUFBRW1CLFFBQVEsQ0FBQyxDQUM5QixDQUFDO1FBQUEsRUFDUjtNQUNILENBQUMsRUFBRSxDQUFDZCxlQUFlLEVBQUVMLE1BQU0sRUFBRU8sUUFBUSxFQUFFUyxNQUFNLEVBQUVDLE1BQU0sRUFBRXJCLGdCQUFnQixDQUFDLENBQUM7TUFBQXlCLFNBQUEsT0FBQU4sZUFBQSxhQUFBRyxTQUFBO01BZmxFSSxlQUFlLEdBQUFELFNBQUE7TUFBRUUsZUFBZSxHQUFBRixTQUFBO0lBaUJ2QyxJQUFNRyxtQkFBbUIsR0FBRyxJQUFBM0IsY0FBTyxFQUFDO01BQUEsT0FBTztRQUFDSixNQUFNLEtBQUFnQyxNQUFBLENBQUtoQyxNQUFNO01BQUksQ0FBQztJQUFBLENBQUMsRUFBRSxDQUFDQSxNQUFNLENBQUMsQ0FBQztJQUU5RSxJQUFBaUMsU0FBQSxHQUE2QixJQUFBN0IsY0FBTyxFQUFDLFlBQU07UUFDekMsSUFBSSxDQUFDTixlQUFlLEVBQUU7VUFDcEIsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDckI7UUFFQSxJQUFNb0MsYUFBYSxHQUFHLE9BQU96QixVQUFVLEtBQUssUUFBUTtRQUNwRCxJQUFNMEIsYUFBYSxHQUFHLENBQUNELGFBQWEsR0FBR3pCLFVBQVUsR0FBR0MsaUJBQWlCLEtBQUswQiw4QkFBbUI7UUFDN0YsSUFBTUMsUUFBUSxHQUFHLElBQUFDLHdCQUFpQixFQUFDM0IsUUFBUSxDQUFDLENBQUN3QixhQUFhLENBQUM7UUFFM0QsT0FBTyxDQUFDNUIsTUFBTSxHQUFHOEIsUUFBUSxDQUFDOUIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFQSxNQUFNLEdBQUc4QixRQUFRLENBQUM5QixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7TUFDL0UsQ0FBQyxFQUFFLENBQUNBLE1BQU0sRUFBRUksUUFBUSxFQUFFRixVQUFVLEVBQUVDLGlCQUFpQixFQUFFWixlQUFlLENBQUMsQ0FBQztNQUFBeUMsU0FBQSxPQUFBakIsZUFBQSxhQUFBVyxTQUFBO01BVi9ETyxTQUFTLEdBQUFELFNBQUE7TUFBRUUsT0FBTyxHQUFBRixTQUFBO0lBWXpCLElBQU1HLG1CQUFtQixHQUFHNUIsUUFBUSxJQUFJRixlQUFlLEtBQUtNLDJCQUFnQixDQUFDQyxRQUFRO0lBRXJGLG9CQUNFcEYsTUFBQSxZQUFBNEcsYUFBQSxDQUFDdEUsc0JBQXNCO01BQ3JCNkIsS0FBSyxFQUFFQSxLQUFNO01BQ2JqQixTQUFTLEVBQUUsSUFBQUMsc0JBQVUsRUFBQyxnQ0FBZ0MsRUFBRUQsU0FBUztJQUFFLEdBRWxFdUQsU0FBUyxnQkFDUnpHLE1BQUEsWUFBQTRHLGFBQUEsQ0FBQzdELFlBQVk7TUFBQ0csU0FBUyxFQUFDO0lBQWMsZ0JBQ3BDbEQsTUFBQSxZQUFBNEcsYUFBQSxlQUFPSCxTQUFnQixDQUNYLENBQUMsR0FDYixJQUFJLGVBQ1J6RyxNQUFBLFlBQUE0RyxhQUFBLENBQUNsRSxhQUFhO01BQUNRLFNBQVMsRUFBQztJQUEyQixnQkFDbERsRCxNQUFBLFlBQUE0RyxhQUFBLENBQUMvRCxZQUFZO01BQ1hrQyxRQUFRLEVBQUU0QixtQkFBb0I7TUFDOUJwQyxJQUFJLEVBQUVBLElBQUksSUFBSXNDLFNBQVU7TUFDeEJDLFFBQVEsRUFBRXRDLE1BQU0sR0FBR0EsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUU7TUFDakN1QyxRQUFRLEVBQUV2QyxNQUFNLEdBQUdBLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFFO01BQ2pDWCxhQUFhLEVBQUVBLGFBQWM7TUFDN0JNLEtBQUssRUFBRTZCLG1CQUFvQjtNQUMzQkYsZUFBZSxFQUFFQSxlQUFnQjtNQUNqQ0MsZUFBZSxFQUFFQSxlQUFnQjtNQUNqQ1AsTUFBTSxFQUFFQSxNQUFPO01BQ2ZDLE1BQU0sRUFBRUEsTUFBTztNQUNmWCxLQUFLLEVBQUVBO0lBQU0sQ0FDZCxDQUNZLENBQUMsRUFDZjRCLE9BQU8sZ0JBQ04xRyxNQUFBLFlBQUE0RyxhQUFBLENBQUM3RCxZQUFZO01BQUNHLFNBQVMsRUFBQztJQUFZLGdCQUNsQ2xELE1BQUEsWUFBQTRHLGFBQUEsZUFBT0YsT0FBYyxDQUNULENBQUMsR0FDYixJQUNrQixDQUFDO0VBRTdCLENBQUM7RUFFRCxPQUFPbEQsY0FBYztBQUN2QjtBQUFDLElBQUF3RCxRQUFBLEdBQUFDLE9BQUEsY0FFYzFELHFCQUFxQiIsImlnbm9yZUxpc3QiOltdfQ==