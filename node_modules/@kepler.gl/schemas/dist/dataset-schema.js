"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.propertiesV1 = exports.propertiesV0 = exports.fieldPropertiesV1 = exports.fieldPropertiesV0 = exports["default"] = exports.datasetSchema = exports.FieldSchema = exports.DatasetSchema = void 0;
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _lodash = _interopRequireDefault(require("lodash.pick"));
var _window = require("global/window");
var arrow = _interopRequireWildcard(require("apache-arrow"));
var _constants = require("@kepler.gl/constants");
var _versions = require("./versions");
var _schema = _interopRequireDefault(require("./schema"));
var _commonUtils = require("@kepler.gl/common-utils");
var _utils = require("@kepler.gl/utils");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != _typeof(e) && "function" != typeof e) return { "default": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n["default"] = e, t && t.set(e, n), n; }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2["default"])(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _callSuper(t, o, e) { return o = (0, _getPrototypeOf2["default"])(o), (0, _possibleConstructorReturn2["default"])(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], (0, _getPrototypeOf2["default"])(t).constructor) : o.apply(t, e)); }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); } // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
// version v0
var fieldPropertiesV0 = exports.fieldPropertiesV0 = {
  name: null,
  type: null
};
var fieldPropertiesV1 = exports.fieldPropertiesV1 = {
  name: null,
  type: null,
  format: null,
  analyzerType: null,
  metadata: null
};
var FieldSchema = exports.FieldSchema = /*#__PURE__*/function (_Schema) {
  function FieldSchema() {
    (0, _classCallCheck2["default"])(this, FieldSchema);
    return _callSuper(this, FieldSchema, arguments);
  }
  (0, _inherits2["default"])(FieldSchema, _Schema);
  return (0, _createClass2["default"])(FieldSchema, [{
    key: "save",
    value: function save(fields) {
      var _this = this;
      return (0, _defineProperty2["default"])({}, this.key, fields.map(function (f) {
        return _this.savePropertiesOrApplySchema(f)[_this.key];
      }));
    }
  }, {
    key: "load",
    value: function load(fields) {
      return (0, _defineProperty2["default"])({}, this.key, fields);
    }
  }]);
}(_schema["default"]);
var propertiesV0 = exports.propertiesV0 = {
  id: null,
  label: null,
  color: null,
  allData: null,
  fields: new FieldSchema({
    key: 'fields',
    version: _versions.VERSIONS.v0,
    properties: fieldPropertiesV0
  })
};
var propertiesV1 = exports.propertiesV1 = _objectSpread(_objectSpread({}, propertiesV0), {}, {
  fields: new FieldSchema({
    key: 'fields',
    version: _versions.VERSIONS.v1,
    properties: fieldPropertiesV1
  }),
  type: null,
  metadata: null,
  disableDataOperation: null
});

/**
 * TODO Consider moving this cast to ArrowDataContainer?
 * Prepare a data container for export as part of json / html files.
 * 1) Arrow tables can store Timestamps as BigInts, so convert numbers to ISOStrings compatible with Kepler.gl's TIMESTAMP.
 * 2) Geoarrow binary buffers converted to hex wkb
 * @param dataContainer A data container to flatten.
 * @returns Row based data.
 */
var getAllDataForSaving = function getAllDataForSaving(dataContainer) {
  var allData = dataContainer.flattenData();
  if (dataContainer instanceof _utils.ArrowDataContainer) {
    var numColumns = dataContainer.numColumns();
    var _loop = function _loop(columnIndex) {
      var column = dataContainer.getColumn(columnIndex);
      var field = dataContainer.getField(columnIndex);
      if (arrow.DataType.isTimestamp(column.type) || arrow.DataType.isDate(column.type) || arrow.DataType.isTime(column.type)) {
        allData.forEach(function (row) {
          row[columnIndex] = new Date(row[columnIndex]).toISOString();
        });
      } else if ((field === null || field === void 0 ? void 0 : field.type) === _constants.ALL_FIELD_TYPES.geoarrow) {
        var formatter = _utils.FIELD_DISPLAY_FORMAT[_constants.ALL_FIELD_TYPES.geoarrow];
        allData.forEach(function (row) {
          row[columnIndex] = formatter(row[columnIndex], field);
        });
      }
    };
    for (var columnIndex = 0; columnIndex < numColumns; ++columnIndex) {
      _loop(columnIndex);
    }
  }
  return allData;
};

/**
 * Transforms fields for saving as part of json / html files.
 * @param fields The array of fields from a Kepler table.
 * @returns The transformed fields array with GeoArrow types updated to GeoJSON.
 */
var getFieldsForSaving = function getFieldsForSaving(fields) {
  return fields.map(function (field) {
    if (field.type === _constants.ALL_FIELD_TYPES.geoarrow) {
      // geoarrow binary data is transformed to hex wkb in getAllDataForSaving, so update the field accordingly
      return {
        name: field.name,
        type: _constants.ALL_FIELD_TYPES.geojson,
        format: '',
        analyzerType: 'GEOMETRY'
      };
    }
    return field;
  });
};
var DatasetSchema = exports.DatasetSchema = /*#__PURE__*/function (_Schema2) {
  function DatasetSchema() {
    var _this2;
    (0, _classCallCheck2["default"])(this, DatasetSchema);
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    _this2 = _callSuper(this, DatasetSchema, [].concat(args));
    (0, _defineProperty2["default"])(_this2, "key", 'dataset');
    return _this2;
  }
  (0, _inherits2["default"])(DatasetSchema, _Schema2);
  return (0, _createClass2["default"])(DatasetSchema, [{
    key: "save",
    value: function save(dataset) {
      var datasetFlattened = dataset.dataContainer ? _objectSpread(_objectSpread({}, dataset), {}, {
        allData: getAllDataForSaving(dataset.dataContainer),
        fields: getFieldsForSaving(dataset.fields),
        // we use flattenData to save arrow tables,
        // but once flattened it's not an arrow file anymore.
        metadata: _objectSpread(_objectSpread({}, dataset.metadata), dataset.metadata.format === _constants.DATASET_FORMATS.arrow ? {
          format: _constants.DATASET_FORMATS.row
        } : {})
      }) : dataset;
      return this.savePropertiesOrApplySchema(datasetFlattened)[this.key];
    }
  }, {
    key: "load",
    value: function load(dataset) {
      var fields = dataset.fields,
        allData = dataset.allData;
      var updatedFields = fields;

      // recalculate field type
      // because we have updated type-analyzer
      // we need to add format to each field
      var needCalculateMeta = fields[0] && (!Object.prototype.hasOwnProperty.call(fields[0], 'format') || !Object.prototype.hasOwnProperty.call(fields[0], 'analyzerType'));
      if (needCalculateMeta) {
        var fieldOrder = fields.map(function (f) {
          return f.name;
        });
        var sampleData = (0, _commonUtils.getSampleForTypeAnalyze)({
          fields: fieldOrder,
          rows: allData
        });
        var meta = (0, _commonUtils.getFieldsFromData)(sampleData, fieldOrder);
        updatedFields = meta.map(function (f, i) {
          return _objectSpread(_objectSpread({}, (0, _lodash["default"])(meta[i], ['name', 'type', 'format'])), {}, {
            analyzerType: meta[i].analyzerType
          });
        });
        updatedFields.forEach(function (f, i) {
          if (fields[i].type !== f.type) {
            // if newly detected field type is different from saved type
            // we log it but won't update it, cause we don't want to break people's map
            _window.console.warn("detect ".concat(f.name, " type is now ").concat(f.type, " instead of ").concat(fields[i].type));
          }
        });
      }

      // get format of all fields
      return _objectSpread(_objectSpread({
        data: {
          fields: updatedFields,
          rows: dataset.allData
        },
        info: (0, _lodash["default"])(dataset, ['id', 'label', 'color', 'type'])
      }, dataset.metadata ? {
        metadata: dataset.metadata
      } : {}), dataset.disableDataOperation ? {
        disableDataOperation: dataset.disableDataOperation
      } : {});
    }
  }]);
}(_schema["default"]);
var datasetSchema = exports.datasetSchema = (0, _defineProperty2["default"])((0, _defineProperty2["default"])({}, _versions.VERSIONS.v0, new DatasetSchema({
  key: 'dataset',
  version: _versions.VERSIONS.v0,
  properties: propertiesV0
})), _versions.VERSIONS.v1, new DatasetSchema({
  key: 'dataset',
  version: _versions.VERSIONS.v1,
  properties: propertiesV1
}));
var _default = exports["default"] = datasetSchema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfd2luZG93IiwiYXJyb3ciLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9jb25zdGFudHMiLCJfdmVyc2lvbnMiLCJfc2NoZW1hIiwiX2NvbW1vblV0aWxzIiwiX3V0aWxzIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiZSIsIldlYWtNYXAiLCJyIiwidCIsIl9fZXNNb2R1bGUiLCJfdHlwZW9mIiwiaGFzIiwiZ2V0IiwibiIsIl9fcHJvdG9fXyIsImEiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJpIiwic2V0Iiwib3duS2V5cyIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiX2NhbGxTdXBlciIsIl9nZXRQcm90b3R5cGVPZjIiLCJfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIiLCJfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0IiwiUmVmbGVjdCIsImNvbnN0cnVjdCIsImNvbnN0cnVjdG9yIiwiQm9vbGVhbiIsInByb3RvdHlwZSIsInZhbHVlT2YiLCJmaWVsZFByb3BlcnRpZXNWMCIsImV4cG9ydHMiLCJuYW1lIiwidHlwZSIsImZpZWxkUHJvcGVydGllc1YxIiwiZm9ybWF0IiwiYW5hbHl6ZXJUeXBlIiwibWV0YWRhdGEiLCJGaWVsZFNjaGVtYSIsIl9TY2hlbWEiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX2luaGVyaXRzMiIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsInNhdmUiLCJmaWVsZHMiLCJfdGhpcyIsIm1hcCIsImYiLCJzYXZlUHJvcGVydGllc09yQXBwbHlTY2hlbWEiLCJsb2FkIiwiU2NoZW1hIiwicHJvcGVydGllc1YwIiwiaWQiLCJsYWJlbCIsImNvbG9yIiwiYWxsRGF0YSIsInZlcnNpb24iLCJWRVJTSU9OUyIsInYwIiwicHJvcGVydGllcyIsInByb3BlcnRpZXNWMSIsInYxIiwiZGlzYWJsZURhdGFPcGVyYXRpb24iLCJnZXRBbGxEYXRhRm9yU2F2aW5nIiwiZGF0YUNvbnRhaW5lciIsImZsYXR0ZW5EYXRhIiwiQXJyb3dEYXRhQ29udGFpbmVyIiwibnVtQ29sdW1ucyIsIl9sb29wIiwiY29sdW1uSW5kZXgiLCJjb2x1bW4iLCJnZXRDb2x1bW4iLCJmaWVsZCIsImdldEZpZWxkIiwiRGF0YVR5cGUiLCJpc1RpbWVzdGFtcCIsImlzRGF0ZSIsImlzVGltZSIsInJvdyIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsIkFMTF9GSUVMRF9UWVBFUyIsImdlb2Fycm93IiwiZm9ybWF0dGVyIiwiRklFTERfRElTUExBWV9GT1JNQVQiLCJnZXRGaWVsZHNGb3JTYXZpbmciLCJnZW9qc29uIiwiRGF0YXNldFNjaGVtYSIsIl9TY2hlbWEyIiwiX3RoaXMyIiwiX2xlbiIsImFyZ3MiLCJBcnJheSIsIl9rZXkiLCJjb25jYXQiLCJkYXRhc2V0IiwiZGF0YXNldEZsYXR0ZW5lZCIsIkRBVEFTRVRfRk9STUFUUyIsInVwZGF0ZWRGaWVsZHMiLCJuZWVkQ2FsY3VsYXRlTWV0YSIsImZpZWxkT3JkZXIiLCJzYW1wbGVEYXRhIiwiZ2V0U2FtcGxlRm9yVHlwZUFuYWx5emUiLCJyb3dzIiwibWV0YSIsImdldEZpZWxkc0Zyb21EYXRhIiwicGljayIsImdsb2JhbENvbnNvbGUiLCJ3YXJuIiwiZGF0YSIsImluZm8iLCJkYXRhc2V0U2NoZW1hIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi9zcmMvZGF0YXNldC1zY2hlbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IHBpY2sgZnJvbSAnbG9kYXNoLnBpY2snO1xuaW1wb3J0IHtjb25zb2xlIGFzIGdsb2JhbENvbnNvbGV9IGZyb20gJ2dsb2JhbC93aW5kb3cnO1xuaW1wb3J0ICogYXMgYXJyb3cgZnJvbSAnYXBhY2hlLWFycm93JztcblxuaW1wb3J0IHtBTExfRklFTERfVFlQRVMsIERBVEFTRVRfRk9STUFUU30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuaW1wb3J0IHtQcm90b0RhdGFzZXQsIFJHQkNvbG9yLCBKc29uT2JqZWN0fSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7S2VwbGVyVGFibGV9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuaW1wb3J0IHtWRVJTSU9OU30gZnJvbSAnLi92ZXJzaW9ucyc7XG5pbXBvcnQgU2NoZW1hIGZyb20gJy4vc2NoZW1hJztcbmltcG9ydCB7Z2V0RmllbGRzRnJvbURhdGEsIGdldFNhbXBsZUZvclR5cGVBbmFseXplfSBmcm9tICdAa2VwbGVyLmdsL2NvbW1vbi11dGlscyc7XG5pbXBvcnQge0Fycm93RGF0YUNvbnRhaW5lciwgRGF0YUNvbnRhaW5lckludGVyZmFjZSwgRklFTERfRElTUExBWV9GT1JNQVR9IGZyb20gJ0BrZXBsZXIuZ2wvdXRpbHMnO1xuXG5leHBvcnQgdHlwZSBTYXZlZEZpZWxkID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbiAgZm9ybWF0Pzogc3RyaW5nO1xuICBhbmFseXplclR5cGU/OiBzdHJpbmc7XG59O1xuXG5leHBvcnQgdHlwZSBQYXJzZWRGaWVsZCA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICB0eXBlOiBzdHJpbmc7XG4gIGZvcm1hdDogc3RyaW5nO1xuICBhbmFseXplclR5cGU6IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIFNhdmVkRGF0YXNldFYxID0ge1xuICB2ZXJzaW9uOiAndjEnO1xuICBkYXRhOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIGNvbG9yOiBSR0JDb2xvcjtcbiAgICBhbGxEYXRhOiBhbnlbXVtdO1xuICAgIGZpZWxkczogU2F2ZWRGaWVsZFtdO1xuICAgIHR5cGU/OiBzdHJpbmc7XG4gICAgbWV0YWRhdGE/OiBKc29uT2JqZWN0O1xuICAgIGRpc2FibGVEYXRhT3BlcmF0aW9uPzogYm9vbGVhbjtcbiAgfTtcbn07XG5cbmV4cG9ydCB0eXBlIFBhcnNlZERhdGFzZXQgPSB7XG4gIGRhdGE6IHtcbiAgICBmaWVsZHM6IFBhcnNlZEZpZWxkW107XG4gICAgcm93czogYW55W11bXTtcbiAgfTtcbiAgaW5mbzoge1xuICAgIGlkPzogc3RyaW5nO1xuICAgIGxhYmVsPzogc3RyaW5nO1xuICAgIGNvbG9yPzogUkdCQ29sb3I7XG4gIH07XG59O1xuXG4vLyB2ZXJzaW9uIHYwXG5leHBvcnQgY29uc3QgZmllbGRQcm9wZXJ0aWVzVjAgPSB7XG4gIG5hbWU6IG51bGwsXG4gIHR5cGU6IG51bGxcbn07XG5cbmV4cG9ydCBjb25zdCBmaWVsZFByb3BlcnRpZXNWMSA9IHtcbiAgbmFtZTogbnVsbCxcbiAgdHlwZTogbnVsbCxcbiAgZm9ybWF0OiBudWxsLFxuICBhbmFseXplclR5cGU6IG51bGwsXG4gIG1ldGFkYXRhOiBudWxsXG59O1xuXG5leHBvcnQgY2xhc3MgRmllbGRTY2hlbWEgZXh0ZW5kcyBTY2hlbWEge1xuICBzYXZlKGZpZWxkcykge1xuICAgIHJldHVybiB7XG4gICAgICBbdGhpcy5rZXldOiBmaWVsZHMubWFwKGYgPT4gdGhpcy5zYXZlUHJvcGVydGllc09yQXBwbHlTY2hlbWEoZilbdGhpcy5rZXldKVxuICAgIH07XG4gIH1cbiAgbG9hZChmaWVsZHMpIHtcbiAgICByZXR1cm4ge1t0aGlzLmtleV06IGZpZWxkc307XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHByb3BlcnRpZXNWMCA9IHtcbiAgaWQ6IG51bGwsXG4gIGxhYmVsOiBudWxsLFxuICBjb2xvcjogbnVsbCxcbiAgYWxsRGF0YTogbnVsbCxcbiAgZmllbGRzOiBuZXcgRmllbGRTY2hlbWEoe1xuICAgIGtleTogJ2ZpZWxkcycsXG4gICAgdmVyc2lvbjogVkVSU0lPTlMudjAsXG4gICAgcHJvcGVydGllczogZmllbGRQcm9wZXJ0aWVzVjBcbiAgfSlcbn07XG5cbmV4cG9ydCBjb25zdCBwcm9wZXJ0aWVzVjEgPSB7XG4gIC4uLnByb3BlcnRpZXNWMCxcbiAgZmllbGRzOiBuZXcgRmllbGRTY2hlbWEoe1xuICAgIGtleTogJ2ZpZWxkcycsXG4gICAgdmVyc2lvbjogVkVSU0lPTlMudjEsXG4gICAgcHJvcGVydGllczogZmllbGRQcm9wZXJ0aWVzVjFcbiAgfSksXG4gIHR5cGU6IG51bGwsXG4gIG1ldGFkYXRhOiBudWxsLFxuICBkaXNhYmxlRGF0YU9wZXJhdGlvbjogbnVsbFxufTtcblxuLyoqXG4gKiBUT0RPIENvbnNpZGVyIG1vdmluZyB0aGlzIGNhc3QgdG8gQXJyb3dEYXRhQ29udGFpbmVyP1xuICogUHJlcGFyZSBhIGRhdGEgY29udGFpbmVyIGZvciBleHBvcnQgYXMgcGFydCBvZiBqc29uIC8gaHRtbCBmaWxlcy5cbiAqIDEpIEFycm93IHRhYmxlcyBjYW4gc3RvcmUgVGltZXN0YW1wcyBhcyBCaWdJbnRzLCBzbyBjb252ZXJ0IG51bWJlcnMgdG8gSVNPU3RyaW5ncyBjb21wYXRpYmxlIHdpdGggS2VwbGVyLmdsJ3MgVElNRVNUQU1QLlxuICogMikgR2VvYXJyb3cgYmluYXJ5IGJ1ZmZlcnMgY29udmVydGVkIHRvIGhleCB3a2JcbiAqIEBwYXJhbSBkYXRhQ29udGFpbmVyIEEgZGF0YSBjb250YWluZXIgdG8gZmxhdHRlbi5cbiAqIEByZXR1cm5zIFJvdyBiYXNlZCBkYXRhLlxuICovXG5jb25zdCBnZXRBbGxEYXRhRm9yU2F2aW5nID0gKGRhdGFDb250YWluZXI6IERhdGFDb250YWluZXJJbnRlcmZhY2UpOiBhbnlbXVtdID0+IHtcbiAgY29uc3QgYWxsRGF0YSA9IGRhdGFDb250YWluZXIuZmxhdHRlbkRhdGEoKTtcblxuICBpZiAoZGF0YUNvbnRhaW5lciBpbnN0YW5jZW9mIEFycm93RGF0YUNvbnRhaW5lcikge1xuICAgIGNvbnN0IG51bUNvbHVtbnMgPSBkYXRhQ29udGFpbmVyLm51bUNvbHVtbnMoKTtcblxuICAgIGZvciAobGV0IGNvbHVtbkluZGV4ID0gMDsgY29sdW1uSW5kZXggPCBudW1Db2x1bW5zOyArK2NvbHVtbkluZGV4KSB7XG4gICAgICBjb25zdCBjb2x1bW4gPSBkYXRhQ29udGFpbmVyLmdldENvbHVtbihjb2x1bW5JbmRleCk7XG4gICAgICBjb25zdCBmaWVsZCA9IGRhdGFDb250YWluZXIuZ2V0RmllbGQoY29sdW1uSW5kZXgpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIGFycm93LkRhdGFUeXBlLmlzVGltZXN0YW1wKGNvbHVtbi50eXBlKSB8fFxuICAgICAgICBhcnJvdy5EYXRhVHlwZS5pc0RhdGUoY29sdW1uLnR5cGUpIHx8XG4gICAgICAgIGFycm93LkRhdGFUeXBlLmlzVGltZShjb2x1bW4udHlwZSlcbiAgICAgICkge1xuICAgICAgICBhbGxEYXRhLmZvckVhY2gocm93ID0+IHtcbiAgICAgICAgICByb3dbY29sdW1uSW5kZXhdID0gbmV3IERhdGUocm93W2NvbHVtbkluZGV4XSkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGZpZWxkPy50eXBlID09PSBBTExfRklFTERfVFlQRVMuZ2VvYXJyb3cpIHtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVyID0gRklFTERfRElTUExBWV9GT1JNQVRbQUxMX0ZJRUxEX1RZUEVTLmdlb2Fycm93XTtcbiAgICAgICAgYWxsRGF0YS5mb3JFYWNoKHJvdyA9PiB7XG4gICAgICAgICAgcm93W2NvbHVtbkluZGV4XSA9IGZvcm1hdHRlcihyb3dbY29sdW1uSW5kZXhdLCBmaWVsZCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhbGxEYXRhO1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIGZpZWxkcyBmb3Igc2F2aW5nIGFzIHBhcnQgb2YganNvbiAvIGh0bWwgZmlsZXMuXG4gKiBAcGFyYW0gZmllbGRzIFRoZSBhcnJheSBvZiBmaWVsZHMgZnJvbSBhIEtlcGxlciB0YWJsZS5cbiAqIEByZXR1cm5zIFRoZSB0cmFuc2Zvcm1lZCBmaWVsZHMgYXJyYXkgd2l0aCBHZW9BcnJvdyB0eXBlcyB1cGRhdGVkIHRvIEdlb0pTT04uXG4gKi9cbmNvbnN0IGdldEZpZWxkc0ZvclNhdmluZyA9IChmaWVsZHM6IEtlcGxlclRhYmxlWydmaWVsZHMnXSkgPT4ge1xuICByZXR1cm4gZmllbGRzLm1hcChmaWVsZCA9PiB7XG4gICAgaWYgKGZpZWxkLnR5cGUgPT09IEFMTF9GSUVMRF9UWVBFUy5nZW9hcnJvdykge1xuICAgICAgLy8gZ2VvYXJyb3cgYmluYXJ5IGRhdGEgaXMgdHJhbnNmb3JtZWQgdG8gaGV4IHdrYiBpbiBnZXRBbGxEYXRhRm9yU2F2aW5nLCBzbyB1cGRhdGUgdGhlIGZpZWxkIGFjY29yZGluZ2x5XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgICB0eXBlOiBBTExfRklFTERfVFlQRVMuZ2VvanNvbixcbiAgICAgICAgZm9ybWF0OiAnJyxcbiAgICAgICAgYW5hbHl6ZXJUeXBlOiAnR0VPTUVUUlknXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZmllbGQ7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNsYXNzIERhdGFzZXRTY2hlbWEgZXh0ZW5kcyBTY2hlbWEge1xuICBrZXkgPSAnZGF0YXNldCc7XG5cbiAgc2F2ZShkYXRhc2V0OiBLZXBsZXJUYWJsZSk6IFNhdmVkRGF0YXNldFYxWydkYXRhJ10ge1xuICAgIGNvbnN0IGRhdGFzZXRGbGF0dGVuZWQgPSBkYXRhc2V0LmRhdGFDb250YWluZXJcbiAgICAgID8ge1xuICAgICAgICAgIC4uLmRhdGFzZXQsXG4gICAgICAgICAgYWxsRGF0YTogZ2V0QWxsRGF0YUZvclNhdmluZyhkYXRhc2V0LmRhdGFDb250YWluZXIpLFxuICAgICAgICAgIGZpZWxkczogZ2V0RmllbGRzRm9yU2F2aW5nKGRhdGFzZXQuZmllbGRzKSxcbiAgICAgICAgICAvLyB3ZSB1c2UgZmxhdHRlbkRhdGEgdG8gc2F2ZSBhcnJvdyB0YWJsZXMsXG4gICAgICAgICAgLy8gYnV0IG9uY2UgZmxhdHRlbmVkIGl0J3Mgbm90IGFuIGFycm93IGZpbGUgYW55bW9yZS5cbiAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgLi4uZGF0YXNldC5tZXRhZGF0YSxcbiAgICAgICAgICAgIC4uLihkYXRhc2V0Lm1ldGFkYXRhLmZvcm1hdCA9PT0gREFUQVNFVF9GT1JNQVRTLmFycm93XG4gICAgICAgICAgICAgID8ge2Zvcm1hdDogREFUQVNFVF9GT1JNQVRTLnJvd31cbiAgICAgICAgICAgICAgOiB7fSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIDogZGF0YXNldDtcblxuICAgIHJldHVybiB0aGlzLnNhdmVQcm9wZXJ0aWVzT3JBcHBseVNjaGVtYShkYXRhc2V0RmxhdHRlbmVkKVt0aGlzLmtleV07XG4gIH1cbiAgbG9hZChkYXRhc2V0OiBTYXZlZERhdGFzZXRWMVsnZGF0YSddKTogUHJvdG9EYXRhc2V0IHtcbiAgICBjb25zdCB7ZmllbGRzLCBhbGxEYXRhfSA9IGRhdGFzZXQ7XG4gICAgbGV0IHVwZGF0ZWRGaWVsZHMgPSBmaWVsZHM7XG5cbiAgICAvLyByZWNhbGN1bGF0ZSBmaWVsZCB0eXBlXG4gICAgLy8gYmVjYXVzZSB3ZSBoYXZlIHVwZGF0ZWQgdHlwZS1hbmFseXplclxuICAgIC8vIHdlIG5lZWQgdG8gYWRkIGZvcm1hdCB0byBlYWNoIGZpZWxkXG4gICAgY29uc3QgbmVlZENhbGN1bGF0ZU1ldGEgPVxuICAgICAgZmllbGRzWzBdICYmXG4gICAgICAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChmaWVsZHNbMF0sICdmb3JtYXQnKSB8fFxuICAgICAgICAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGZpZWxkc1swXSwgJ2FuYWx5emVyVHlwZScpKTtcblxuICAgIGlmIChuZWVkQ2FsY3VsYXRlTWV0YSkge1xuICAgICAgY29uc3QgZmllbGRPcmRlciA9IGZpZWxkcy5tYXAoZiA9PiBmLm5hbWUpO1xuXG4gICAgICBjb25zdCBzYW1wbGVEYXRhID0gZ2V0U2FtcGxlRm9yVHlwZUFuYWx5emUoe1xuICAgICAgICBmaWVsZHM6IGZpZWxkT3JkZXIsXG4gICAgICAgIHJvd3M6IGFsbERhdGFcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbWV0YSA9IGdldEZpZWxkc0Zyb21EYXRhKHNhbXBsZURhdGEsIGZpZWxkT3JkZXIpO1xuXG4gICAgICB1cGRhdGVkRmllbGRzID0gbWV0YS5tYXAoKGYsIGkpID0+ICh7XG4gICAgICAgIC4uLnBpY2sobWV0YVtpXSwgWyduYW1lJywgJ3R5cGUnLCAnZm9ybWF0J10pLFxuICAgICAgICBhbmFseXplclR5cGU6IG1ldGFbaV0uYW5hbHl6ZXJUeXBlXG4gICAgICB9KSk7XG5cbiAgICAgIHVwZGF0ZWRGaWVsZHMuZm9yRWFjaCgoZiwgaSkgPT4ge1xuICAgICAgICBpZiAoZmllbGRzW2ldLnR5cGUgIT09IGYudHlwZSkge1xuICAgICAgICAgIC8vIGlmIG5ld2x5IGRldGVjdGVkIGZpZWxkIHR5cGUgaXMgZGlmZmVyZW50IGZyb20gc2F2ZWQgdHlwZVxuICAgICAgICAgIC8vIHdlIGxvZyBpdCBidXQgd29uJ3QgdXBkYXRlIGl0LCBjYXVzZSB3ZSBkb24ndCB3YW50IHRvIGJyZWFrIHBlb3BsZSdzIG1hcFxuICAgICAgICAgIGdsb2JhbENvbnNvbGUud2FybihgZGV0ZWN0ICR7Zi5uYW1lfSB0eXBlIGlzIG5vdyAke2YudHlwZX0gaW5zdGVhZCBvZiAke2ZpZWxkc1tpXS50eXBlfWApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBnZXQgZm9ybWF0IG9mIGFsbCBmaWVsZHNcbiAgICByZXR1cm4ge1xuICAgICAgZGF0YToge2ZpZWxkczogdXBkYXRlZEZpZWxkcywgcm93czogZGF0YXNldC5hbGxEYXRhfSxcbiAgICAgIGluZm86IHBpY2soZGF0YXNldCwgWydpZCcsICdsYWJlbCcsICdjb2xvcicsICd0eXBlJ10pLFxuICAgICAgLi4uKGRhdGFzZXQubWV0YWRhdGEgPyB7bWV0YWRhdGE6IGRhdGFzZXQubWV0YWRhdGF9IDoge30pLFxuICAgICAgLi4uKGRhdGFzZXQuZGlzYWJsZURhdGFPcGVyYXRpb24gPyB7ZGlzYWJsZURhdGFPcGVyYXRpb246IGRhdGFzZXQuZGlzYWJsZURhdGFPcGVyYXRpb259IDoge30pXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgZGF0YXNldFNjaGVtYSA9IHtcbiAgW1ZFUlNJT05TLnYwXTogbmV3IERhdGFzZXRTY2hlbWEoe1xuICAgIGtleTogJ2RhdGFzZXQnLFxuICAgIHZlcnNpb246IFZFUlNJT05TLnYwLFxuICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXNWMFxuICB9KSxcbiAgW1ZFUlNJT05TLnYxXTogbmV3IERhdGFzZXRTY2hlbWEoe1xuICAgIGtleTogJ2RhdGFzZXQnLFxuICAgIHZlcnNpb246IFZFUlNJT05TLnYxLFxuICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXNWMVxuICB9KVxufTtcblxuZXhwb3J0IGRlZmF1bHQgZGF0YXNldFNjaGVtYTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFHQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFDLHVCQUFBLENBQUFILE9BQUE7QUFFQSxJQUFBSSxVQUFBLEdBQUFKLE9BQUE7QUFHQSxJQUFBSyxTQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSxP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O1VBQzlCLElBQUkyQyxNQUFNLENBQUMzQyxDQUFDLENBQUMsQ0FBQzhCLElBQUksS0FBS2dCLENBQUMsQ0FBQ2hCLElBQUksRUFBRTtZQUM3QjtZQUNBO1lBQ0E0RSxlQUFhLENBQUNDLElBQUksV0FBQWQsTUFBQSxDQUFXL0MsQ0FBQyxDQUFDakIsSUFBSSxtQkFBQWdFLE1BQUEsQ0FBZ0IvQyxDQUFDLENBQUNoQixJQUFJLGtCQUFBK0QsTUFBQSxDQUFlbEQsTUFBTSxDQUFDM0MsQ0FBQyxDQUFDLENBQUM4QixJQUFJLENBQUUsQ0FBQztVQUMzRjtRQUNGLENBQUMsQ0FBQztNQUNKOztNQUVBO01BQ0EsT0FBQXBCLGFBQUEsQ0FBQUEsYUFBQTtRQUNFa0csSUFBSSxFQUFFO1VBQUNqRSxNQUFNLEVBQUVzRCxhQUFhO1VBQUVLLElBQUksRUFBRVIsT0FBTyxDQUFDeEM7UUFBTyxDQUFDO1FBQ3BEdUQsSUFBSSxFQUFFLElBQUFKLGtCQUFJLEVBQUNYLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQztNQUFDLEdBQ2pEQSxPQUFPLENBQUM1RCxRQUFRLEdBQUc7UUFBQ0EsUUFBUSxFQUFFNEQsT0FBTyxDQUFDNUQ7TUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQ3BENEQsT0FBTyxDQUFDakMsb0JBQW9CLEdBQUc7UUFBQ0Esb0JBQW9CLEVBQUVpQyxPQUFPLENBQUNqQztNQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWhHO0VBQUM7QUFBQSxFQWhFZ0NaLGtCQUFNO0FBbUVsQyxJQUFNNkQsYUFBYSxHQUFBbEYsT0FBQSxDQUFBa0YsYUFBQSxPQUFBaEcsZ0JBQUEsaUJBQUFBLGdCQUFBLGlCQUN2QjBDLGtCQUFRLENBQUNDLEVBQUUsRUFBRyxJQUFJNkIsYUFBYSxDQUFDO0VBQy9COUMsR0FBRyxFQUFFLFNBQVM7RUFDZGUsT0FBTyxFQUFFQyxrQkFBUSxDQUFDQyxFQUFFO0VBQ3BCQyxVQUFVLEVBQUVSO0FBQ2QsQ0FBQyxDQUFDLEdBQ0RNLGtCQUFRLENBQUNJLEVBQUUsRUFBRyxJQUFJMEIsYUFBYSxDQUFDO0VBQy9COUMsR0FBRyxFQUFFLFNBQVM7RUFDZGUsT0FBTyxFQUFFQyxrQkFBUSxDQUFDSSxFQUFFO0VBQ3BCRixVQUFVLEVBQUVDO0FBQ2QsQ0FBQyxDQUFDLENBQ0g7QUFBQyxJQUFBb0QsUUFBQSxHQUFBbkYsT0FBQSxjQUVha0YsYUFBYSIsImlnbm9yZUxpc3QiOltdfQ==