"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createNewDataEntry = createNewDataEntry;
exports.getNewDatasetColor = getNewDatasetColor;
exports.getWMSCapabilities = getWMSCapabilities;
exports.wmsCapabilitiesToDatasetMetadata = wmsCapabilitiesToDatasetMetadata;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));
var _uniq = _interopRequireDefault(require("lodash/uniq"));
var _keplerTable = _interopRequireDefault(require("./kepler-table"));
var _tasks = _interopRequireDefault(require("react-palm/tasks"));
var _constants = require("@kepler.gl/constants");
var _utils = require("@kepler.gl/utils");
var _core = require("@loaders.gl/core");
var _pmtiles = require("@loaders.gl/pmtiles");
var _wms = require("@loaders.gl/wms");
var _tilesetUtils = require("./tileset/tileset-utils");
var _rasterTileUtils = require("./tileset/raster-tile-utils");
var _vectorTileUtils = require("./tileset/vector-tile-utils");
var _excluded = ["info", "data"]; // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2["default"])(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
// apply a color for each dataset
// to use as label colors
var datasetColors = ['#8F2FBF', '#005CFF', '#C06C84', '#F8B195', '#547A82', '#3EACA8', '#A2D4AB'].map(_utils.hexToRgb);
function getNewDatasetColor(datasets) {
  var presetColors = datasetColors.map(String);
  var usedColors = (0, _uniq["default"])(Object.values(datasets).map(function (d) {
    return String(d.color);
  })).filter(function (c) {
    return presetColors.includes(c);
  });
  if (usedColors.length === presetColors.length) {
    // if we already depleted the pool of color
    return _utils.datasetColorMaker.next().value;
  }
  var color = _utils.datasetColorMaker.next().value;
  while (usedColors.includes(String(color))) {
    color = _utils.datasetColorMaker.next().value;
  }
  return color;
}

/**
 * Take datasets payload from addDataToMap, create datasets entry save to visState
 */
function createNewDataEntry(_ref) {
  var _getApplicationConfig;
  var info = _ref.info,
    data = _ref.data,
    opts = (0, _objectWithoutProperties2["default"])(_ref, _excluded);
  var datasets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var TableClass = (_getApplicationConfig = (0, _utils.getApplicationConfig)().table) !== null && _getApplicationConfig !== void 0 ? _getApplicationConfig : _keplerTable["default"];
  var dataValidator = _utils.validateInputData;
  if (typeof TableClass.getInputDataValidator === 'function') {
    dataValidator = TableClass.getInputDataValidator();
  }
  var validatedData = dataValidator(data);
  if (!validatedData) {
    return null;
  }

  // check if dataset already exists, and update it when loading data by batches incrementally
  if (info && info.id && datasets[info.id]) {
    // get keplerTable from datasets
    var keplerTable = datasets[info.id];
    // update the data in keplerTable
    return UPDATE_TABLE_TASK({
      table: keplerTable,
      data: validatedData
    });
  }
  info = info || {};
  var color = info.color || getNewDatasetColor(datasets);
  return CREATE_TABLE_TASK({
    info: info,
    color: color,
    opts: opts,
    data: validatedData
  });
}
function updateTable(_x) {
  return _updateTable.apply(this, arguments);
}
function _updateTable() {
  _updateTable = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(_ref2) {
    var table, data, updated;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) switch (_context.prev = _context.next) {
        case 0:
          table = _ref2.table, data = _ref2.data;
          _context.next = 3;
          return table.update(data);
        case 3:
          updated = _context.sent;
          return _context.abrupt("return", updated);
        case 5:
        case "end":
          return _context.stop();
      }
    }, _callee);
  }));
  return _updateTable.apply(this, arguments);
}
function createTable(_x2) {
  return _createTable.apply(this, arguments);
}
function _createTable() {
  _createTable = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(datasetInfo) {
    var _getApplicationConfig2;
    var info, color, opts, data, refreshedMetadata, metadata, TableClass, table;
    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) switch (_context2.prev = _context2.next) {
        case 0:
          info = datasetInfo.info, color = datasetInfo.color, opts = datasetInfo.opts, data = datasetInfo.data; // update metadata for remote tiled datasets
          _context2.next = 3;
          return refreshRemoteData(datasetInfo);
        case 3:
          refreshedMetadata = _context2.sent;
          metadata = opts.metadata;
          if (refreshedMetadata) {
            metadata = _objectSpread(_objectSpread({}, opts.metadata), refreshedMetadata);
            if (metadata.fields) {
              data.fields = metadata.fields;
            }
          }
          TableClass = (_getApplicationConfig2 = (0, _utils.getApplicationConfig)().table) !== null && _getApplicationConfig2 !== void 0 ? _getApplicationConfig2 : _keplerTable["default"];
          table = new TableClass(_objectSpread(_objectSpread({
            info: info,
            color: color
          }, opts), {}, {
            metadata: metadata
          }));
          _context2.next = 10;
          return table.importData({
            data: data
          });
        case 10:
          return _context2.abrupt("return", table);
        case 11:
        case "end":
          return _context2.stop();
      }
    }, _callee2);
  }));
  return _createTable.apply(this, arguments);
}
var UPDATE_TABLE_TASK = _tasks["default"].fromPromise(updateTable, 'UPDATE_TABLE_TASK');
var CREATE_TABLE_TASK = _tasks["default"].fromPromise(createTable, 'CREATE_TABLE_TASK');

/**
 * Fetch metadata for vector tile layers using tilesetMetadataUrl from metadata
 * @param datasetInfo
 * @returns
 */
function refreshRemoteData(_x3) {
  return _refreshRemoteData.apply(this, arguments);
}
function _refreshRemoteData() {
  _refreshRemoteData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(datasetInfo) {
    var type;
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) switch (_context3.prev = _context3.next) {
        case 0:
          type = datasetInfo.info.type;
          _context3.t0 = type;
          _context3.next = _context3.t0 === _constants.DatasetType.VECTOR_TILE ? 4 : _context3.t0 === _constants.DatasetType.RASTER_TILE ? 7 : _context3.t0 === _constants.DatasetType.WMS_TILE ? 10 : 13;
          break;
        case 4:
          _context3.next = 6;
          return refreshVectorTileMetadata(datasetInfo);
        case 6:
          return _context3.abrupt("return", _context3.sent);
        case 7:
          _context3.next = 9;
          return refreshRasterTileMetadata(datasetInfo);
        case 9:
          return _context3.abrupt("return", _context3.sent);
        case 10:
          _context3.next = 12;
          return refreshWMSMetadata(datasetInfo);
        case 12:
          return _context3.abrupt("return", _context3.sent);
        case 13:
          return _context3.abrupt("return", null);
        case 14:
        case "end":
          return _context3.stop();
      }
    }, _callee3);
  }));
  return _refreshRemoteData.apply(this, arguments);
}
function refreshVectorTileMetadata(_x4) {
  return _refreshVectorTileMetadata.apply(this, arguments);
}
function _refreshVectorTileMetadata() {
  _refreshVectorTileMetadata = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(datasetInfo) {
    var _ref3, remoteTileFormat, tilesetMetadataUrl, tilesetDataUrl, rawMetadata, tileSource, metadata;
    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) switch (_context4.prev = _context4.next) {
        case 0:
          _ref3 = datasetInfo.opts.metadata || {}, remoteTileFormat = _ref3.remoteTileFormat, tilesetMetadataUrl = _ref3.tilesetMetadataUrl, tilesetDataUrl = _ref3.tilesetDataUrl;
          if (!(!(remoteTileFormat === _constants.RemoteTileFormat.PMTILES || remoteTileFormat === _constants.RemoteTileFormat.MVT) || typeof tilesetMetadataUrl !== 'string' || typeof tilesetDataUrl !== 'string')) {
            _context4.next = 3;
            break;
          }
          return _context4.abrupt("return", null);
        case 3:
          _context4.prev = 3;
          rawMetadata = null;
          if (!(remoteTileFormat === _constants.RemoteTileFormat.MVT)) {
            _context4.next = 11;
            break;
          }
          _context4.next = 8;
          return (0, _tilesetUtils.getMVTMetadata)(tilesetMetadataUrl);
        case 8:
          rawMetadata = _context4.sent;
          _context4.next = 15;
          break;
        case 11:
          tileSource = _pmtiles.PMTilesSource.createDataSource(tilesetMetadataUrl, {});
          _context4.next = 14;
          return tileSource.metadata;
        case 14:
          rawMetadata = _context4.sent;
        case 15:
          if (!rawMetadata) {
            _context4.next = 20;
            break;
          }
          metadata = (0, _vectorTileUtils.parseVectorMetadata)(rawMetadata);
          _context4.next = 19;
          return (0, _vectorTileUtils.getFieldsFromTile)({
            remoteTileFormat: remoteTileFormat,
            tilesetUrl: tilesetDataUrl,
            metadataUrl: tilesetMetadataUrl,
            metadata: metadata
          });
        case 19:
          return _context4.abrupt("return", metadata);
        case 20:
          _context4.next = 24;
          break;
        case 22:
          _context4.prev = 22;
          _context4.t0 = _context4["catch"](3);
        case 24:
          return _context4.abrupt("return", null);
        case 25:
        case "end":
          return _context4.stop();
      }
    }, _callee4, null, [[3, 22]]);
  }));
  return _refreshVectorTileMetadata.apply(this, arguments);
}
function refreshRasterTileMetadata(_x5) {
  return _refreshRasterTileMetadata.apply(this, arguments);
}
function _refreshRasterTileMetadata() {
  _refreshRasterTileMetadata = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(datasetInfo) {
    var _ref4, metadataUrl, pmtilesType, tileSource, rawMetadata, response, _rawMetadata, metadata;
    return _regenerator["default"].wrap(function _callee5$(_context5) {
      while (1) switch (_context5.prev = _context5.next) {
        case 0:
          _ref4 = datasetInfo.opts.metadata || {}, metadataUrl = _ref4.metadataUrl, pmtilesType = _ref4.pmtilesType;
          if (!(typeof metadataUrl !== 'string')) {
            _context5.next = 3;
            break;
          }
          return _context5.abrupt("return", null);
        case 3:
          _context5.prev = 3;
          if (!(pmtilesType === _constants.PMTilesType.RASTER)) {
            _context5.next = 13;
            break;
          }
          tileSource = _pmtiles.PMTilesSource.createDataSource(metadataUrl, {});
          _context5.next = 8;
          return tileSource.metadata;
        case 8:
          rawMetadata = _context5.sent;
          if (!rawMetadata) {
            _context5.next = 11;
            break;
          }
          return _context5.abrupt("return", (0, _vectorTileUtils.parseVectorMetadata)(rawMetadata));
        case 11:
          _context5.next = 25;
          break;
        case 13:
          _context5.next = 15;
          return fetch(metadataUrl);
        case 15:
          response = _context5.sent;
          if (response.ok) {
            _context5.next = 18;
            break;
          }
          throw new Error("Failed Fetch ".concat(metadataUrl));
        case 18:
          _context5.next = 20;
          return response.json();
        case 20:
          _rawMetadata = _context5.sent;
          metadata = (0, _rasterTileUtils.parseRasterMetadata)(_rawMetadata, {
            allowCollections: true
          });
          if (!(metadata instanceof Error)) {
            _context5.next = 24;
            break;
          }
          throw new Error("Failed to parse metadata ".concat(metadata.message));
        case 24:
          return _context5.abrupt("return", metadata);
        case 25:
          _context5.next = 29;
          break;
        case 27:
          _context5.prev = 27;
          _context5.t0 = _context5["catch"](3);
        case 29:
          return _context5.abrupt("return", null);
        case 30:
        case "end":
          return _context5.stop();
      }
    }, _callee5, null, [[3, 27]]);
  }));
  return _refreshRasterTileMetadata.apply(this, arguments);
}
function refreshWMSMetadata(_x6) {
  return _refreshWMSMetadata.apply(this, arguments);
}
function _refreshWMSMetadata() {
  _refreshWMSMetadata = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(datasetInfo) {
    var _ref5, remoteTileFormat, tilesetDataUrl, data;
    return _regenerator["default"].wrap(function _callee6$(_context6) {
      while (1) switch (_context6.prev = _context6.next) {
        case 0:
          _ref5 = datasetInfo.opts.metadata || {}, remoteTileFormat = _ref5.remoteTileFormat, tilesetDataUrl = _ref5.tilesetDataUrl;
          if (!(remoteTileFormat !== _constants.RemoteTileFormat.WMS || typeof tilesetDataUrl !== 'string')) {
            _context6.next = 3;
            break;
          }
          return _context6.abrupt("return", null);
        case 3:
          _context6.prev = 3;
          _context6.next = 6;
          return getWMSCapabilities(tilesetDataUrl);
        case 6:
          data = _context6.sent;
          return _context6.abrupt("return", wmsCapabilitiesToDatasetMetadata(data));
        case 10:
          _context6.prev = 10;
          _context6.t0 = _context6["catch"](3);
        case 12:
          return _context6.abrupt("return", null);
        case 13:
        case "end":
          return _context6.stop();
      }
    }, _callee6, null, [[3, 10]]);
  }));
  return _refreshWMSMetadata.apply(this, arguments);
}
function getWMSCapabilities(_x7) {
  return _getWMSCapabilities.apply(this, arguments);
}
function _getWMSCapabilities() {
  _getWMSCapabilities = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(wsmUrl) {
    return _regenerator["default"].wrap(function _callee7$(_context7) {
      while (1) switch (_context7.prev = _context7.next) {
        case 0:
          _context7.next = 2;
          return (0, _core.load)("".concat(wsmUrl, "?service=WMS&request=GetCapabilities"), _wms.WMSCapabilitiesLoader);
        case 2:
          return _context7.abrupt("return", _context7.sent);
        case 3:
        case "end":
          return _context7.stop();
      }
    }, _callee7);
  }));
  return _getWMSCapabilities.apply(this, arguments);
}
function wmsCapabilitiesToDatasetMetadata(capabilities) {
  // Flatten layers if they are nested
  var layers = capabilities.layers.flatMap(function (layer) {
    if (layer.layers && layer.layers.length > 0) {
      return layer.layers;
    }
    return layer;
  });
  var availableLayers = [];
  if (Array.isArray(layers)) {
    availableLayers = layers.map(function (layer) {
      var bb = layer.geographicBoundingBox;
      var boundingBox = null;
      if (Array.isArray(bb) && Array.isArray(bb[0]) && Array.isArray(bb[1])) {
        boundingBox = [bb[0][0], bb[0][1], bb[1][0], bb[1][1]];
      }
      return {
        name: layer.name,
        title: layer.title || layer.name,
        boundingBox: boundingBox,
        queryable: layer.queryable
      };
    });
  }
  return {
    layers: availableLayers,
    version: capabilities.version || '1.3.0'
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdW5pcSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2tlcGxlclRhYmxlIiwiX3Rhc2tzIiwiX2NvbnN0YW50cyIsIl91dGlscyIsIl9jb3JlIiwiX3BtdGlsZXMiLCJfd21zIiwiX3RpbGVzZXRVdGlscyIsIl9yYXN0ZXJUaWxlVXRpbHMiLCJfdmVjdG9yVGlsZVV0aWxzIiwiX2V4Y2x1ZGVkIiwib3duS2V5cyIsImUiLCJyIiwidCIsIk9iamVjdCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJkYXRhc2V0Q29sb3JzIiwibWFwIiwiaGV4VG9SZ2IiLCJnZXROZXdEYXRhc2V0Q29sb3IiLCJkYXRhc2V0cyIsInByZXNldENvbG9ycyIsIlN0cmluZyIsInVzZWRDb2xvcnMiLCJ1bmlxIiwidmFsdWVzIiwiZCIsImNvbG9yIiwiYyIsImluY2x1ZGVzIiwiZGF0YXNldENvbG9yTWFrZXIiLCJuZXh0IiwidmFsdWUiLCJjcmVhdGVOZXdEYXRhRW50cnkiLCJfcmVmIiwiX2dldEFwcGxpY2F0aW9uQ29uZmlnIiwiaW5mbyIsImRhdGEiLCJvcHRzIiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzMiIsInVuZGVmaW5lZCIsIlRhYmxlQ2xhc3MiLCJnZXRBcHBsaWNhdGlvbkNvbmZpZyIsInRhYmxlIiwiS2VwbGVyVGFibGUiLCJkYXRhVmFsaWRhdG9yIiwidmFsaWRhdGVJbnB1dERhdGEiLCJnZXRJbnB1dERhdGFWYWxpZGF0b3IiLCJ2YWxpZGF0ZWREYXRhIiwiaWQiLCJrZXBsZXJUYWJsZSIsIlVQREFURV9UQUJMRV9UQVNLIiwiQ1JFQVRFX1RBQkxFX1RBU0siLCJ1cGRhdGVUYWJsZSIsIl94IiwiX3VwZGF0ZVRhYmxlIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiX3JlZ2VuZXJhdG9yIiwibWFyayIsIl9jYWxsZWUiLCJfcmVmMiIsInVwZGF0ZWQiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dCIsInByZXYiLCJ1cGRhdGUiLCJzZW50IiwiYWJydXB0Iiwic3RvcCIsImNyZWF0ZVRhYmxlIiwiX3gyIiwiX2NyZWF0ZVRhYmxlIiwiX2NhbGxlZTIiLCJkYXRhc2V0SW5mbyIsIl9nZXRBcHBsaWNhdGlvbkNvbmZpZzIiLCJyZWZyZXNoZWRNZXRhZGF0YSIsIm1ldGFkYXRhIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQyIiwicmVmcmVzaFJlbW90ZURhdGEiLCJmaWVsZHMiLCJpbXBvcnREYXRhIiwiVGFzayIsImZyb21Qcm9taXNlIiwiX3gzIiwiX3JlZnJlc2hSZW1vdGVEYXRhIiwiX2NhbGxlZTMiLCJ0eXBlIiwiX2NhbGxlZTMkIiwiX2NvbnRleHQzIiwidDAiLCJEYXRhc2V0VHlwZSIsIlZFQ1RPUl9USUxFIiwiUkFTVEVSX1RJTEUiLCJXTVNfVElMRSIsInJlZnJlc2hWZWN0b3JUaWxlTWV0YWRhdGEiLCJyZWZyZXNoUmFzdGVyVGlsZU1ldGFkYXRhIiwicmVmcmVzaFdNU01ldGFkYXRhIiwiX3g0IiwiX3JlZnJlc2hWZWN0b3JUaWxlTWV0YWRhdGEiLCJfY2FsbGVlNCIsIl9yZWYzIiwicmVtb3RlVGlsZUZvcm1hdCIsInRpbGVzZXRNZXRhZGF0YVVybCIsInRpbGVzZXREYXRhVXJsIiwicmF3TWV0YWRhdGEiLCJ0aWxlU291cmNlIiwiX2NhbGxlZTQkIiwiX2NvbnRleHQ0IiwiUmVtb3RlVGlsZUZvcm1hdCIsIlBNVElMRVMiLCJNVlQiLCJnZXRNVlRNZXRhZGF0YSIsIlBNVGlsZXNTb3VyY2UiLCJjcmVhdGVEYXRhU291cmNlIiwicGFyc2VWZWN0b3JNZXRhZGF0YSIsImdldEZpZWxkc0Zyb21UaWxlIiwidGlsZXNldFVybCIsIm1ldGFkYXRhVXJsIiwiX3g1IiwiX3JlZnJlc2hSYXN0ZXJUaWxlTWV0YWRhdGEiLCJfY2FsbGVlNSIsIl9yZWY0IiwicG10aWxlc1R5cGUiLCJyZXNwb25zZSIsIl9yYXdNZXRhZGF0YSIsIl9jYWxsZWU1JCIsIl9jb250ZXh0NSIsIlBNVGlsZXNUeXBlIiwiUkFTVEVSIiwiZmV0Y2giLCJvayIsIkVycm9yIiwiY29uY2F0IiwianNvbiIsInBhcnNlUmFzdGVyTWV0YWRhdGEiLCJhbGxvd0NvbGxlY3Rpb25zIiwibWVzc2FnZSIsIl94NiIsIl9yZWZyZXNoV01TTWV0YWRhdGEiLCJfY2FsbGVlNiIsIl9yZWY1IiwiX2NhbGxlZTYkIiwiX2NvbnRleHQ2IiwiV01TIiwiZ2V0V01TQ2FwYWJpbGl0aWVzIiwid21zQ2FwYWJpbGl0aWVzVG9EYXRhc2V0TWV0YWRhdGEiLCJfeDciLCJfZ2V0V01TQ2FwYWJpbGl0aWVzIiwiX2NhbGxlZTciLCJ3c21VcmwiLCJfY2FsbGVlNyQiLCJfY29udGV4dDciLCJsb2FkIiwiV01TQ2FwYWJpbGl0aWVzTG9hZGVyIiwiY2FwYWJpbGl0aWVzIiwibGF5ZXJzIiwiZmxhdE1hcCIsImxheWVyIiwiYXZhaWxhYmxlTGF5ZXJzIiwiQXJyYXkiLCJpc0FycmF5IiwiYmIiLCJnZW9ncmFwaGljQm91bmRpbmdCb3giLCJib3VuZGluZ0JveCIsIm5hbWUiLCJ0aXRsZSIsInF1ZXJ5YWJsZSIsInZlcnNpb24iXSwic291cmNlcyI6WyIuLi9zcmMvZGF0YXNldC11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQgdW5pcSBmcm9tICdsb2Rhc2gvdW5pcSc7XG5pbXBvcnQgS2VwbGVyVGFibGUsIHtEYXRhc2V0c30gZnJvbSAnLi9rZXBsZXItdGFibGUnO1xuaW1wb3J0IHtQcm90b0RhdGFzZXQsIFJHQkNvbG9yfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCBUYXNrIGZyb20gJ3JlYWN0LXBhbG0vdGFza3MnO1xuXG5pbXBvcnQge1xuICBEYXRhc2V0VHlwZSxcbiAgUmFzdGVyVGlsZURhdGFzZXRNZXRhZGF0YSxcbiAgUE1UaWxlc1R5cGUsXG4gIFJlbW90ZVRpbGVGb3JtYXQsXG4gIFZlY3RvclRpbGVEYXRhc2V0TWV0YWRhdGEsXG4gIFdNU0RhdGFzZXRNZXRhZGF0YVxufSBmcm9tICdAa2VwbGVyLmdsL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBoZXhUb1JnYixcbiAgdmFsaWRhdGVJbnB1dERhdGEsXG4gIGRhdGFzZXRDb2xvck1ha2VyLFxuICBnZXRBcHBsaWNhdGlvbkNvbmZpZ1xufSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcblxuaW1wb3J0IHtsb2FkfSBmcm9tICdAbG9hZGVycy5nbC9jb3JlJztcbmltcG9ydCB7LyogTVZUU291cmNlLCovIFRpbGVKU09OfSBmcm9tICdAbG9hZGVycy5nbC9tdnQnO1xuaW1wb3J0IHtQTVRpbGVzU291cmNlLCBQTVRpbGVzTWV0YWRhdGF9IGZyb20gJ0Bsb2FkZXJzLmdsL3BtdGlsZXMnO1xuaW1wb3J0IHtXTVNDYXBhYmlsaXRpZXMsIFdNU0NhcGFiaWxpdGllc0xvYWRlcn0gZnJvbSAnQGxvYWRlcnMuZ2wvd21zJztcblxuaW1wb3J0IHtnZXRNVlRNZXRhZGF0YX0gZnJvbSAnLi90aWxlc2V0L3RpbGVzZXQtdXRpbHMnO1xuaW1wb3J0IHtwYXJzZVJhc3Rlck1ldGFkYXRhfSBmcm9tICcuL3RpbGVzZXQvcmFzdGVyLXRpbGUtdXRpbHMnO1xuaW1wb3J0IHtcbiAgcGFyc2VWZWN0b3JNZXRhZGF0YSxcbiAgZ2V0RmllbGRzRnJvbVRpbGUsXG4gIFZlY3RvclRpbGVNZXRhZGF0YVxufSBmcm9tICcuL3RpbGVzZXQvdmVjdG9yLXRpbGUtdXRpbHMnO1xuXG4vLyBhcHBseSBhIGNvbG9yIGZvciBlYWNoIGRhdGFzZXRcbi8vIHRvIHVzZSBhcyBsYWJlbCBjb2xvcnNcbmNvbnN0IGRhdGFzZXRDb2xvcnMgPSBbXG4gICcjOEYyRkJGJyxcbiAgJyMwMDVDRkYnLFxuICAnI0MwNkM4NCcsXG4gICcjRjhCMTk1JyxcbiAgJyM1NDdBODInLFxuICAnIzNFQUNBOCcsXG4gICcjQTJENEFCJ1xuXS5tYXAoaGV4VG9SZ2IpO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmV3RGF0YXNldENvbG9yKGRhdGFzZXRzOiBEYXRhc2V0cyk6IFJHQkNvbG9yIHtcbiAgY29uc3QgcHJlc2V0Q29sb3JzID0gZGF0YXNldENvbG9ycy5tYXAoU3RyaW5nKTtcbiAgY29uc3QgdXNlZENvbG9ycyA9IHVuaXEoT2JqZWN0LnZhbHVlcyhkYXRhc2V0cykubWFwKGQgPT4gU3RyaW5nKGQuY29sb3IpKSkuZmlsdGVyKGMgPT5cbiAgICBwcmVzZXRDb2xvcnMuaW5jbHVkZXMoYylcbiAgKTtcblxuICBpZiAodXNlZENvbG9ycy5sZW5ndGggPT09IHByZXNldENvbG9ycy5sZW5ndGgpIHtcbiAgICAvLyBpZiB3ZSBhbHJlYWR5IGRlcGxldGVkIHRoZSBwb29sIG9mIGNvbG9yXG4gICAgcmV0dXJuIGRhdGFzZXRDb2xvck1ha2VyLm5leHQoKS52YWx1ZTtcbiAgfVxuXG4gIGxldCBjb2xvciA9IGRhdGFzZXRDb2xvck1ha2VyLm5leHQoKS52YWx1ZTtcbiAgd2hpbGUgKHVzZWRDb2xvcnMuaW5jbHVkZXMoU3RyaW5nKGNvbG9yKSkpIHtcbiAgICBjb2xvciA9IGRhdGFzZXRDb2xvck1ha2VyLm5leHQoKS52YWx1ZTtcbiAgfVxuXG4gIHJldHVybiBjb2xvcjtcbn1cblxuLyoqXG4gKiBUYWtlIGRhdGFzZXRzIHBheWxvYWQgZnJvbSBhZGREYXRhVG9NYXAsIGNyZWF0ZSBkYXRhc2V0cyBlbnRyeSBzYXZlIHRvIHZpc1N0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVOZXdEYXRhRW50cnkoXG4gIHtpbmZvLCBkYXRhLCAuLi5vcHRzfTogUHJvdG9EYXRhc2V0LFxuICBkYXRhc2V0czogRGF0YXNldHMgPSB7fVxuKTogRGF0YXNldHMgfCBudWxsIHtcbiAgY29uc3QgVGFibGVDbGFzcyA9IGdldEFwcGxpY2F0aW9uQ29uZmlnKCkudGFibGUgPz8gS2VwbGVyVGFibGU7XG4gIGxldCBkYXRhVmFsaWRhdG9yID0gdmFsaWRhdGVJbnB1dERhdGE7XG4gIGlmICh0eXBlb2YgVGFibGVDbGFzcy5nZXRJbnB1dERhdGFWYWxpZGF0b3IgPT09ICdmdW5jdGlvbicpIHtcbiAgICBkYXRhVmFsaWRhdG9yID0gVGFibGVDbGFzcy5nZXRJbnB1dERhdGFWYWxpZGF0b3IoKTtcbiAgfVxuXG4gIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBkYXRhVmFsaWRhdG9yKGRhdGEpO1xuICBpZiAoIXZhbGlkYXRlZERhdGEpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIGNoZWNrIGlmIGRhdGFzZXQgYWxyZWFkeSBleGlzdHMsIGFuZCB1cGRhdGUgaXQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgYmF0Y2hlcyBpbmNyZW1lbnRhbGx5XG4gIGlmIChpbmZvICYmIGluZm8uaWQgJiYgZGF0YXNldHNbaW5mby5pZF0pIHtcbiAgICAvLyBnZXQga2VwbGVyVGFibGUgZnJvbSBkYXRhc2V0c1xuICAgIGNvbnN0IGtlcGxlclRhYmxlID0gZGF0YXNldHNbaW5mby5pZF07XG4gICAgLy8gdXBkYXRlIHRoZSBkYXRhIGluIGtlcGxlclRhYmxlXG4gICAgcmV0dXJuIFVQREFURV9UQUJMRV9UQVNLKHt0YWJsZToga2VwbGVyVGFibGUsIGRhdGE6IHZhbGlkYXRlZERhdGF9KTtcbiAgfVxuXG4gIGluZm8gPSBpbmZvIHx8IHt9O1xuICBjb25zdCBjb2xvciA9IGluZm8uY29sb3IgfHwgZ2V0TmV3RGF0YXNldENvbG9yKGRhdGFzZXRzKTtcblxuICByZXR1cm4gQ1JFQVRFX1RBQkxFX1RBU0soe1xuICAgIGluZm8sXG4gICAgY29sb3IsXG4gICAgb3B0cyxcbiAgICBkYXRhOiB2YWxpZGF0ZWREYXRhXG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVUYWJsZSh7dGFibGUsIGRhdGF9KSB7XG4gIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCB0YWJsZS51cGRhdGUoZGF0YSk7IC8vIEFzc3VtaW5nIGB0YWJsZWAgaGFzIGFuIGB1cGRhdGVgIG1ldGhvZFxuICByZXR1cm4gdXBkYXRlZDtcbn1cblxudHlwZSBDcmVhdGVUYWJsZVByb3BzID0ge1xuICBpbmZvOiBhbnk7XG4gIGNvbG9yOiBSR0JDb2xvcjtcbiAgb3B0czoge1xuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIH07XG4gIGRhdGE6IGFueTtcbn07XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhYmxlKGRhdGFzZXRJbmZvOiBDcmVhdGVUYWJsZVByb3BzKSB7XG4gIGNvbnN0IHtpbmZvLCBjb2xvciwgb3B0cywgZGF0YX0gPSBkYXRhc2V0SW5mbztcblxuICAvLyB1cGRhdGUgbWV0YWRhdGEgZm9yIHJlbW90ZSB0aWxlZCBkYXRhc2V0c1xuICBjb25zdCByZWZyZXNoZWRNZXRhZGF0YSA9IGF3YWl0IHJlZnJlc2hSZW1vdGVEYXRhKGRhdGFzZXRJbmZvKTtcbiAgbGV0IG1ldGFkYXRhID0gb3B0cy5tZXRhZGF0YTtcbiAgaWYgKHJlZnJlc2hlZE1ldGFkYXRhKSB7XG4gICAgbWV0YWRhdGEgPSB7Li4ub3B0cy5tZXRhZGF0YSwgLi4ucmVmcmVzaGVkTWV0YWRhdGF9O1xuICAgIGlmIChtZXRhZGF0YS5maWVsZHMpIHtcbiAgICAgIGRhdGEuZmllbGRzID0gbWV0YWRhdGEuZmllbGRzO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IFRhYmxlQ2xhc3MgPSBnZXRBcHBsaWNhdGlvbkNvbmZpZygpLnRhYmxlID8/IEtlcGxlclRhYmxlO1xuICBjb25zdCB0YWJsZSA9IG5ldyBUYWJsZUNsYXNzKHtcbiAgICBpbmZvLFxuICAgIGNvbG9yLFxuICAgIC4uLm9wdHMsXG4gICAgbWV0YWRhdGFcbiAgfSk7XG4gIGF3YWl0IHRhYmxlLmltcG9ydERhdGEoe2RhdGF9KTtcblxuICByZXR1cm4gdGFibGU7XG59XG5jb25zdCBVUERBVEVfVEFCTEVfVEFTSyA9IFRhc2suZnJvbVByb21pc2UodXBkYXRlVGFibGUsICdVUERBVEVfVEFCTEVfVEFTSycpO1xuY29uc3QgQ1JFQVRFX1RBQkxFX1RBU0sgPSBUYXNrLmZyb21Qcm9taXNlKGNyZWF0ZVRhYmxlLCAnQ1JFQVRFX1RBQkxFX1RBU0snKTtcblxuLyoqXG4gKiBGZXRjaCBtZXRhZGF0YSBmb3IgdmVjdG9yIHRpbGUgbGF5ZXJzIHVzaW5nIHRpbGVzZXRNZXRhZGF0YVVybCBmcm9tIG1ldGFkYXRhXG4gKiBAcGFyYW0gZGF0YXNldEluZm9cbiAqIEByZXR1cm5zXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlZnJlc2hSZW1vdGVEYXRhKGRhdGFzZXRJbmZvOiBDcmVhdGVUYWJsZVByb3BzKTogUHJvbWlzZTxvYmplY3QgfCBudWxsPiB7XG4gIGNvbnN0IHt0eXBlfSA9IGRhdGFzZXRJbmZvLmluZm87XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgRGF0YXNldFR5cGUuVkVDVE9SX1RJTEU6XG4gICAgICByZXR1cm4gYXdhaXQgcmVmcmVzaFZlY3RvclRpbGVNZXRhZGF0YShkYXRhc2V0SW5mbyk7XG4gICAgY2FzZSBEYXRhc2V0VHlwZS5SQVNURVJfVElMRTpcbiAgICAgIHJldHVybiBhd2FpdCByZWZyZXNoUmFzdGVyVGlsZU1ldGFkYXRhKGRhdGFzZXRJbmZvKTtcbiAgICBjYXNlIERhdGFzZXRUeXBlLldNU19USUxFOlxuICAgICAgcmV0dXJuIGF3YWl0IHJlZnJlc2hXTVNNZXRhZGF0YShkYXRhc2V0SW5mbyk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlZnJlc2hWZWN0b3JUaWxlTWV0YWRhdGEoXG4gIGRhdGFzZXRJbmZvOiBDcmVhdGVUYWJsZVByb3BzXG4pOiBQcm9taXNlPFZlY3RvclRpbGVNZXRhZGF0YSB8IG51bGw+IHtcbiAgY29uc3Qge3JlbW90ZVRpbGVGb3JtYXQsIHRpbGVzZXRNZXRhZGF0YVVybCwgdGlsZXNldERhdGFVcmx9ID1cbiAgICAoZGF0YXNldEluZm8ub3B0cy5tZXRhZGF0YSBhcyBWZWN0b3JUaWxlRGF0YXNldE1ldGFkYXRhKSB8fCB7fTtcblxuICBpZiAoXG4gICAgIShyZW1vdGVUaWxlRm9ybWF0ID09PSBSZW1vdGVUaWxlRm9ybWF0LlBNVElMRVMgfHwgcmVtb3RlVGlsZUZvcm1hdCA9PT0gUmVtb3RlVGlsZUZvcm1hdC5NVlQpIHx8XG4gICAgdHlwZW9mIHRpbGVzZXRNZXRhZGF0YVVybCAhPT0gJ3N0cmluZycgfHxcbiAgICB0eXBlb2YgdGlsZXNldERhdGFVcmwgIT09ICdzdHJpbmcnXG4gICkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBsZXQgcmF3TWV0YWRhdGE6IFBNVGlsZXNNZXRhZGF0YSB8IFRpbGVKU09OIHwgbnVsbCA9IG51bGw7XG4gICAgaWYgKHJlbW90ZVRpbGVGb3JtYXQgPT09IFJlbW90ZVRpbGVGb3JtYXQuTVZUKSB7XG4gICAgICByYXdNZXRhZGF0YSA9IGF3YWl0IGdldE1WVE1ldGFkYXRhKHRpbGVzZXRNZXRhZGF0YVVybCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRpbGVTb3VyY2UgPSBQTVRpbGVzU291cmNlLmNyZWF0ZURhdGFTb3VyY2UodGlsZXNldE1ldGFkYXRhVXJsLCB7fSk7XG4gICAgICByYXdNZXRhZGF0YSA9IGF3YWl0IHRpbGVTb3VyY2UubWV0YWRhdGE7XG4gICAgfVxuXG4gICAgaWYgKHJhd01ldGFkYXRhKSB7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IHBhcnNlVmVjdG9yTWV0YWRhdGEocmF3TWV0YWRhdGEpO1xuXG4gICAgICBhd2FpdCBnZXRGaWVsZHNGcm9tVGlsZSh7XG4gICAgICAgIHJlbW90ZVRpbGVGb3JtYXQsXG4gICAgICAgIHRpbGVzZXRVcmw6IHRpbGVzZXREYXRhVXJsLFxuICAgICAgICBtZXRhZGF0YVVybDogdGlsZXNldE1ldGFkYXRhVXJsLFxuICAgICAgICBtZXRhZGF0YVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBtZXRhZGF0YTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGlnbm9yZSBmb3Igbm93LCBhbmQgdXNlIG9sZCBtZXRhZGF0YVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWZyZXNoUmFzdGVyVGlsZU1ldGFkYXRhKGRhdGFzZXRJbmZvOiBDcmVhdGVUYWJsZVByb3BzKTogUHJvbWlzZTxhbnkgfCBudWxsPiB7XG4gIGNvbnN0IHttZXRhZGF0YVVybCwgcG10aWxlc1R5cGV9ID0gKGRhdGFzZXRJbmZvLm9wdHMubWV0YWRhdGEgYXMgUmFzdGVyVGlsZURhdGFzZXRNZXRhZGF0YSkgfHwge307XG5cbiAgaWYgKHR5cGVvZiBtZXRhZGF0YVVybCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHRyeSB7XG4gICAgaWYgKHBtdGlsZXNUeXBlID09PSBQTVRpbGVzVHlwZS5SQVNURVIpIHtcbiAgICAgIGNvbnN0IHRpbGVTb3VyY2UgPSBQTVRpbGVzU291cmNlLmNyZWF0ZURhdGFTb3VyY2UobWV0YWRhdGFVcmwsIHt9KTtcbiAgICAgIGNvbnN0IHJhd01ldGFkYXRhOiBQTVRpbGVzTWV0YWRhdGEgPSBhd2FpdCB0aWxlU291cmNlLm1ldGFkYXRhO1xuXG4gICAgICBpZiAocmF3TWV0YWRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlVmVjdG9yTWV0YWRhdGEocmF3TWV0YWRhdGEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpdCdzIHN0YWMgcmFzdGVyIHRpbGVzXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKG1ldGFkYXRhVXJsKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgRmV0Y2ggJHttZXRhZGF0YVVybH1gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJhd01ldGFkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBjb25zdCBtZXRhZGF0YSA9IHBhcnNlUmFzdGVyTWV0YWRhdGEocmF3TWV0YWRhdGEsIHthbGxvd0NvbGxlY3Rpb25zOiB0cnVlfSk7XG4gICAgICBpZiAobWV0YWRhdGEgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBwYXJzZSBtZXRhZGF0YSAke21ldGFkYXRhLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtZXRhZGF0YTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGlnbm9yZSBmb3Igbm93LCBhbmQgdXNlIG9sZCBtZXRhZGF0YVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWZyZXNoV01TTWV0YWRhdGEoZGF0YXNldEluZm86IENyZWF0ZVRhYmxlUHJvcHMpOiBQcm9taXNlPGFueSB8IG51bGw+IHtcbiAgY29uc3Qge3JlbW90ZVRpbGVGb3JtYXQsIHRpbGVzZXREYXRhVXJsfSA9XG4gICAgKGRhdGFzZXRJbmZvLm9wdHMubWV0YWRhdGEgYXMgV01TRGF0YXNldE1ldGFkYXRhKSB8fCB7fTtcblxuICBpZiAocmVtb3RlVGlsZUZvcm1hdCAhPT0gUmVtb3RlVGlsZUZvcm1hdC5XTVMgfHwgdHlwZW9mIHRpbGVzZXREYXRhVXJsICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0V01TQ2FwYWJpbGl0aWVzKHRpbGVzZXREYXRhVXJsKTtcbiAgICByZXR1cm4gd21zQ2FwYWJpbGl0aWVzVG9EYXRhc2V0TWV0YWRhdGEoZGF0YSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGlnbm9yZSBmb3Igbm93LCBhbmQgdXNlIG9sZCBtZXRhZGF0YVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V01TQ2FwYWJpbGl0aWVzKHdzbVVybDogc3RyaW5nKTogUHJvbWlzZTxXTVNDYXBhYmlsaXRpZXM+IHtcbiAgcmV0dXJuIChhd2FpdCBsb2FkKFxuICAgIGAke3dzbVVybH0/c2VydmljZT1XTVMmcmVxdWVzdD1HZXRDYXBhYmlsaXRpZXNgLFxuICAgIFdNU0NhcGFiaWxpdGllc0xvYWRlclxuICApKSBhcyBXTVNDYXBhYmlsaXRpZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3bXNDYXBhYmlsaXRpZXNUb0RhdGFzZXRNZXRhZGF0YShjYXBhYmlsaXRpZXM6IFdNU0NhcGFiaWxpdGllcyk6IGFueSB8IG51bGwge1xuICAvLyBGbGF0dGVuIGxheWVycyBpZiB0aGV5IGFyZSBuZXN0ZWRcbiAgY29uc3QgbGF5ZXJzID0gY2FwYWJpbGl0aWVzLmxheWVycy5mbGF0TWFwKGxheWVyID0+IHtcbiAgICBpZiAobGF5ZXIubGF5ZXJzICYmIGxheWVyLmxheWVycy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gbGF5ZXIubGF5ZXJzO1xuICAgIH1cbiAgICByZXR1cm4gbGF5ZXI7XG4gIH0pO1xuXG4gIGxldCBhdmFpbGFibGVMYXllcnM6IFdNU0RhdGFzZXRNZXRhZGF0YVsnbGF5ZXJzJ10gPSBbXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkobGF5ZXJzKSkge1xuICAgIGF2YWlsYWJsZUxheWVycyA9IGxheWVycy5tYXAoKGxheWVyOiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IGJiID0gbGF5ZXIuZ2VvZ3JhcGhpY0JvdW5kaW5nQm94O1xuXG4gICAgICBsZXQgYm91bmRpbmdCb3g6IG51bWJlcltdIHwgbnVsbCA9IG51bGw7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShiYikgJiYgQXJyYXkuaXNBcnJheShiYlswXSkgJiYgQXJyYXkuaXNBcnJheShiYlsxXSkpIHtcbiAgICAgICAgYm91bmRpbmdCb3ggPSBbYmJbMF1bMF0sIGJiWzBdWzFdLCBiYlsxXVswXSwgYmJbMV1bMV1dO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBsYXllci5uYW1lLFxuICAgICAgICB0aXRsZTogbGF5ZXIudGl0bGUgfHwgbGF5ZXIubmFtZSxcbiAgICAgICAgYm91bmRpbmdCb3gsXG4gICAgICAgIHF1ZXJ5YWJsZTogbGF5ZXIucXVlcnlhYmxlXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBsYXllcnM6IGF2YWlsYWJsZUxheWVycyxcbiAgICB2ZXJzaW9uOiBjYXBhYmlsaXRpZXMudmVyc2lvbiB8fCAnMS4zLjAnXG4gIH07XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBR0EsSUFBQUEsS0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsWUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUUsTUFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBRUEsSUFBQUcsVUFBQSxHQUFBSCxPQUFBO0FBUUEsSUFBQUksTUFBQSxHQUFBSixPQUFBO0FBT0EsSUFBQUssS0FBQSxHQUFBTCxPQUFBO0FBRUEsSUFBQU0sUUFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8sSUFBQSxHQUFBUCxPQUFBO0FBRUEsSUFBQVEsYUFBQSxHQUFBUixPQUFBO0FBQ0EsSUFBQVMsZ0JBQUEsR0FBQVQsT0FBQTtBQUNBLElBQUFVLGdCQUFBLEdBQUFWLE9BQUE7QUFJcUMsSUFBQVcsU0FBQSxxQkFsQ3JDO0FBQ0E7QUFBQSxTQUFBQyxRQUFBQyxDQUFBLEVBQUFDLENBQUEsUUFBQUMsQ0FBQSxHQUFBQyxNQUFBLENBQUFDLElBQUEsQ0FBQUosQ0FBQSxPQUFBRyxNQUFBLENBQUFFLHFCQUFBLFFBQUFDLENBQUEsR0FBQUgsTUFBQSxDQUFBRSxx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