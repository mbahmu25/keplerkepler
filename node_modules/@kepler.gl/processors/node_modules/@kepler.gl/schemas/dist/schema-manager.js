"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.reducerSchema = exports["default"] = exports.KeplerGLSchema = void 0;
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _window = require("global/window");
var _datasetSchema = _interopRequireDefault(require("./dataset-schema"));
var _mapStyleSchema = _interopRequireDefault(require("./map-style-schema"));
var _mapStateSchema = _interopRequireDefault(require("./map-state-schema"));
var _visStateSchema = require("./vis-state-schema");
var _uiStateSchema = _interopRequireDefault(require("./ui-state-schema"));
var _versions = require("./versions");
var _utils = require("@kepler.gl/utils");
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2["default"])(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } // SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
/** Schema for v1 saved configuration */

var reducerSchema = exports.reducerSchema = {
  visState: _visStateSchema.visStateSchema,
  mapState: _mapStateSchema["default"],
  mapStyle: _mapStyleSchema["default"],
  uiState: _uiStateSchema["default"]
};
var KeplerGLSchema = exports.KeplerGLSchema = /*#__PURE__*/function () {
  function KeplerGLSchema() {
    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      _ref$reducers = _ref.reducers,
      reducers = _ref$reducers === void 0 ? reducerSchema : _ref$reducers,
      _ref$datasets = _ref.datasets,
      datasets = _ref$datasets === void 0 ? _datasetSchema["default"] : _ref$datasets,
      _ref$validVersions = _ref.validVersions,
      validVersions = _ref$validVersions === void 0 ? _versions.VERSIONS : _ref$validVersions,
      _ref$version = _ref.version,
      version = _ref$version === void 0 ? _versions.CURRENT_VERSION : _ref$version,
      composedReducerSchema = _ref.composedReducerSchema;
    (0, _classCallCheck2["default"])(this, KeplerGLSchema);
    (0, _defineProperty2["default"])(this, "_validVersions", void 0);
    (0, _defineProperty2["default"])(this, "_version", void 0);
    (0, _defineProperty2["default"])(this, "_reducerSchemas", void 0);
    (0, _defineProperty2["default"])(this, "_datasetSchema", void 0);
    (0, _defineProperty2["default"])(this, "_datasetLastSaved", void 0);
    (0, _defineProperty2["default"])(this, "_savedDataset", void 0);
    (0, _defineProperty2["default"])(this, "_composedReducerSchema", void 0);
    this._validVersions = validVersions;
    this._version = version;
    this._reducerSchemas = reducers;
    this._datasetSchema = datasets;
    this._composedReducerSchema = composedReducerSchema || null;
    this._datasetLastSaved = null;
    this._savedDataset = null;
  }

  /**
   * stateToSave = {
   *   datasets: [
   *     {
   *       version: 'v0',
   *       data: {id, label, color, allData, fields}
   *     },
   *     {
   *       version: 'v0',
   *       data: {id, label, color, allData, fields}
   *     }
   *   ],
   *   config: {
   *     version: 'v0',
   *     config: {}
   *   },
   *   info: {
   *     app: 'kepler.gl',
   *     create_at: 'Mon May 28 2018 21:04:46 GMT-0700 (PDT)'
   *   }
   * }
   *
   * Get config and data of current map to save
   * @param state
   * @returns app state to save
   */
  return (0, _createClass2["default"])(KeplerGLSchema, [{
    key: "save",
    value: function save(state) {
      return {
        datasets: this.getDatasetToSave(state),
        config: this.getConfigToSave(state),
        info: _objectSpread({
          app: 'kepler.gl',
          created_at: new Date().toString()
        }, this.getMapInfo(state))
      };
    }
  }, {
    key: "getMapInfo",
    value: function getMapInfo(state) {
      return state.visState.mapInfo;
    }
    /**
     *  Load saved map, argument can be (datasets, config) or ({datasets, config})
     * @param savedDatasets
     * @param savedConfig
     */
  }, {
    key: "load",
    value: function load() {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }
      // if pass dataset and config in as a single object
      if (args.length === 1 && (0, _utils.isPlainObject)(args[0]) && (Array.isArray(args[0].datasets) || (0, _utils.isPlainObject)(args[0].config))) {
        return this.load(args[0].datasets, args[0].config);
      }
      return _objectSpread(_objectSpread({}, Array.isArray(args[0]) ? {
        datasets: this.parseSavedData(args[0])
      } : {}), args[1] ? {
        config: this.parseSavedConfig(args[1])
      } : {});
    }

    /**
     * Get data to save
     * @param state - app state
     * @returns - dataset to save
     */
  }, {
    key: "getDatasetToSave",
    value: function getDatasetToSave(state) {
      var _this = this;
      var dataChangedSinceLastSave = this.hasDataChanged(state);
      if (!dataChangedSinceLastSave) {
        // @ts-expect-error
        return this._savedDataset;
      }
      var visState = state.visState;
      var datasets = Object.values(visState.datasets).map(function (ds) {
        return {
          version: _this._version,
          data: _this._datasetSchema[_this._version].save(ds)
        };
      });

      // keep a copy of formatted datasets to save
      this._datasetLastSaved = visState.datasets;
      this._savedDataset = datasets;
      return datasets;
    }

    /**
     * Get App config to save
     * @param state - app state
     * @returns - config to save
     */
  }, {
    key: "getConfigToSave",
    value: function getConfigToSave(state) {
      var _this$_composedReduce,
        _this2 = this;
      var toSave = typeof ((_this$_composedReduce = this._composedReducerSchema) === null || _this$_composedReduce === void 0 ? void 0 : _this$_composedReduce.save) === 'function' ? this._composedReducerSchema.save(state) : state;
      var config = Object.keys(this._reducerSchemas).reduce(function (accu, key) {
        return _objectSpread(_objectSpread({}, accu), toSave[key] ? _this2._reducerSchemas[key][_this2._version].save(toSave[key]) : {});
      }, {});
      return {
        version: this._version,
        // @ts-expect-error
        config: config
      };
    }

    /**
     * Parse saved data
     * @param datasets
     * @returns - dataset to pass to addDataToMap
     */
  }, {
    key: "parseSavedData",
    value: function parseSavedData(datasets) {
      var _this3 = this;
      return datasets.reduce(function (accu, ds) {
        var validVersion = _this3.validateVersion(ds.version);
        if (!validVersion) {
          return accu;
        }
        accu.push(_this3._datasetSchema[validVersion].load(ds.data));
        return accu;
      }, []);
    }

    /**
     * Parse saved App config
     */
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
  }, {
    key: "parseSavedConfig",
    value: function parseSavedConfig(_ref2) {
      var _this$_composedReduce2,
        _this4 = this;
      var version = _ref2.version,
        config = _ref2.config;
      var state = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var validVersion = this.validateVersion(version);
      if (!validVersion) {
        return null;
      }
      var toLoad = typeof ((_this$_composedReduce2 = this._composedReducerSchema) === null || _this$_composedReduce2 === void 0 ? void 0 : _this$_composedReduce2.load) === 'function' ? this._composedReducerSchema.load(config) : config;
      return Object.keys(toLoad).reduce(function (accu, key) {
        return _objectSpread(_objectSpread({}, accu), key in _this4._reducerSchemas ? _this4._reducerSchemas[key][validVersion].load(toLoad[key]) : {});
      }, {});
    }

    /**
     * Validate version
     * @param version
     * @returns validVersion
     */
  }, {
    key: "validateVersion",
    value: function validateVersion(version) {
      if (!version) {
        _window.console.error('There is no version number associated with this saved map');
        return null;
      }
      if (!this._validVersions[version]) {
        _window.console.error("".concat(version, " is not a valid version"));
        return null;
      }
      return version;
    }

    /**
     * Check if data has changed since last save
     * @param state
     * @returns - whether data has changed or not
     */
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
  }, {
    key: "hasDataChanged",
    value: function hasDataChanged(state) {
      return true;
    }
  }]);
}();
var KeplerGLSchemaManager = new KeplerGLSchema();
var _default = exports["default"] = KeplerGLSchemaManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfd2luZG93IiwicmVxdWlyZSIsIl9kYXRhc2V0U2NoZW1hIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9tYXBTdHlsZVNjaGVtYSIsIl9tYXBTdGF0ZVNjaGVtYSIsIl92aXNTdGF0ZVNjaGVtYSIsIl91aVN0YXRlU2NoZW1hIiwiX3ZlcnNpb25zIiwiX3V0aWxzIiwib3duS2V5cyIsImUiLCJyIiwidCIsIk9iamVjdCIsImtleXMiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJvIiwiZmlsdGVyIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJmb3JFYWNoIiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJyZWR1Y2VyU2NoZW1hIiwiZXhwb3J0cyIsInZpc1N0YXRlIiwidmlzU3RhdGVTY2hlbWEiLCJtYXBTdGF0ZSIsIm1hcFN0YXRlU2NoZW1hIiwibWFwU3R5bGUiLCJtYXBTdHlsZVNjaGVtYSIsInVpU3RhdGUiLCJ1aVN0YXRlU2NoZW1hIiwiS2VwbGVyR0xTY2hlbWEiLCJfcmVmIiwidW5kZWZpbmVkIiwiX3JlZiRyZWR1Y2VycyIsInJlZHVjZXJzIiwiX3JlZiRkYXRhc2V0cyIsImRhdGFzZXRzIiwiZGF0YXNldFNjaGVtYSIsIl9yZWYkdmFsaWRWZXJzaW9ucyIsInZhbGlkVmVyc2lvbnMiLCJWRVJTSU9OUyIsIl9yZWYkdmVyc2lvbiIsInZlcnNpb24iLCJDVVJSRU5UX1ZFUlNJT04iLCJjb21wb3NlZFJlZHVjZXJTY2hlbWEiLCJfY2xhc3NDYWxsQ2hlY2syIiwiX3ZhbGlkVmVyc2lvbnMiLCJfdmVyc2lvbiIsIl9yZWR1Y2VyU2NoZW1hcyIsIl9jb21wb3NlZFJlZHVjZXJTY2hlbWEiLCJfZGF0YXNldExhc3RTYXZlZCIsIl9zYXZlZERhdGFzZXQiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJzYXZlIiwic3RhdGUiLCJnZXREYXRhc2V0VG9TYXZlIiwiY29uZmlnIiwiZ2V0Q29uZmlnVG9TYXZlIiwiaW5mbyIsImFwcCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9TdHJpbmciLCJnZXRNYXBJbmZvIiwibWFwSW5mbyIsImxvYWQiLCJfbGVuIiwiYXJncyIsIkFycmF5IiwiX2tleSIsImlzUGxhaW5PYmplY3QiLCJpc0FycmF5IiwicGFyc2VTYXZlZERhdGEiLCJwYXJzZVNhdmVkQ29uZmlnIiwiX3RoaXMiLCJkYXRhQ2hhbmdlZFNpbmNlTGFzdFNhdmUiLCJoYXNEYXRhQ2hhbmdlZCIsInZhbHVlcyIsIm1hcCIsImRzIiwiZGF0YSIsIl90aGlzJF9jb21wb3NlZFJlZHVjZSIsIl90aGlzMiIsInRvU2F2ZSIsInJlZHVjZSIsImFjY3UiLCJfdGhpczMiLCJ2YWxpZFZlcnNpb24iLCJ2YWxpZGF0ZVZlcnNpb24iLCJfcmVmMiIsIl90aGlzJF9jb21wb3NlZFJlZHVjZTIiLCJfdGhpczQiLCJ0b0xvYWQiLCJDb25zb2xlIiwiZXJyb3IiLCJjb25jYXQiLCJLZXBsZXJHTFNjaGVtYU1hbmFnZXIiLCJfZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uL3NyYy9zY2hlbWEtbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUXG4vLyBDb3B5cmlnaHQgY29udHJpYnV0b3JzIHRvIHRoZSBrZXBsZXIuZ2wgcHJvamVjdFxuXG5pbXBvcnQge2NvbnNvbGUgYXMgQ29uc29sZX0gZnJvbSAnZ2xvYmFsL3dpbmRvdyc7XG5cbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuaW1wb3J0IGRhdGFzZXRTY2hlbWEgZnJvbSAnLi9kYXRhc2V0LXNjaGVtYSc7XG5pbXBvcnQgbWFwU3R5bGVTY2hlbWEgZnJvbSAnLi9tYXAtc3R5bGUtc2NoZW1hJztcbmltcG9ydCBtYXBTdGF0ZVNjaGVtYSBmcm9tICcuL21hcC1zdGF0ZS1zY2hlbWEnO1xuaW1wb3J0IHtTYXZlZERhdGFzZXRWMSwgUGFyc2VkRGF0YXNldH0gZnJvbSAnLi9kYXRhc2V0LXNjaGVtYSc7XG5pbXBvcnQge3Zpc1N0YXRlU2NoZW1hfSBmcm9tICcuL3Zpcy1zdGF0ZS1zY2hlbWEnO1xuaW1wb3J0IHVpU3RhdGVTY2hlbWEgZnJvbSAnLi91aS1zdGF0ZS1zY2hlbWEnO1xuXG5pbXBvcnQge0NVUlJFTlRfVkVSU0lPTiwgVkVSU0lPTlN9IGZyb20gJy4vdmVyc2lvbnMnO1xuaW1wb3J0IHtpc1BsYWluT2JqZWN0fSBmcm9tICdAa2VwbGVyLmdsL3V0aWxzJztcblxuaW1wb3J0IHtNYXBJbmZvLCBTYXZlZFZpc1N0YXRlLCBTYXZlZE1hcFN0eWxlLCBQYXJzZWRDb25maWcsIEJhc2VNYXBTdHlsZX0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5cbmV4cG9ydCB0eXBlIFNhdmVkTWFwU3RhdGUgPSB7XG4gIGJlYXJpbmc6IG51bWJlcjtcbiAgZHJhZ1JvdGF0ZTogYm9vbGVhbjtcbiAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgbG9uZ2l0dWRlOiBudW1iZXI7XG4gIHBpdGNoOiBudW1iZXI7XG4gIHpvb206IG51bWJlcjtcbiAgaXNTcGxpdDogYm9vbGVhbjtcbiAgaXNWaWV3cG9ydFN5bmNlZD86IHRydWU7XG4gIGlzWm9vbUxvY2tlZD86IGZhbHNlO1xuICBzcGxpdE1hcFZpZXdwb3J0cz86IFtdO1xufTtcblxuZXhwb3J0IHR5cGUgU2F2ZWRMYXllckdyb3VwcyA9IHtcbiAgW2tleTogc3RyaW5nXTogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCB0eXBlIFNhdmVkQ3VzdG9tTWFwU3R5bGUgPSB7XG4gIFtrZXk6IHN0cmluZ106IHtcbiAgICBhY2Nlc3NUb2tlbj86IHN0cmluZztcbiAgICBjdXN0b206IEJhc2VNYXBTdHlsZVsnY3VzdG9tJ107XG4gICAgaWNvbjogc3RyaW5nO1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbGFiZWw6IHN0cmluZztcbiAgICB1cmw6IHN0cmluZztcbiAgfTtcbn07XG5cbi8qKiBTY2hlbWEgZm9yIHYxIHNhdmVkIGNvbmZpZ3VyYXRpb24gKi9cbmV4cG9ydCB0eXBlIFNhdmVkQ29uZmlnVjEgPSB7XG4gIHZlcnNpb246ICd2MSc7XG4gIGNvbmZpZzoge1xuICAgIHZpc1N0YXRlOiBTYXZlZFZpc1N0YXRlO1xuICAgIG1hcFN0YXRlOiBTYXZlZE1hcFN0YXRlO1xuICAgIG1hcFN0eWxlOiBTYXZlZE1hcFN0eWxlO1xuICB9O1xufTtcblxuZXhwb3J0IHR5cGUgU2F2ZWRNYXAgPSB7XG4gIGRhdGFzZXRzOiBTYXZlZERhdGFzZXRWMVtdO1xuICBjb25maWc6IFNhdmVkQ29uZmlnVjE7XG4gIGluZm86IHtcbiAgICBhcHA6IHN0cmluZztcbiAgICBjcmVhdGVkX2F0OiBzdHJpbmc7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICB9O1xufTtcblxuZXhwb3J0IHR5cGUgTG9hZGVkTWFwID0ge2RhdGFzZXRzPzogUGFyc2VkRGF0YXNldFtdIHwgbnVsbDsgY29uZmlnPzogUGFyc2VkQ29uZmlnIHwgbnVsbH07XG5cbmV4cG9ydCBjb25zdCByZWR1Y2VyU2NoZW1hOiB7XG4gIFtrZXk6IHN0cmluZ106IHR5cGVvZiBtYXBTdGF0ZVNjaGVtYSB8IHR5cGVvZiB2aXNTdGF0ZVNjaGVtYSB8IHR5cGVvZiBtYXBTdHlsZVNjaGVtYTtcbn0gPSB7XG4gIHZpc1N0YXRlOiB2aXNTdGF0ZVNjaGVtYSxcbiAgbWFwU3RhdGU6IG1hcFN0YXRlU2NoZW1hLFxuICBtYXBTdHlsZTogbWFwU3R5bGVTY2hlbWEsXG4gIHVpU3RhdGU6IHVpU3RhdGVTY2hlbWFcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9zZWRSZWR1Y2VyU2NoZW1hIHtcbiAgc2F2ZShzdGF0ZTogYW55KTogYW55O1xuICBsb2FkKGNvbmZpZzogU2F2ZWRNYXApOiBTYXZlZE1hcDtcbn1cblxuZXhwb3J0IHR5cGUgS2VwbGVyR0xTY2hlbWFQcm9wcyA9IHtcbiAgcmVkdWNlcnM/OiB0eXBlb2YgcmVkdWNlclNjaGVtYTtcbiAgZGF0YXNldHM/OiB0eXBlb2YgZGF0YXNldFNjaGVtYTtcbiAgdmFsaWRWZXJzaW9ucz86IHR5cGVvZiBWRVJTSU9OUztcbiAgdmVyc2lvbj86ICd2MSc7XG4gIGNvbXBvc2VkUmVkdWNlclNjaGVtYT86IENvbXBvc2VkUmVkdWNlclNjaGVtYTtcbn07XG5cbmV4cG9ydCBjbGFzcyBLZXBsZXJHTFNjaGVtYSB7XG4gIF92YWxpZFZlcnNpb25zOiB0eXBlb2YgVkVSU0lPTlM7XG4gIF92ZXJzaW9uOiAndjEnO1xuICBfcmVkdWNlclNjaGVtYXM6IHR5cGVvZiByZWR1Y2VyU2NoZW1hO1xuICBfZGF0YXNldFNjaGVtYTogdHlwZW9mIGRhdGFzZXRTY2hlbWE7XG4gIF9kYXRhc2V0TGFzdFNhdmVkOiBTYXZlZERhdGFzZXRWMVtdIHwgbnVsbDtcbiAgX3NhdmVkRGF0YXNldDogU2F2ZWREYXRhc2V0VjFbXSB8IG51bGw7XG4gIF9jb21wb3NlZFJlZHVjZXJTY2hlbWE6IENvbXBvc2VkUmVkdWNlclNjaGVtYSB8IG51bGw7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIHJlZHVjZXJzID0gcmVkdWNlclNjaGVtYSxcbiAgICBkYXRhc2V0cyA9IGRhdGFzZXRTY2hlbWEsXG4gICAgdmFsaWRWZXJzaW9ucyA9IFZFUlNJT05TLFxuICAgIHZlcnNpb24gPSBDVVJSRU5UX1ZFUlNJT04sXG4gICAgY29tcG9zZWRSZWR1Y2VyU2NoZW1hXG4gIH06IEtlcGxlckdMU2NoZW1hUHJvcHMgPSB7fSkge1xuICAgIHRoaXMuX3ZhbGlkVmVyc2lvbnMgPSB2YWxpZFZlcnNpb25zO1xuICAgIHRoaXMuX3ZlcnNpb24gPSB2ZXJzaW9uO1xuICAgIHRoaXMuX3JlZHVjZXJTY2hlbWFzID0gcmVkdWNlcnM7XG4gICAgdGhpcy5fZGF0YXNldFNjaGVtYSA9IGRhdGFzZXRzO1xuICAgIHRoaXMuX2NvbXBvc2VkUmVkdWNlclNjaGVtYSA9IGNvbXBvc2VkUmVkdWNlclNjaGVtYSB8fCBudWxsO1xuXG4gICAgdGhpcy5fZGF0YXNldExhc3RTYXZlZCA9IG51bGw7XG4gICAgdGhpcy5fc2F2ZWREYXRhc2V0ID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBzdGF0ZVRvU2F2ZSA9IHtcbiAgICogICBkYXRhc2V0czogW1xuICAgKiAgICAge1xuICAgKiAgICAgICB2ZXJzaW9uOiAndjAnLFxuICAgKiAgICAgICBkYXRhOiB7aWQsIGxhYmVsLCBjb2xvciwgYWxsRGF0YSwgZmllbGRzfVxuICAgKiAgICAgfSxcbiAgICogICAgIHtcbiAgICogICAgICAgdmVyc2lvbjogJ3YwJyxcbiAgICogICAgICAgZGF0YToge2lkLCBsYWJlbCwgY29sb3IsIGFsbERhdGEsIGZpZWxkc31cbiAgICogICAgIH1cbiAgICogICBdLFxuICAgKiAgIGNvbmZpZzoge1xuICAgKiAgICAgdmVyc2lvbjogJ3YwJyxcbiAgICogICAgIGNvbmZpZzoge31cbiAgICogICB9LFxuICAgKiAgIGluZm86IHtcbiAgICogICAgIGFwcDogJ2tlcGxlci5nbCcsXG4gICAqICAgICBjcmVhdGVfYXQ6ICdNb24gTWF5IDI4IDIwMTggMjE6MDQ6NDYgR01ULTA3MDAgKFBEVCknXG4gICAqICAgfVxuICAgKiB9XG4gICAqXG4gICAqIEdldCBjb25maWcgYW5kIGRhdGEgb2YgY3VycmVudCBtYXAgdG8gc2F2ZVxuICAgKiBAcGFyYW0gc3RhdGVcbiAgICogQHJldHVybnMgYXBwIHN0YXRlIHRvIHNhdmVcbiAgICovXG4gIHNhdmUoc3RhdGU6IGFueSk6IFNhdmVkTWFwIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0YXNldHM6IHRoaXMuZ2V0RGF0YXNldFRvU2F2ZShzdGF0ZSksXG4gICAgICBjb25maWc6IHRoaXMuZ2V0Q29uZmlnVG9TYXZlKHN0YXRlKSxcbiAgICAgIGluZm86IHtcbiAgICAgICAgYXBwOiAna2VwbGVyLmdsJyxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b1N0cmluZygpLFxuICAgICAgICAuLi50aGlzLmdldE1hcEluZm8oc3RhdGUpXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGdldE1hcEluZm8oc3RhdGU6IGFueSk6IE1hcEluZm8ge1xuICAgIHJldHVybiBzdGF0ZS52aXNTdGF0ZS5tYXBJbmZvO1xuICB9XG4gIC8qKlxuICAgKiAgTG9hZCBzYXZlZCBtYXAsIGFyZ3VtZW50IGNhbiBiZSAoZGF0YXNldHMsIGNvbmZpZykgb3IgKHtkYXRhc2V0cywgY29uZmlnfSlcbiAgICogQHBhcmFtIHNhdmVkRGF0YXNldHNcbiAgICogQHBhcmFtIHNhdmVkQ29uZmlnXG4gICAqL1xuICBsb2FkKFxuICAgIC4uLmFyZ3M6XG4gICAgICB8IFtcbiAgICAgICAgICBzYXZlZERhdGFzZXRzOiBTYXZlZE1hcCB8IFNhdmVkTWFwWydkYXRhc2V0cyddIHwgYW55LFxuICAgICAgICAgIHNhdmVkQ29uZmlnOiBTYXZlZE1hcFsnY29uZmlnJ10gfCBhbnlcbiAgICAgICAgXVxuICAgICAgfCBbe2RhdGFzZXRzOiBTYXZlZE1hcFsnZGF0YXNldHMnXSB8IGFueTsgY29uZmlnOiBTYXZlZE1hcFsnY29uZmlnJ10gfCBhbnl9XVxuICApOiBMb2FkZWRNYXAge1xuICAgIC8vIGlmIHBhc3MgZGF0YXNldCBhbmQgY29uZmlnIGluIGFzIGEgc2luZ2xlIG9iamVjdFxuICAgIGlmIChcbiAgICAgIGFyZ3MubGVuZ3RoID09PSAxICYmXG4gICAgICBpc1BsYWluT2JqZWN0KGFyZ3NbMF0pICYmXG4gICAgICAoQXJyYXkuaXNBcnJheShhcmdzWzBdLmRhdGFzZXRzKSB8fCBpc1BsYWluT2JqZWN0KGFyZ3NbMF0uY29uZmlnKSlcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWQoYXJnc1swXS5kYXRhc2V0cywgYXJnc1swXS5jb25maWcpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAuLi4oQXJyYXkuaXNBcnJheShhcmdzWzBdKSA/IHtkYXRhc2V0czogdGhpcy5wYXJzZVNhdmVkRGF0YShhcmdzWzBdKX0gOiB7fSksXG4gICAgICAuLi4oYXJnc1sxXSA/IHtjb25maWc6IHRoaXMucGFyc2VTYXZlZENvbmZpZyhhcmdzWzFdKX0gOiB7fSlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkYXRhIHRvIHNhdmVcbiAgICogQHBhcmFtIHN0YXRlIC0gYXBwIHN0YXRlXG4gICAqIEByZXR1cm5zIC0gZGF0YXNldCB0byBzYXZlXG4gICAqL1xuICBnZXREYXRhc2V0VG9TYXZlKHN0YXRlOiBhbnkpOiBTYXZlZERhdGFzZXRWMVtdIHtcbiAgICBjb25zdCBkYXRhQ2hhbmdlZFNpbmNlTGFzdFNhdmUgPSB0aGlzLmhhc0RhdGFDaGFuZ2VkKHN0YXRlKTtcbiAgICBpZiAoIWRhdGFDaGFuZ2VkU2luY2VMYXN0U2F2ZSkge1xuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YXNldDtcbiAgICB9XG5cbiAgICBjb25zdCB7dmlzU3RhdGV9ID0gc3RhdGU7XG5cbiAgICBjb25zdCBkYXRhc2V0cyA9IE9iamVjdC52YWx1ZXModmlzU3RhdGUuZGF0YXNldHMgYXMgRGF0YXNldHMpLm1hcChkcyA9PiAoe1xuICAgICAgdmVyc2lvbjogdGhpcy5fdmVyc2lvbixcbiAgICAgIGRhdGE6IHRoaXMuX2RhdGFzZXRTY2hlbWFbdGhpcy5fdmVyc2lvbl0uc2F2ZShkcylcbiAgICB9KSk7XG5cbiAgICAvLyBrZWVwIGEgY29weSBvZiBmb3JtYXR0ZWQgZGF0YXNldHMgdG8gc2F2ZVxuICAgIHRoaXMuX2RhdGFzZXRMYXN0U2F2ZWQgPSB2aXNTdGF0ZS5kYXRhc2V0cztcbiAgICB0aGlzLl9zYXZlZERhdGFzZXQgPSBkYXRhc2V0cztcblxuICAgIHJldHVybiBkYXRhc2V0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgQXBwIGNvbmZpZyB0byBzYXZlXG4gICAqIEBwYXJhbSBzdGF0ZSAtIGFwcCBzdGF0ZVxuICAgKiBAcmV0dXJucyAtIGNvbmZpZyB0byBzYXZlXG4gICAqL1xuICBnZXRDb25maWdUb1NhdmUoc3RhdGU6IGFueSk6IFNhdmVkQ29uZmlnVjEge1xuICAgIGNvbnN0IHRvU2F2ZSA9XG4gICAgICB0eXBlb2YgdGhpcy5fY29tcG9zZWRSZWR1Y2VyU2NoZW1hPy5zYXZlID09PSAnZnVuY3Rpb24nXG4gICAgICAgID8gdGhpcy5fY29tcG9zZWRSZWR1Y2VyU2NoZW1hLnNhdmUoc3RhdGUpXG4gICAgICAgIDogc3RhdGU7XG4gICAgY29uc3QgY29uZmlnID0gT2JqZWN0LmtleXModGhpcy5fcmVkdWNlclNjaGVtYXMpLnJlZHVjZShcbiAgICAgIChhY2N1LCBrZXkpID0+ICh7XG4gICAgICAgIC4uLmFjY3UsXG4gICAgICAgIC4uLih0b1NhdmVba2V5XSA/IHRoaXMuX3JlZHVjZXJTY2hlbWFzW2tleV1bdGhpcy5fdmVyc2lvbl0uc2F2ZSh0b1NhdmVba2V5XSkgOiB7fSlcbiAgICAgIH0pLFxuICAgICAge31cbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZlcnNpb246IHRoaXMuX3ZlcnNpb24sXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICBjb25maWdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlIHNhdmVkIGRhdGFcbiAgICogQHBhcmFtIGRhdGFzZXRzXG4gICAqIEByZXR1cm5zIC0gZGF0YXNldCB0byBwYXNzIHRvIGFkZERhdGFUb01hcFxuICAgKi9cbiAgcGFyc2VTYXZlZERhdGEoZGF0YXNldHM6IGFueSk6IFBhcnNlZERhdGFzZXRbXSB8IG51bGwge1xuICAgIHJldHVybiBkYXRhc2V0cy5yZWR1Y2UoKGFjY3UsIGRzKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFZlcnNpb24gPSB0aGlzLnZhbGlkYXRlVmVyc2lvbihkcy52ZXJzaW9uKTtcbiAgICAgIGlmICghdmFsaWRWZXJzaW9uKSB7XG4gICAgICAgIHJldHVybiBhY2N1O1xuICAgICAgfVxuICAgICAgYWNjdS5wdXNoKHRoaXMuX2RhdGFzZXRTY2hlbWFbdmFsaWRWZXJzaW9uXS5sb2FkKGRzLmRhdGEpKTtcbiAgICAgIHJldHVybiBhY2N1O1xuICAgIH0sIFtdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSBzYXZlZCBBcHAgY29uZmlnXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gIHBhcnNlU2F2ZWRDb25maWcoe3ZlcnNpb24sIGNvbmZpZ30sIHN0YXRlID0ge30pOiBQYXJzZWRDb25maWcgfCBudWxsIHtcbiAgICBjb25zdCB2YWxpZFZlcnNpb24gPSB0aGlzLnZhbGlkYXRlVmVyc2lvbih2ZXJzaW9uKTtcbiAgICBpZiAoIXZhbGlkVmVyc2lvbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgdG9Mb2FkID1cbiAgICAgIHR5cGVvZiB0aGlzLl9jb21wb3NlZFJlZHVjZXJTY2hlbWE/LmxvYWQgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyB0aGlzLl9jb21wb3NlZFJlZHVjZXJTY2hlbWEubG9hZChjb25maWcpXG4gICAgICAgIDogY29uZmlnO1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHRvTG9hZCkucmVkdWNlKFxuICAgICAgKGFjY3UsIGtleSkgPT4gKHtcbiAgICAgICAgLi4uYWNjdSxcbiAgICAgICAgLi4uKGtleSBpbiB0aGlzLl9yZWR1Y2VyU2NoZW1hc1xuICAgICAgICAgID8gdGhpcy5fcmVkdWNlclNjaGVtYXNba2V5XVt2YWxpZFZlcnNpb25dLmxvYWQodG9Mb2FkW2tleV0pXG4gICAgICAgICAgOiB7fSlcbiAgICAgIH0pLFxuICAgICAge31cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHZlcnNpb25cbiAgICogQHBhcmFtIHZlcnNpb25cbiAgICogQHJldHVybnMgdmFsaWRWZXJzaW9uXG4gICAqL1xuICB2YWxpZGF0ZVZlcnNpb24odmVyc2lvbjogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKCF2ZXJzaW9uKSB7XG4gICAgICBDb25zb2xlLmVycm9yKCdUaGVyZSBpcyBubyB2ZXJzaW9uIG51bWJlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBzYXZlZCBtYXAnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5fdmFsaWRWZXJzaW9uc1t2ZXJzaW9uXSkge1xuICAgICAgQ29uc29sZS5lcnJvcihgJHt2ZXJzaW9ufSBpcyBub3QgYSB2YWxpZCB2ZXJzaW9uYCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdmVyc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBkYXRhIGhhcyBjaGFuZ2VkIHNpbmNlIGxhc3Qgc2F2ZVxuICAgKiBAcGFyYW0gc3RhdGVcbiAgICogQHJldHVybnMgLSB3aGV0aGVyIGRhdGEgaGFzIGNoYW5nZWQgb3Igbm90XG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gIGhhc0RhdGFDaGFuZ2VkKHN0YXRlOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5jb25zdCBLZXBsZXJHTFNjaGVtYU1hbmFnZXIgPSBuZXcgS2VwbGVyR0xTY2hlbWEoKTtcblxuZXhwb3J0IGRlZmF1bHQgS2VwbGVyR0xTY2hlbWFNYW5hZ2VyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBR0EsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBR0EsSUFBQUMsY0FBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsZUFBQSxHQUFBRCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUksZUFBQSxHQUFBRixzQkFBQSxDQUFBRixPQUFBO0FBRUEs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