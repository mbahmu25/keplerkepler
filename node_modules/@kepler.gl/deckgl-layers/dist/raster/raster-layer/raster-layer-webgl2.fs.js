"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
// SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project
var _default = exports["default"] = "#version 300 es\n#define SHADER_NAME raster-layer-fragment-shader\n\n// Ref https://www.khronos.org/registry/OpenGL/specs/es/3.0/GLSL_ES_Specification_3.00.pdf#page=60\nprecision mediump float;\nprecision mediump int;\nprecision mediump usampler2D;\n\nin vec2 vTexCoord;\nin vec2 vTexPos;\n\nout vec4 color;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n\n  vec4 image;\n  DECKGL_CREATE_COLOR(image, vTexCoord);\n\n  DECKGL_MUTATE_COLOR(image, vTexCoord);\n\n  color = apply_opacity(color_tint(color_desaturate(image.rgb)), opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n";
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZGVmYXVsdCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcmFzdGVyL3Jhc3Rlci1sYXllci9yYXN0ZXItbGF5ZXItd2ViZ2wyLmZzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVRcbi8vIENvcHlyaWdodCBjb250cmlidXRvcnMgdG8gdGhlIGtlcGxlci5nbCBwcm9qZWN0XG5cbmV4cG9ydCBkZWZhdWx0IGBcXFxuI3ZlcnNpb24gMzAwIGVzXG4jZGVmaW5lIFNIQURFUl9OQU1FIHJhc3Rlci1sYXllci1mcmFnbWVudC1zaGFkZXJcblxuLy8gUmVmIGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L09wZW5HTC9zcGVjcy9lcy8zLjAvR0xTTF9FU19TcGVjaWZpY2F0aW9uXzMuMDAucGRmI3BhZ2U9NjBcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xucHJlY2lzaW9uIG1lZGl1bXAgaW50O1xucHJlY2lzaW9uIG1lZGl1bXAgdXNhbXBsZXIyRDtcblxuaW4gdmVjMiB2VGV4Q29vcmQ7XG5pbiB2ZWMyIHZUZXhQb3M7XG5cbm91dCB2ZWM0IGNvbG9yO1xuXG51bmlmb3JtIGZsb2F0IGRlc2F0dXJhdGU7XG51bmlmb3JtIHZlYzQgdHJhbnNwYXJlbnRDb2xvcjtcbnVuaWZvcm0gdmVjMyB0aW50Q29sb3I7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG5cbnVuaWZvcm0gZmxvYXQgY29vcmRpbmF0ZUNvbnZlcnNpb247XG51bmlmb3JtIHZlYzQgYm91bmRzO1xuXG4vKiBwcm9qZWN0aW9uIHV0aWxzICovXG5jb25zdCBmbG9hdCBUSUxFX1NJWkUgPSA1MTIuMDtcbmNvbnN0IGZsb2F0IFBJID0gMy4xNDE1OTI2NTM2O1xuY29uc3QgZmxvYXQgV09STERfU0NBTEUgPSBUSUxFX1NJWkUgLyBQSSAvIDIuMDtcblxuLy8gZnJvbSBkZWdyZWVzIHRvIFdlYiBNZXJjYXRvclxudmVjMiBsbmdsYXRfdG9fbWVyY2F0b3IodmVjMiBsbmdsYXQpIHtcbiAgZmxvYXQgeCA9IGxuZ2xhdC54O1xuICBmbG9hdCB5ID0gY2xhbXAobG5nbGF0LnksIC04OS45LCA4OS45KTtcbiAgcmV0dXJuIHZlYzIoXG4gICAgcmFkaWFucyh4KSArIFBJLFxuICAgIFBJICsgbG9nKHRhbihQSSAqIDAuMjUgKyByYWRpYW5zKHkpICogMC41KSlcbiAgKSAqIFdPUkxEX1NDQUxFO1xufVxuXG4vLyBmcm9tIFdlYiBNZXJjYXRvciB0byBkZWdyZWVzXG52ZWMyIG1lcmNhdG9yX3RvX2xuZ2xhdCh2ZWMyIHh5KSB7XG4gIHh5IC89IFdPUkxEX1NDQUxFO1xuICByZXR1cm4gZGVncmVlcyh2ZWMyKFxuICAgIHh5LnggLSBQSSxcbiAgICBhdGFuKGV4cCh4eS55IC0gUEkpKSAqIDIuMCAtIFBJICogMC41XG4gICkpO1xufVxuLyogRW5kIHByb2plY3Rpb24gdXRpbHMgKi9cblxuLy8gYXBwbHkgZGVzYXR1cmF0aW9uXG52ZWMzIGNvbG9yX2Rlc2F0dXJhdGUodmVjMyBjb2xvcikge1xuICBmbG9hdCBsdW1pbmFuY2UgPSAoY29sb3IuciArIGNvbG9yLmcgKyBjb2xvci5iKSAqIDAuMzMzMzMzMzMzO1xuICByZXR1cm4gbWl4KGNvbG9yLCB2ZWMzKGx1bWluYW5jZSksIGRlc2F0dXJhdGUpO1xufVxuXG4vLyBhcHBseSB0aW50XG52ZWMzIGNvbG9yX3RpbnQodmVjMyBjb2xvcikge1xuICByZXR1cm4gY29sb3IgKiB0aW50Q29sb3I7XG59XG5cbi8vIGJsZW5kIHdpdGggYmFja2dyb3VuZCBjb2xvclxudmVjNCBhcHBseV9vcGFjaXR5KHZlYzMgY29sb3IsIGZsb2F0IGFscGhhKSB7XG4gIGlmICh0cmFuc3BhcmVudENvbG9yLmEgPT0gMC4wKSB7XG4gICAgcmV0dXJuIHZlYzQoY29sb3IsIGFscGhhKTtcbiAgfVxuICBmbG9hdCBibGVuZGVkQWxwaGEgPSBhbHBoYSArIHRyYW5zcGFyZW50Q29sb3IuYSAqICgxLjAgLSBhbHBoYSk7XG4gIGZsb2F0IGhpZ2hMaWdodFJhdGlvID0gYWxwaGEgLyBibGVuZGVkQWxwaGE7XG4gIHZlYzMgYmxlbmRlZFJHQiA9IG1peCh0cmFuc3BhcmVudENvbG9yLnJnYiwgY29sb3IsIGhpZ2hMaWdodFJhdGlvKTtcbiAgcmV0dXJuIHZlYzQoYmxlbmRlZFJHQiwgYmxlbmRlZEFscGhhKTtcbn1cblxudmVjMiBnZXRVVih2ZWMyIHBvcykge1xuICByZXR1cm4gdmVjMihcbiAgICAocG9zLnggLSBib3VuZHNbMF0pIC8gKGJvdW5kc1syXSAtIGJvdW5kc1swXSksXG4gICAgKHBvcy55IC0gYm91bmRzWzNdKSAvIChib3VuZHNbMV0gLSBib3VuZHNbM10pXG4gICk7XG59XG5cbnZvaWQgbWFpbih2b2lkKSB7XG4gIHZlYzIgdXYgPSB2VGV4Q29vcmQ7XG4gIGlmIChjb29yZGluYXRlQ29udmVyc2lvbiA8IC0wLjUpIHtcbiAgICB2ZWMyIGxuZ2xhdCA9IG1lcmNhdG9yX3RvX2xuZ2xhdCh2VGV4UG9zKTtcbiAgICB1diA9IGdldFVWKGxuZ2xhdCk7XG4gIH0gZWxzZSBpZiAoY29vcmRpbmF0ZUNvbnZlcnNpb24gPiAwLjUpIHtcbiAgICB2ZWMyIGNvbW1vblBvcyA9IGxuZ2xhdF90b19tZXJjYXRvcih2VGV4UG9zKTtcbiAgICB1diA9IGdldFVWKGNvbW1vblBvcyk7XG4gIH1cblxuICB2ZWM0IGltYWdlO1xuICBERUNLR0xfQ1JFQVRFX0NPTE9SKGltYWdlLCB2VGV4Q29vcmQpO1xuXG4gIERFQ0tHTF9NVVRBVEVfQ09MT1IoaW1hZ2UsIHZUZXhDb29yZCk7XG5cbiAgY29sb3IgPSBhcHBseV9vcGFjaXR5KGNvbG9yX3RpbnQoY29sb3JfZGVzYXR1cmF0ZShpbWFnZS5yZ2IpKSwgb3BhY2l0eSk7XG5cbiAgZ2VvbWV0cnkudXYgPSB1djtcbiAgREVDS0dMX0ZJTFRFUl9DT0xPUihjb2xvciwgZ2VvbWV0cnkpO1xufVxuYDtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUFBLElBQUFBLFFBQUEsR0FBQUMsT0FBQSIsImlnbm9yZUxpc3QiOltdfQ==