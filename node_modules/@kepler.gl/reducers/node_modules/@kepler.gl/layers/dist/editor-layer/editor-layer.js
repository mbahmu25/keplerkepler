"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getEditorLayer = getEditorLayer;
var _layers = require("@nebula.gl/layers");
var _editModes = require("@nebula.gl/edit-modes");
var _extensions = require("@deck.gl/extensions");
var _constants = require("@kepler.gl/constants");
var _commonUtils = require("@kepler.gl/common-utils");
var _constants2 = require("./constants");
var _featureStyles = require("./feature-styles");
var _modifyModeExtended = require("./modify-mode-extended");
var _editorLayerUtils = require("./editor-layer-utils");
// SPDX-License-Identifier: MIT
// Copyright contributors to the kepler.gl project

var DEFAULT_COMPOSITE_MODE = new _editModes.CompositeMode([new _editModes.TranslateMode(), new _modifyModeExtended.ModifyModeExtended()]);
/**
 * Returns editable layer to edit polygon filters.
 * @param params
 * @param params.editorMenuActive Indicates whether the editor side menu is active.
 * @param params.editor
 * @param params.onSetFeatures A callback to set features.
 * @param params.setSelectedFeature A callback to set selected feature and selection context.
 * @param params.viewport Current viewport.
 * @param params.featureCollection Feature collection with an array of features
 * @param params.selectedFeatureIndexes An array with index of currently selected feature.
 */
function getEditorLayer(_ref) {
  var editorMenuActive = _ref.editorMenuActive,
    editor = _ref.editor,
    onSetFeatures = _ref.onSetFeatures,
    setSelectedFeature = _ref.setSelectedFeature,
    featureCollection = _ref.featureCollection,
    selectedFeatureIndexes = _ref.selectedFeatureIndexes,
    viewport = _ref.viewport;
  var editorMode = editor.mode;
  var mode = DEFAULT_COMPOSITE_MODE;
  if (editorMenuActive) {
    // @ts-ignore
    if (editorMode === _constants.EDITOR_MODES.DRAW_POLYGON) mode = _editModes.DrawPolygonMode;
    // @ts-ignore
    else if (editorMode === _constants.EDITOR_MODES.DRAW_RECTANGLE) mode = _editModes.DrawRectangleMode;
  }

  // @ts-ignore
  return new _layers.EditableGeoJsonLayer({
    id: _constants.EDITOR_LAYER_ID,
    mode: mode,
    // @ts-ignore
    data: featureCollection,
    selectedFeatureIndexes: selectedFeatureIndexes,
    visible: editor.visible,
    pickable: true,
    pickingRadius: _constants.EDITOR_LAYER_PICKING_RADIUS,
    modeConfig: {
      viewport: viewport,
      screenSpace: true,
      lockRectangles: true
    },
    pickingLineWidthExtraPixels: 5,
    // Only show fill when polygons are selected,
    // there is no way atm to enable fill for only one feature
    filled: selectedFeatureIndexes.length > 0,
    onEdit: function onEdit(_ref2) {
      var updatedData = _ref2.updatedData,
        editType = _ref2.editType;
      switch (editType) {
        case _constants2.EDIT_TYPES.ADD_FEATURE:
          {
            var _features = updatedData.features;
            if (_features.length) {
              var lastFeature = _features[_features.length - 1];
              lastFeature.properties.isClosed = true;
              lastFeature.id = (0, _commonUtils.generateHashId)(6);
              onSetFeatures(updatedData.features);
              setSelectedFeature(lastFeature);
            }
            break;
          }
        case _constants2.EDIT_TYPES.ADD_POSITION:
        case _constants2.EDIT_TYPES.MOVE_POSITION:
        case _constants2.EDIT_TYPES.TRANSLATING:
          onSetFeatures(updatedData.features);
          break;
        default:
          break;
      }
    },
    // prevent self-highlights with tentative features
    autoHighlight: !(0, _editorLayerUtils.isDrawingActive)(editorMenuActive, editorMode),
    // @ts-ignore
    highlightColor: function highlightColor(info) {
      // Note: lines are reported as parent polygon
      var object = info.object;
      if (object) {
        var _editor$selectedFeatu;
        if (object.id === ((_editor$selectedFeatu = editor.selectedFeature) === null || _editor$selectedFeatu === void 0 ? void 0 : _editor$selectedFeatu.id)) {
          return _featureStyles.FEATURE_STYLE.highlightMultiplierNone;
        }
        var type = object.properties.editHandleType;
        if (type === 'intermediate') return _featureStyles.EDIT_HANDLE_STYLE.highlightMultiplierNone;else if (type === 'existing') return _featureStyles.EDIT_HANDLE_STYLE.highlightMultiplier;
      }

      // Note: highlight color affects even transparent filled polygons
      return selectedFeatureIndexes.length ? _featureStyles.FEATURE_STYLE.highlightMultiplier : _featureStyles.LINE_STYLE.highlightMultiplier;
    },
    extensions: [new _extensions.PathStyleExtension({
      dash: true
    })],
    dashGapPickable: true,
    getDashArray: function getDashArray(feature) {
      var _feature$properties, _editor$selectedFeatu2;
      if ((feature === null || feature === void 0 || (_feature$properties = feature.properties) === null || _feature$properties === void 0 ? void 0 : _feature$properties.guideType) === 'tentative') {
        return _featureStyles.LINE_STYLE.dashArray;
      }
      if ((feature === null || feature === void 0 ? void 0 : feature.id) === ((_editor$selectedFeatu2 = editor.selectedFeature) === null || _editor$selectedFeatu2 === void 0 ? void 0 : _editor$selectedFeatu2.id)) return _featureStyles.LINE_STYLE.solidArray;
      return _featureStyles.LINE_STYLE.dashArray;
    },
    getLineColor: _featureStyles.LINE_STYLE.getColor,
    getFillColor: _featureStyles.FEATURE_STYLE.getColor,
    getRadius: _featureStyles.EDIT_HANDLE_STYLE.getRadius,
    // @ts-ignore
    getLineWidth: _featureStyles.LINE_STYLE.getWidth,
    getEditHandlePointRadius: _featureStyles.EDIT_HANDLE_STYLE.getRadius,
    getEditHandlePointColor: _featureStyles.EDIT_HANDLE_STYLE.getFillColor,
    getEditHandlePointOutlineColor: _featureStyles.EDIT_HANDLE_STYLE.getOutlineColor,
    getTentativeLineColor: _featureStyles.LINE_STYLE.getTentativeLineColor,
    // @ts-ignore
    getTentativeLineWidth: _featureStyles.LINE_STYLE.getTentativeLineWidth,
    getTentativeFillColor: _featureStyles.LINE_STYLE.getTentativeFillColor,
    parameters: {}
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbGF5ZXJzIiwicmVxdWlyZSIsIl9lZGl0TW9kZXMiLCJfZXh0ZW5zaW9ucyIsIl9jb25zdGFudHMiLCJfY29tbW9uVXRpbHMiLCJfY29uc3RhbnRzMiIsIl9mZWF0dXJlU3R5bGVzIiwiX21vZGlmeU1vZGVFeHRlbmRlZCIsIl9lZGl0b3JMYXllclV0aWxzIiwiREVGQVVMVF9DT01QT1NJVEVfTU9ERSIsIkNvbXBvc2l0ZU1vZGUiLCJUcmFuc2xhdGVNb2RlIiwiTW9kaWZ5TW9kZUV4dGVuZGVkIiwiZ2V0RWRpdG9yTGF5ZXIiLCJfcmVmIiwiZWRpdG9yTWVudUFjdGl2ZSIsImVkaXRvciIsIm9uU2V0RmVhdHVyZXMiLCJzZXRTZWxlY3RlZEZlYXR1cmUiLCJmZWF0dXJlQ29sbGVjdGlvbiIsInNlbGVjdGVkRmVhdHVyZUluZGV4ZXMiLCJ2aWV3cG9ydCIsImVkaXRvck1vZGUiLCJtb2RlIiwiRURJVE9SX01PREVTIiwiRFJBV19QT0xZR09OIiwiRHJhd1BvbHlnb25Nb2RlIiwiRFJBV19SRUNUQU5HTEUiLCJEcmF3UmVjdGFuZ2xlTW9kZSIsIkVkaXRhYmxlR2VvSnNvbkxheWVyIiwiaWQiLCJFRElUT1JfTEFZRVJfSUQiLCJkYXRhIiwidmlzaWJsZSIsInBpY2thYmxlIiwicGlja2luZ1JhZGl1cyIsIkVESVRPUl9MQVlFUl9QSUNLSU5HX1JBRElVUyIsIm1vZGVDb25maWciLCJzY3JlZW5TcGFjZSIsImxvY2tSZWN0YW5nbGVzIiwicGlja2luZ0xpbmVXaWR0aEV4dHJhUGl4ZWxzIiwiZmlsbGVkIiwibGVuZ3RoIiwib25FZGl0IiwiX3JlZjIiLCJ1cGRhdGVkRGF0YSIsImVkaXRUeXBlIiwiRURJVF9UWVBFUyIsIkFERF9GRUFUVVJFIiwiX2ZlYXR1cmVzIiwiZmVhdHVyZXMiLCJsYXN0RmVhdHVyZSIsInByb3BlcnRpZXMiLCJpc0Nsb3NlZCIsImdlbmVyYXRlSGFzaElkIiwiQUREX1BPU0lUSU9OIiwiTU9WRV9QT1NJVElPTiIsIlRSQU5TTEFUSU5HIiwiYXV0b0hpZ2hsaWdodCIsImlzRHJhd2luZ0FjdGl2ZSIsImhpZ2hsaWdodENvbG9yIiwiaW5mbyIsIm9iamVjdCIsIl9lZGl0b3Ikc2VsZWN0ZWRGZWF0dSIsInNlbGVjdGVkRmVhdHVyZSIsIkZFQVRVUkVfU1RZTEUiLCJoaWdobGlnaHRNdWx0aXBsaWVyTm9uZSIsInR5cGUiLCJlZGl0SGFuZGxlVHlwZSIsIkVESVRfSEFORExFX1NUWUxFIiwiaGlnaGxpZ2h0TXVsdGlwbGllciIsIkxJTkVfU1RZTEUiLCJleHRlbnNpb25zIiwiUGF0aFN0eWxlRXh0ZW5zaW9uIiwiZGFzaCIsImRhc2hHYXBQaWNrYWJsZSIsImdldERhc2hBcnJheSIsImZlYXR1cmUiLCJfZmVhdHVyZSRwcm9wZXJ0aWVzIiwiX2VkaXRvciRzZWxlY3RlZEZlYXR1MiIsImd1aWRlVHlwZSIsImRhc2hBcnJheSIsInNvbGlkQXJyYXkiLCJnZXRMaW5lQ29sb3IiLCJnZXRDb2xvciIsImdldEZpbGxDb2xvciIsImdldFJhZGl1cyIsImdldExpbmVXaWR0aCIsImdldFdpZHRoIiwiZ2V0RWRpdEhhbmRsZVBvaW50UmFkaXVzIiwiZ2V0RWRpdEhhbmRsZVBvaW50Q29sb3IiLCJnZXRFZGl0SGFuZGxlUG9pbnRPdXRsaW5lQ29sb3IiLCJnZXRPdXRsaW5lQ29sb3IiLCJnZXRUZW50YXRpdmVMaW5lQ29sb3IiLCJnZXRUZW50YXRpdmVMaW5lV2lkdGgiLCJnZXRUZW50YXRpdmVGaWxsQ29sb3IiLCJwYXJhbWV0ZXJzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2VkaXRvci1sYXllci9lZGl0b3ItbGF5ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVFxuLy8gQ29weXJpZ2h0IGNvbnRyaWJ1dG9ycyB0byB0aGUga2VwbGVyLmdsIHByb2plY3RcblxuaW1wb3J0IHtFZGl0YWJsZUdlb0pzb25MYXllcn0gZnJvbSAnQG5lYnVsYS5nbC9sYXllcnMnO1xuaW1wb3J0IHtMYXllciBhcyBEZWNrTGF5ZXIsIExheWVyUHJvcHMgYXMgRGVja0xheWVyUHJvcHN9IGZyb20gJ0BkZWNrLmdsL2NvcmUvdHlwZWQnO1xuaW1wb3J0IHtcbiAgRHJhd1BvbHlnb25Nb2RlLFxuICBUcmFuc2xhdGVNb2RlLFxuICBDb21wb3NpdGVNb2RlLFxuICBEcmF3UmVjdGFuZ2xlTW9kZVxufSBmcm9tICdAbmVidWxhLmdsL2VkaXQtbW9kZXMnO1xuaW1wb3J0IHtQYXRoU3R5bGVFeHRlbnNpb259IGZyb20gJ0BkZWNrLmdsL2V4dGVuc2lvbnMnO1xuXG5pbXBvcnQge0VESVRPUl9MQVlFUl9JRCwgRURJVE9SX01PREVTLCBFRElUT1JfTEFZRVJfUElDS0lOR19SQURJVVN9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7Vmlld3BvcnQsIEVkaXRvciwgRmVhdHVyZSwgRmVhdHVyZVNlbGVjdGlvbkNvbnRleHR9IGZyb20gJ0BrZXBsZXIuZ2wvdHlwZXMnO1xuaW1wb3J0IHtnZW5lcmF0ZUhhc2hJZH0gZnJvbSAnQGtlcGxlci5nbC9jb21tb24tdXRpbHMnO1xuXG5pbXBvcnQge0VESVRfVFlQRVN9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7TElORV9TVFlMRSwgRkVBVFVSRV9TVFlMRSwgRURJVF9IQU5ETEVfU1RZTEV9IGZyb20gJy4vZmVhdHVyZS1zdHlsZXMnO1xuaW1wb3J0IHtNb2RpZnlNb2RlRXh0ZW5kZWR9IGZyb20gJy4vbW9kaWZ5LW1vZGUtZXh0ZW5kZWQnO1xuaW1wb3J0IHtpc0RyYXdpbmdBY3RpdmV9IGZyb20gJy4vZWRpdG9yLWxheWVyLXV0aWxzJztcblxuY29uc3QgREVGQVVMVF9DT01QT1NJVEVfTU9ERSA9IG5ldyBDb21wb3NpdGVNb2RlKFtuZXcgVHJhbnNsYXRlTW9kZSgpLCBuZXcgTW9kaWZ5TW9kZUV4dGVuZGVkKCldKTtcblxuZXhwb3J0IHR5cGUgR2V0RWRpdG9yTGF5ZXJQcm9wcyA9IHtcbiAgZWRpdG9yTWVudUFjdGl2ZTogYm9vbGVhbjtcbiAgZWRpdG9yOiBFZGl0b3I7XG4gIG9uU2V0RmVhdHVyZXM6IChmZWF0dXJlczogRmVhdHVyZVtdKSA9PiBhbnk7XG4gIHNldFNlbGVjdGVkRmVhdHVyZTogKGZlYXR1cmU6IEZlYXR1cmUgfCBudWxsLCBzZWxlY3Rpb25Db250ZXh0PzogRmVhdHVyZVNlbGVjdGlvbkNvbnRleHQpID0+IGFueTtcbiAgdmlld3BvcnQ6IFZpZXdwb3J0O1xuICBmZWF0dXJlQ29sbGVjdGlvbjoge1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBmZWF0dXJlczogRmVhdHVyZVtdO1xuICB9O1xuICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzOiBudW1iZXJbXTtcbn07XG5cbi8qKlxuICogUmV0dXJucyBlZGl0YWJsZSBsYXllciB0byBlZGl0IHBvbHlnb24gZmlsdGVycy5cbiAqIEBwYXJhbSBwYXJhbXNcbiAqIEBwYXJhbSBwYXJhbXMuZWRpdG9yTWVudUFjdGl2ZSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgZWRpdG9yIHNpZGUgbWVudSBpcyBhY3RpdmUuXG4gKiBAcGFyYW0gcGFyYW1zLmVkaXRvclxuICogQHBhcmFtIHBhcmFtcy5vblNldEZlYXR1cmVzIEEgY2FsbGJhY2sgdG8gc2V0IGZlYXR1cmVzLlxuICogQHBhcmFtIHBhcmFtcy5zZXRTZWxlY3RlZEZlYXR1cmUgQSBjYWxsYmFjayB0byBzZXQgc2VsZWN0ZWQgZmVhdHVyZSBhbmQgc2VsZWN0aW9uIGNvbnRleHQuXG4gKiBAcGFyYW0gcGFyYW1zLnZpZXdwb3J0IEN1cnJlbnQgdmlld3BvcnQuXG4gKiBAcGFyYW0gcGFyYW1zLmZlYXR1cmVDb2xsZWN0aW9uIEZlYXR1cmUgY29sbGVjdGlvbiB3aXRoIGFuIGFycmF5IG9mIGZlYXR1cmVzXG4gKiBAcGFyYW0gcGFyYW1zLnNlbGVjdGVkRmVhdHVyZUluZGV4ZXMgQW4gYXJyYXkgd2l0aCBpbmRleCBvZiBjdXJyZW50bHkgc2VsZWN0ZWQgZmVhdHVyZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVkaXRvckxheWVyKHtcbiAgZWRpdG9yTWVudUFjdGl2ZSxcbiAgZWRpdG9yLFxuICBvblNldEZlYXR1cmVzLFxuICBzZXRTZWxlY3RlZEZlYXR1cmUsXG4gIGZlYXR1cmVDb2xsZWN0aW9uLFxuICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzLFxuICB2aWV3cG9ydFxufTogR2V0RWRpdG9yTGF5ZXJQcm9wcyk6IERlY2tMYXllcjxEZWNrTGF5ZXJQcm9wcz4ge1xuICBjb25zdCB7bW9kZTogZWRpdG9yTW9kZX0gPSBlZGl0b3I7XG5cbiAgbGV0IG1vZGUgPSBERUZBVUxUX0NPTVBPU0lURV9NT0RFO1xuICBpZiAoZWRpdG9yTWVudUFjdGl2ZSkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoZWRpdG9yTW9kZSA9PT0gRURJVE9SX01PREVTLkRSQVdfUE9MWUdPTikgbW9kZSA9IERyYXdQb2x5Z29uTW9kZTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZWxzZSBpZiAoZWRpdG9yTW9kZSA9PT0gRURJVE9SX01PREVTLkRSQVdfUkVDVEFOR0xFKSBtb2RlID0gRHJhd1JlY3RhbmdsZU1vZGU7XG4gIH1cblxuICAvLyBAdHMtaWdub3JlXG4gIHJldHVybiBuZXcgRWRpdGFibGVHZW9Kc29uTGF5ZXIoe1xuICAgIGlkOiBFRElUT1JfTEFZRVJfSUQsXG4gICAgbW9kZSxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZGF0YTogZmVhdHVyZUNvbGxlY3Rpb24sXG4gICAgc2VsZWN0ZWRGZWF0dXJlSW5kZXhlcyxcbiAgICB2aXNpYmxlOiBlZGl0b3IudmlzaWJsZSxcbiAgICBwaWNrYWJsZTogdHJ1ZSxcbiAgICBwaWNraW5nUmFkaXVzOiBFRElUT1JfTEFZRVJfUElDS0lOR19SQURJVVMsXG4gICAgbW9kZUNvbmZpZzoge1xuICAgICAgdmlld3BvcnQsXG4gICAgICBzY3JlZW5TcGFjZTogdHJ1ZSxcbiAgICAgIGxvY2tSZWN0YW5nbGVzOiB0cnVlXG4gICAgfSxcblxuICAgIHBpY2tpbmdMaW5lV2lkdGhFeHRyYVBpeGVsczogNSxcblxuICAgIC8vIE9ubHkgc2hvdyBmaWxsIHdoZW4gcG9seWdvbnMgYXJlIHNlbGVjdGVkLFxuICAgIC8vIHRoZXJlIGlzIG5vIHdheSBhdG0gdG8gZW5hYmxlIGZpbGwgZm9yIG9ubHkgb25lIGZlYXR1cmVcbiAgICBmaWxsZWQ6IHNlbGVjdGVkRmVhdHVyZUluZGV4ZXMubGVuZ3RoID4gMCxcblxuICAgIG9uRWRpdDogKHt1cGRhdGVkRGF0YSwgZWRpdFR5cGV9KSA9PiB7XG4gICAgICBzd2l0Y2ggKGVkaXRUeXBlKSB7XG4gICAgICAgIGNhc2UgRURJVF9UWVBFUy5BRERfRkVBVFVSRToge1xuICAgICAgICAgIGNvbnN0IHtmZWF0dXJlczogX2ZlYXR1cmVzfSA9IHVwZGF0ZWREYXRhO1xuICAgICAgICAgIGlmIChfZmVhdHVyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBsYXN0RmVhdHVyZSA9IF9mZWF0dXJlc1tfZmVhdHVyZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBsYXN0RmVhdHVyZS5wcm9wZXJ0aWVzLmlzQ2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxhc3RGZWF0dXJlLmlkID0gZ2VuZXJhdGVIYXNoSWQoNik7XG4gICAgICAgICAgICBvblNldEZlYXR1cmVzKHVwZGF0ZWREYXRhLmZlYXR1cmVzKTtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkRmVhdHVyZShsYXN0RmVhdHVyZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgRURJVF9UWVBFUy5BRERfUE9TSVRJT046XG4gICAgICAgIGNhc2UgRURJVF9UWVBFUy5NT1ZFX1BPU0lUSU9OOlxuICAgICAgICBjYXNlIEVESVRfVFlQRVMuVFJBTlNMQVRJTkc6XG4gICAgICAgICAgb25TZXRGZWF0dXJlcyh1cGRhdGVkRGF0YS5mZWF0dXJlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIHByZXZlbnQgc2VsZi1oaWdobGlnaHRzIHdpdGggdGVudGF0aXZlIGZlYXR1cmVzXG4gICAgYXV0b0hpZ2hsaWdodDogIWlzRHJhd2luZ0FjdGl2ZShlZGl0b3JNZW51QWN0aXZlLCBlZGl0b3JNb2RlKSxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaGlnaGxpZ2h0Q29sb3I6IGluZm8gPT4ge1xuICAgICAgLy8gTm90ZTogbGluZXMgYXJlIHJlcG9ydGVkIGFzIHBhcmVudCBwb2x5Z29uXG4gICAgICBjb25zdCB7b2JqZWN0fSA9IGluZm87XG4gICAgICBpZiAob2JqZWN0KSB7XG4gICAgICAgIGlmIChvYmplY3QuaWQgPT09IGVkaXRvci5zZWxlY3RlZEZlYXR1cmU/LmlkKSB7XG4gICAgICAgICAgcmV0dXJuIEZFQVRVUkVfU1RZTEUuaGlnaGxpZ2h0TXVsdGlwbGllck5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0eXBlID0gb2JqZWN0LnByb3BlcnRpZXMuZWRpdEhhbmRsZVR5cGU7XG4gICAgICAgIGlmICh0eXBlID09PSAnaW50ZXJtZWRpYXRlJykgcmV0dXJuIEVESVRfSEFORExFX1NUWUxFLmhpZ2hsaWdodE11bHRpcGxpZXJOb25lO1xuICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZXhpc3RpbmcnKSByZXR1cm4gRURJVF9IQU5ETEVfU1RZTEUuaGlnaGxpZ2h0TXVsdGlwbGllcjtcbiAgICAgIH1cblxuICAgICAgLy8gTm90ZTogaGlnaGxpZ2h0IGNvbG9yIGFmZmVjdHMgZXZlbiB0cmFuc3BhcmVudCBmaWxsZWQgcG9seWdvbnNcbiAgICAgIHJldHVybiBzZWxlY3RlZEZlYXR1cmVJbmRleGVzLmxlbmd0aFxuICAgICAgICA/IEZFQVRVUkVfU1RZTEUuaGlnaGxpZ2h0TXVsdGlwbGllclxuICAgICAgICA6IExJTkVfU1RZTEUuaGlnaGxpZ2h0TXVsdGlwbGllcjtcbiAgICB9LFxuXG4gICAgZXh0ZW5zaW9uczogW25ldyBQYXRoU3R5bGVFeHRlbnNpb24oe2Rhc2g6IHRydWV9KV0sXG4gICAgZGFzaEdhcFBpY2thYmxlOiB0cnVlLFxuICAgIGdldERhc2hBcnJheTogZmVhdHVyZSA9PiB7XG4gICAgICBpZiAoZmVhdHVyZT8ucHJvcGVydGllcz8uZ3VpZGVUeXBlID09PSAndGVudGF0aXZlJykge1xuICAgICAgICByZXR1cm4gTElORV9TVFlMRS5kYXNoQXJyYXk7XG4gICAgICB9XG5cbiAgICAgIGlmIChmZWF0dXJlPy5pZCA9PT0gZWRpdG9yLnNlbGVjdGVkRmVhdHVyZT8uaWQpIHJldHVybiBMSU5FX1NUWUxFLnNvbGlkQXJyYXk7XG5cbiAgICAgIHJldHVybiBMSU5FX1NUWUxFLmRhc2hBcnJheTtcbiAgICB9LFxuXG4gICAgZ2V0TGluZUNvbG9yOiBMSU5FX1NUWUxFLmdldENvbG9yLFxuICAgIGdldEZpbGxDb2xvcjogRkVBVFVSRV9TVFlMRS5nZXRDb2xvcixcblxuICAgIGdldFJhZGl1czogRURJVF9IQU5ETEVfU1RZTEUuZ2V0UmFkaXVzLFxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBnZXRMaW5lV2lkdGg6IExJTkVfU1RZTEUuZ2V0V2lkdGgsXG5cbiAgICBnZXRFZGl0SGFuZGxlUG9pbnRSYWRpdXM6IEVESVRfSEFORExFX1NUWUxFLmdldFJhZGl1cyxcbiAgICBnZXRFZGl0SGFuZGxlUG9pbnRDb2xvcjogRURJVF9IQU5ETEVfU1RZTEUuZ2V0RmlsbENvbG9yLFxuICAgIGdldEVkaXRIYW5kbGVQb2ludE91dGxpbmVDb2xvcjogRURJVF9IQU5ETEVfU1RZTEUuZ2V0T3V0bGluZUNvbG9yLFxuXG4gICAgZ2V0VGVudGF0aXZlTGluZUNvbG9yOiBMSU5FX1NUWUxFLmdldFRlbnRhdGl2ZUxpbmVDb2xvcixcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZ2V0VGVudGF0aXZlTGluZVdpZHRoOiBMSU5FX1NUWUxFLmdldFRlbnRhdGl2ZUxpbmVXaWR0aCxcbiAgICBnZXRUZW50YXRpdmVGaWxsQ29sb3I6IExJTkVfU1RZTEUuZ2V0VGVudGF0aXZlRmlsbENvbG9yLFxuXG4gICAgcGFyYW1ldGVyczoge31cbiAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUdBLElBQUFBLE9BQUEsR0FBQUMsT0FBQTtBQUVBLElBQUFDLFVBQUEsR0FBQUQsT0FBQTtBQU1BLElBQUFFLFdBQUEsR0FBQUYsT0FBQTtBQUVBLElBQUFHLFVBQUEsR0FBQUgsT0FBQTtBQUVBLElBQUFJLFlBQUEsR0FBQUosT0FBQTtBQUVBLElBQUFLLFdBQUEsR0FBQUwsT0FBQTtBQUNBLElBQUFNLGNBQUEsR0FBQU4sT0FBQTtBQUNBLElBQUFPLG1CQUFBLEdBQUFQLE9BQUE7QUFDQSxJQUFBUSxpQkFBQSxHQUFBUixPQUFBO0FBcEJBO0FBQ0E7O0FBcUJBLElBQU1TLHNCQUFzQixHQUFHLElBQUlDLHdCQUFhLENBQUMsQ0FBQyxJQUFJQyx3QkFBYSxDQUFDLENBQUMsRUFBRSxJQUFJQyxzQ0FBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQWVqRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0MsY0FBY0EsQ0FBQUMsSUFBQSxFQVFxQjtFQUFBLElBUGpEQyxnQkFBZ0IsR0FBQUQsSUFBQSxDQUFoQkMsZ0JBQWdCO0lBQ2hCQyxNQUFNLEdBQUFGLElBQUEsQ0FBTkUsTUFBTTtJQUNOQyxhQUFhLEdBQUFILElBQUEsQ0FBYkcsYUFBYTtJQUNiQyxrQkFBa0IsR0FBQUosSUFBQSxDQUFsQkksa0JBQWtCO0lBQ2xCQyxpQkFBaUIsR0FBQUwsSUFBQSxDQUFqQkssaUJBQWlCO0lBQ2pCQyxzQkFBc0IsR0FBQU4sSUFBQSxDQUF0Qk0sc0JBQXNCO0lBQ3RCQyxRQUFRLEdBQUFQLElBQUEsQ0FBUk8sUUFBUTtFQUVSLElBQWFDLFVBQVUsR0FBSU4sTUFBTSxDQUExQk8sSUFBSTtFQUVYLElBQUlBLElBQUksR0FBR2Qsc0JBQXNCO0VBQ2pDLElBQUlNLGdCQUFnQixFQUFFO0lBQ3BCO0lB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